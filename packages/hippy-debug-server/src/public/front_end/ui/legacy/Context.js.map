{"version":3,"file":"Context.js","sourceRoot":"","sources":["../../../../../../front_end/ui/legacy/Context.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2014 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Common from '../../core/common/common.js';\nimport * as Root from '../../core/root/root.js';  // eslint-disable-line @typescript-eslint/no-unused-vars\n\nimport type {ContextFlavorListener} from './ContextFlavorListener.js'; // eslint-disable-line no-unused-vars\n\nlet contextInstance: Context;\n\ninterface ConstructorFn<T> {\n  // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  new(...args: any[]): T;\n}\n\nexport class Context {\n  _flavors: Map<ConstructorFn<unknown>, Object>;\n  _eventDispatchers: Map<ConstructorFn<unknown>, Common.ObjectWrapper.ObjectWrapper>;\n\n  private constructor() {\n    this._flavors = new Map();\n    this._eventDispatchers = new Map();\n  }\n\n  static instance(opts: {\n    forceNew: boolean|null,\n  } = {forceNew: null}): Context {\n    const {forceNew} = opts;\n    if (!contextInstance || forceNew) {\n      contextInstance = new Context();\n    }\n\n    return contextInstance;\n  }\n\n  setFlavor<T>(flavorType: ConstructorFn<T>, flavorValue: T|null): void {\n    const value = this._flavors.get(flavorType) || null;\n    if (value === flavorValue) {\n      return;\n    }\n    if (flavorValue) {\n      this._flavors.set(flavorType, flavorValue);\n    } else {\n      this._flavors.delete(flavorType);\n    }\n\n    this._dispatchFlavorChange(flavorType, flavorValue);\n  }\n\n  _dispatchFlavorChange<T>(flavorType: ConstructorFn<T>, flavorValue: T|null): void {\n    for (const extension of getRegisteredListeners()) {\n      if (extension.contextTypes().includes(flavorType)) {\n        extension.loadListener().then(instance => instance.flavorChanged(flavorValue));\n      }\n    }\n    const dispatcher = this._eventDispatchers.get(flavorType);\n    if (!dispatcher) {\n      return;\n    }\n    dispatcher.dispatchEventToListeners(Events.FlavorChanged, flavorValue);\n  }\n\n  addFlavorChangeListener<T>(\n      flavorType: ConstructorFn<T>, listener: (arg0: Common.EventTarget.EventTargetEvent) => void,\n      thisObject?: Object): void {\n    let dispatcher = this._eventDispatchers.get(flavorType);\n    if (!dispatcher) {\n      dispatcher = new Common.ObjectWrapper.ObjectWrapper();\n      this._eventDispatchers.set(flavorType, dispatcher);\n    }\n    dispatcher.addEventListener(Events.FlavorChanged, listener, thisObject);\n  }\n\n  removeFlavorChangeListener<T>(\n      flavorType: ConstructorFn<T>, listener: (arg0: Common.EventTarget.EventTargetEvent) => void,\n      thisObject?: Object): void {\n    const dispatcher = this._eventDispatchers.get(flavorType);\n    if (!dispatcher) {\n      return;\n    }\n    dispatcher.removeEventListener(Events.FlavorChanged, listener, thisObject);\n    if (!dispatcher.hasEventListeners(Events.FlavorChanged)) {\n      this._eventDispatchers.delete(flavorType);\n    }\n  }\n\n  flavor<T>(flavorType: ConstructorFn<T>): T|null {\n    return (this._flavors.get(flavorType) as T | null) || null;\n  }\n\n  flavors(): Set<ConstructorFn<unknown>> {\n    return new Set(this._flavors.keys());\n  }\n}\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nenum Events {\n  FlavorChanged = 'FlavorChanged',\n}\n\nconst registeredListeners: ContextFlavorListenerRegistration[] = [];\n\nexport function registerListener(registration: ContextFlavorListenerRegistration): void {\n  registeredListeners.push(registration);\n}\n\nfunction getRegisteredListeners(): ContextFlavorListenerRegistration[] {\n  return registeredListeners;\n}\nexport interface ContextFlavorListenerRegistration {\n  contextTypes: () => Array<unknown>;\n  loadListener: () => Promise<ContextFlavorListener>;\n}\n"]}