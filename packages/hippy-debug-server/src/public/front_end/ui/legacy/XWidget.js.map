{"version":3,"file":"XWidget.js","sourceRoot":"","sources":["../../../../../../front_end/ui/legacy/XWidget.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as ComponentHelpers from '../components/helpers/helpers.js';\nimport {appendStyle} from './utils/append-style.js';\nimport {XElement} from './XElement.js';\n\n// TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration\n// eslint-disable-next-line @typescript-eslint/naming-convention\nlet _observer: ResizeObserver|null = null;\n\n// TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst _storedScrollPositions = new WeakMap<Element, {\n  scrollLeft: number,\n  scrollTop: number,\n}>();\n\nexport class XWidget extends XElement {\n  _visible: boolean;\n  _shadowRoot!: DocumentFragment|null;\n  _defaultFocusedElement: Element|null;\n  _elementsToRestoreScrollPositionsFor: Element[];\n  _onShownCallback!: (() => void)|null;\n  _onHiddenCallback!: (() => void)|null;\n  _onResizedCallback!: (() => void)|null;\n\n  constructor() {\n    super();\n    this.style.setProperty('display', 'flex');\n    this.style.setProperty('flex-direction', 'column');\n    this.style.setProperty('align-items', 'stretch');\n    this.style.setProperty('justify-content', 'flex-start');\n    this.style.setProperty('contain', 'layout style');\n\n    this._visible = false;\n    this._defaultFocusedElement = null;\n    this._elementsToRestoreScrollPositionsFor = [];\n\n    if (!_observer) {\n      _observer = new ResizeObserver(entries => {\n        for (const entry of entries) {\n          const widget = (entry.target as XWidget);\n          if (widget._visible && widget._onResizedCallback) {\n            widget._onResizedCallback.call(null);\n          }\n        }\n      });\n    }\n\n    _observer.observe(this);\n\n    this.setElementsToRestoreScrollPositionsFor([this]);\n  }\n\n  isShowing(): boolean {\n    return this._visible;\n  }\n\n  registerRequiredCSS(cssFile: string, options: {\n    enableLegacyPatching: false,\n  }): void {\n    appendStyle(this._shadowRoot || this, cssFile, options);\n  }\n\n  setOnShown(callback: (() => void)|null): void {\n    this._onShownCallback = callback;\n  }\n\n  setOnHidden(callback: (() => void)|null): void {\n    this._onHiddenCallback = callback;\n  }\n\n  setOnResized(callback: (() => void)|null): void {\n    this._onResizedCallback = callback;\n  }\n\n  setElementsToRestoreScrollPositionsFor(elements: Element[]): void {\n    for (const element of this._elementsToRestoreScrollPositionsFor) {\n      element.removeEventListener('scroll', XWidget._storeScrollPosition, {capture: false});\n    }\n    this._elementsToRestoreScrollPositionsFor = elements;\n    for (const element of this._elementsToRestoreScrollPositionsFor) {\n      element.addEventListener('scroll', XWidget._storeScrollPosition, {passive: true, capture: false});\n    }\n  }\n\n  restoreScrollPositions(): void {\n    for (const element of this._elementsToRestoreScrollPositionsFor) {\n      const storedPositions = _storedScrollPositions.get(element);\n      if (storedPositions) {\n        element.scrollTop = storedPositions.scrollTop;\n        element.scrollLeft = storedPositions.scrollLeft;\n      }\n    }\n  }\n\n  static _storeScrollPosition(event: Event): void {\n    const element = (event.currentTarget as Element);\n    _storedScrollPositions.set(element, {scrollLeft: element.scrollLeft, scrollTop: element.scrollTop});\n  }\n\n  setDefaultFocusedElement(element: Element|null): void {\n    if (element && !this.isSelfOrAncestor(element)) {\n      throw new Error('Default focus must be descendant');\n    }\n    this._defaultFocusedElement = element;\n  }\n\n  focus(): void {\n    if (!this._visible) {\n      return;\n    }\n\n    let element;\n    if (this._defaultFocusedElement && this.isSelfOrAncestor(this._defaultFocusedElement)) {\n      element = this._defaultFocusedElement;\n    } else if (this.tabIndex !== -1) {\n      element = this;\n    } else {\n      let child = this.traverseNextNode(this);\n      while (child) {\n        if ((child instanceof XWidget) && child._visible) {\n          element = child;\n          break;\n        }\n        child = child.traverseNextNode(this);\n      }\n    }\n\n    if (!element || element.hasFocus()) {\n      return;\n    }\n    if (element === this) {\n      HTMLElement.prototype.focus.call(this);\n    } else {\n      (element as HTMLElement).focus();\n    }\n  }\n\n  connectedCallback(): void {\n    this._visible = true;\n    this.restoreScrollPositions();\n    if (this._onShownCallback) {\n      this._onShownCallback.call(null);\n    }\n  }\n\n  disconnectedCallback(): void {\n    this._visible = false;\n    if (this._onHiddenCallback) {\n      this._onHiddenCallback.call(null);\n    }\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('x-widget', XWidget);\n"]}