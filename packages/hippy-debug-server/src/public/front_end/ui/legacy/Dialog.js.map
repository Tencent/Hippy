{"version":3,"file":"Dialog.js","sourceRoot":"","sources":["../../../../../../front_end/ui/legacy/Dialog.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA4BG;AAEH,uDAAuD;AAEvD,OAAO,KAAK,SAAS,MAAM,gBAAgB,CAAC;AAC5C,OAAO,EAAC,SAAS,EAAE,qBAAqB,EAAC,MAAM,gBAAgB,CAAC;AAChE,OAAO,EAAC,aAAa,EAAC,MAAM,oBAAoB,CAAC;AACjD,OAAO,EAAC,gBAAgB,EAAE,IAAI,EAAC,MAAM,uBAAuB,CAAC;AAI7D,OAAO,EAAC,mBAAmB,EAAC,MAAM,aAAa,CAAC;AAEhD,MAAM,OAAO,MAAO,SAAQ,SAAS;IACnC,iBAAiB,CAA0B;IAC3C,YAAY,CAA2B;IACvC,cAAc,CAA2B;IACzC,cAAc,CAAU;IACxB,eAAe,CAAiB;IAChC,6BAA6B,CAAyB;IACtD,kBAAkB,CAA+B;IAEjD;QACE,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,mBAAmB,CAAC,sBAAsB,EAAE,EAAC,oBAAoB,EAAE,KAAK,EAAC,CAAC,CAAC;QAChF,IAAI,CAAC,cAAc,CAAC,QAAQ,GAAG,CAAC,CAAC;QACjC,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,KAAK,EAAE,EAAE,KAAK,CAAC,CAAC;QAClF,IAAI,CAAC,MAAM,EAAE,CAAC,wBAAwB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAC5D,IAAI,CAAC,wBAAwB,CAAC,qBAAqB,CAAC,kBAAkB,CAAC,CAAC;QACxE,IAAI,CAAC,uBAAuB,CAAC,KAAK,CAAC,EAAE;YACnC,IAAI,CAAC,IAAI,EAAE,CAAC;YACZ,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QACtB,CAAC,CAAC,CAAC;QACH,SAAS,CAAC,iBAAiB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QACjD,IAAI,CAAC,iBAAiB,GAAG,uBAAuB,CAAC,yBAAyB,CAAC;QAC3E,IAAI,CAAC,YAAY,GAAG,IAAI,GAAG,EAAE,CAAC;QAC9B,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;QAC3B,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;QAC3B,IAAI,CAAC,6BAA6B,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAChE,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;IACjC,CAAC;IAED,MAAM,CAAC,WAAW;QAChB,OAAO,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;IACnC,CAAC;IAED,IAAI,CAAC,KAA0B;QAC7B,MAAM,QAAQ,GAAG,CAAC,KAAK,YAAY,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,aAAa,CAAC,QAAQ,EAAE,CAAC,OAAO,CAAC,CAAC,aAAyB,CAAC,CAAC;QAC7H,IAAI,CAAC,eAAe,GAAG,QAAQ,CAAC;QAChC,IAAI,CAAC,eAAe,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,6BAA6B,EAAE,IAAI,CAAC,CAAC;QAE3F,IAAI,MAAM,CAAC,SAAS,EAAE;YACpB,MAAM,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;SACzB;QACD,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,0BAA0B,CAAC,QAAQ,CAAC,CAAC;QAC1C,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACrB,IAAI,CAAC,cAAc,GAAG,IAAI,mBAAmB,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;IAC/D,CAAC;IAED,IAAI;QACF,IAAI,IAAI,CAAC,cAAc,EAAE;YACvB,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC;SAC/B;QACD,KAAK,CAAC,IAAI,EAAE,CAAC;QAEb,IAAI,IAAI,CAAC,eAAe,EAAE;YACxB,IAAI,CAAC,eAAe,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,6BAA6B,EAAE,IAAI,CAAC,CAAC;SAC/F;QACD,IAAI,CAAC,0BAA0B,EAAE,CAAC;QAClC,IAAI,CAAC,wBAAwB,CAAC,QAAQ,CAAC,CAAC;QACxC,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC;IAC1B,CAAC;IAED,gBAAgB,CAAC,KAAc;QAC7B,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;IAC9B,CAAC;IAED,oBAAoB,CAAC,QAA+B;QAClD,IAAI,CAAC,kBAAkB,GAAG,QAAQ,CAAC;IACrC,CAAC;IAED,cAAc;QACZ,MAAM,WAAW,GACZ,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,KAAK,EAAE,qBAAqB,EAAE,iBAAiB,CAAyB,CAAC;QAC9G,WAAW,CAAC,IAAI,GAAG,IAAI,CAAC;QACxB,WAAW,CAAC,gBAAgB,CAAC,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,KAAK,CAAC,CAAC;IAClE,CAAC;IAED,0BAA0B,CAAC,gBAAyC;QAClE,IAAI,CAAC,iBAAiB,GAAG,gBAAgB,CAAC;IAC5C,CAAC;IAED,0BAA0B,CAAC,QAAkB;QAC3C,IAAI,IAAI,CAAC,iBAAiB,KAAK,uBAAuB,CAAC,gBAAgB,EAAE;YACvE,OAAO;SACR;QAED,IAAI,YAAY,GAA+C,IAA+B,CAAC;QAC/F,IAAI,IAAI,CAAC,iBAAiB,KAAK,uBAAuB,CAAC,wBAAwB,EAAE;YAC/E,YAAY,GAAG,IAAI,CAAC,8BAA8B,CAAC,aAAa,CAAC,QAAQ,EAAE,CAAC,UAAU,EAAE,CAAC,CAAC;SAC3F;QAED,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC;QAC1B,IAAI,IAAI,GAAyB,QAAQ,CAAC;QAC1C,OAAO,IAAI,EAAE,IAAI,GAAG,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,EAAE;YACnD,IAAI,IAAI,YAAY,WAAW,EAAE;gBAC/B,MAAM,OAAO,GAAI,IAAoB,CAAC;gBACtC,MAAM,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;gBAClC,IAAI,QAAQ,IAAI,CAAC,IAAI,CAAC,CAAC,YAAY,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,EAAE;oBAClE,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;oBACzC,OAAO,CAAC,QAAQ,GAAG,CAAC,CAAC,CAAC;iBACvB;aACF;SACF;IACH,CAAC;IAED,8BAA8B,CAAC,WAA6B;QAC1D,MAAM,UAAU,GAAI,IAAI,GAAG,EAAuB,CAAC;QACnD,IAAI,CAAC,WAAW,EAAE;YAChB,OAAO,UAAU,CAAC;SACnB;QAED,MAAM,UAAU,GAAG,WAAW,CAAC,UAAU,EAAE,CAAC;QAC5C,IAAI,CAAC,UAAU,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE;YACtC,OAAO,UAAU,CAAC;SACnB;QAED,IAAI,IAAI,GAA4B,UAAU,CAAC,OAAO,CAAC;QACvD,OAAO,IAAI,EAAE,IAAI,GAAG,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE;YAC7D,IAAI,CAAC,CAAC,IAAI,YAAY,WAAW,CAAC,EAAE;gBAClC,SAAS;aACV;YAED,MAAM,OAAO,GAAI,IAAoB,CAAC;YACtC,MAAM,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;YAClC,IAAI,QAAQ,GAAG,CAAC,EAAE;gBAChB,SAAS;aACV;YAED,UAAU,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;SACzB;QAED,OAAO,UAAU,CAAC;IACpB,CAAC;IAED,0BAA0B;QACxB,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,EAAE;YAC9C,OAAO,CAAC,QAAQ,GAAI,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAY,CAAC;SAC/D;QACD,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC;IAC5B,CAAC;IAED,UAAU,CAAC,KAAY;QACrB,MAAM,aAAa,GAAI,KAAuB,CAAC;QAC/C,IAAI,aAAa,CAAC,OAAO,KAAK,IAAI,CAAC,GAAG,CAAC,IAAI,IAAI,gBAAgB,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;YACrF,IAAI,IAAI,CAAC,kBAAkB,EAAE;gBAC3B,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC;aAChC;YAED,IAAI,KAAK,CAAC,OAAO,EAAE;gBACjB,OAAO;aACR;YAED,IAAI,IAAI,CAAC,cAAc,EAAE;gBACvB,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;gBACpB,IAAI,CAAC,IAAI,EAAE,CAAC;aACb;SACF;IACH,CAAC;IAED,MAAM,CAAC,SAAS,GAAgB,IAAI,CAAC;;AAGvC,wDAAwD;AACxD,+CAA+C;AAC/C,MAAM,CAAN,IAAY,uBAIX;AAJD,WAAY,uBAAuB;IACjC,2EAAgD,CAAA;IAChD,gFAAqD,CAAA;IACrD,gEAAqC,CAAA;AACvC,CAAC,EAJW,uBAAuB,KAAvB,uBAAuB,QAIlC","sourcesContent":["/*\n * Copyright (C) 2012 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as ARIAUtils from './ARIAUtils.js';\nimport {GlassPane, PointerEventsBehavior} from './GlassPane.js';\nimport {InspectorView} from './InspectorView.js';\nimport {KeyboardShortcut, Keys} from './KeyboardShortcut.js';\nimport type {SplitWidget} from './SplitWidget.js';     // eslint-disable-line no-unused-vars\nimport type {DevToolsCloseButton} from './UIUtils.js'; // eslint-disable-line no-unused-vars\nimport type {WidgetElement} from './Widget.js';\nimport {WidgetFocusRestorer} from './Widget.js';\n\nexport class Dialog extends GlassPane {\n  _tabIndexBehavior: OutsideTabIndexBehavior;\n  _tabIndexMap: Map<HTMLElement, number>;\n  _focusRestorer: WidgetFocusRestorer|null;\n  _closeOnEscape: boolean;\n  _targetDocument!: Document|null;\n  _targetDocumentKeyDownHandler: (event: Event) => void;\n  _escapeKeyCallback: ((arg0: Event) => void)|null;\n\n  constructor() {\n    super();\n    this.registerRequiredCSS('ui/legacy/dialog.css', {enableLegacyPatching: false});\n    this.contentElement.tabIndex = 0;\n    this.contentElement.addEventListener('focus', () => this.widget().focus(), false);\n    this.widget().setDefaultFocusedElement(this.contentElement);\n    this.setPointerEventsBehavior(PointerEventsBehavior.BlockedByGlassPane);\n    this.setOutsideClickCallback(event => {\n      this.hide();\n      event.consume(true);\n    });\n    ARIAUtils.markAsModalDialog(this.contentElement);\n    this._tabIndexBehavior = OutsideTabIndexBehavior.DisableAllOutsideTabIndex;\n    this._tabIndexMap = new Map();\n    this._focusRestorer = null;\n    this._closeOnEscape = true;\n    this._targetDocumentKeyDownHandler = this._onKeyDown.bind(this);\n    this._escapeKeyCallback = null;\n  }\n\n  static hasInstance(): boolean {\n    return Boolean(Dialog._instance);\n  }\n\n  show(where?: Document | Element): void {\n    const document = (where instanceof Document ? where : (where || InspectorView.instance().element).ownerDocument as Document);\n    this._targetDocument = document;\n    this._targetDocument.addEventListener('keydown', this._targetDocumentKeyDownHandler, true);\n\n    if (Dialog._instance) {\n      Dialog._instance.hide();\n    }\n    Dialog._instance = this;\n    this._disableTabIndexOnElements(document);\n    super.show(document);\n    this._focusRestorer = new WidgetFocusRestorer(this.widget());\n  }\n\n  hide(): void {\n    if (this._focusRestorer) {\n      this._focusRestorer.restore();\n    }\n    super.hide();\n\n    if (this._targetDocument) {\n      this._targetDocument.removeEventListener('keydown', this._targetDocumentKeyDownHandler, true);\n    }\n    this._restoreTabIndexOnElements();\n    this.dispatchEventToListeners('hidden');\n    Dialog._instance = null;\n  }\n\n  setCloseOnEscape(close: boolean): void {\n    this._closeOnEscape = close;\n  }\n\n  setEscapeKeyCallback(callback: (arg0: Event) => void): void {\n    this._escapeKeyCallback = callback;\n  }\n\n  addCloseButton(): void {\n    const closeButton =\n        (this.contentElement.createChild('div', 'dialog-close-button', 'dt-close-button') as DevToolsCloseButton);\n    closeButton.gray = true;\n    closeButton.addEventListener('click', () => this.hide(), false);\n  }\n\n  setOutsideTabIndexBehavior(tabIndexBehavior: OutsideTabIndexBehavior): void {\n    this._tabIndexBehavior = tabIndexBehavior;\n  }\n\n  _disableTabIndexOnElements(document: Document): void {\n    if (this._tabIndexBehavior === OutsideTabIndexBehavior.PreserveTabIndex) {\n      return;\n    }\n\n    let exclusionSet: Set<HTMLElement>|(Set<HTMLElement>| null) = (null as Set<HTMLElement>| null);\n    if (this._tabIndexBehavior === OutsideTabIndexBehavior.PreserveMainViewTabIndex) {\n      exclusionSet = this._getMainWidgetTabIndexElements(InspectorView.instance().ownerSplit());\n    }\n\n    this._tabIndexMap.clear();\n    let node: (Node|null)|Document = document;\n    for (; node; node = node.traverseNextNode(document)) {\n      if (node instanceof HTMLElement) {\n        const element = (node as HTMLElement);\n        const tabIndex = element.tabIndex;\n        if (tabIndex >= 0 && (!exclusionSet || !exclusionSet.has(element))) {\n          this._tabIndexMap.set(element, tabIndex);\n          element.tabIndex = -1;\n        }\n      }\n    }\n  }\n\n  _getMainWidgetTabIndexElements(splitWidget: SplitWidget|null): Set<HTMLElement> {\n    const elementSet = (new Set() as Set<HTMLElement>);\n    if (!splitWidget) {\n      return elementSet;\n    }\n\n    const mainWidget = splitWidget.mainWidget();\n    if (!mainWidget || !mainWidget.element) {\n      return elementSet;\n    }\n\n    let node: Node|null|WidgetElement = mainWidget.element;\n    for (; node; node = node.traverseNextNode(mainWidget.element)) {\n      if (!(node instanceof HTMLElement)) {\n        continue;\n      }\n\n      const element = (node as HTMLElement);\n      const tabIndex = element.tabIndex;\n      if (tabIndex < 0) {\n        continue;\n      }\n\n      elementSet.add(element);\n    }\n\n    return elementSet;\n  }\n\n  _restoreTabIndexOnElements(): void {\n    for (const element of this._tabIndexMap.keys()) {\n      element.tabIndex = (this._tabIndexMap.get(element) as number);\n    }\n    this._tabIndexMap.clear();\n  }\n\n  _onKeyDown(event: Event): void {\n    const keyboardEvent = (event as KeyboardEvent);\n    if (keyboardEvent.keyCode === Keys.Esc.code && KeyboardShortcut.hasNoModifiers(event)) {\n      if (this._escapeKeyCallback) {\n        this._escapeKeyCallback(event);\n      }\n\n      if (event.handled) {\n        return;\n      }\n\n      if (this._closeOnEscape) {\n        event.consume(true);\n        this.hide();\n      }\n    }\n  }\n\n  static _instance: Dialog|null = null;\n}\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum OutsideTabIndexBehavior {\n  DisableAllOutsideTabIndex = 'DisableAllTabIndex',\n  PreserveMainViewTabIndex = 'PreserveMainViewTabIndex',\n  PreserveTabIndex = 'PreserveTabIndex',\n}\n"]}