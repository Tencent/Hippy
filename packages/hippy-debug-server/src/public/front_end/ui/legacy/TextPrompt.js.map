{"version":3,"file":"TextPrompt.js","sourceRoot":"","sources":["../../../../../../front_end/ui/legacy/TextPrompt.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/*\n * Copyright (C) 2008 Apple Inc.  All rights reserved.\n * Copyright (C) 2011 Google Inc.  All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Common from '../../core/common/common.js';\nimport * as DOMExtension from '../../core/dom_extension/dom_extension.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as TextUtils from '../../models/text_utils/text_utils.js';\n\nimport * as ARIAUtils from './ARIAUtils.js';\nimport type {SuggestBoxDelegate, Suggestion} from './SuggestBox.js';\nimport {SuggestBox} from './SuggestBox.js';  // eslint-disable-line no-unused-vars\nimport {Tooltip} from './Tooltip.js';\nimport {ElementFocusRestorer} from './UIUtils.js';\nimport {appendStyle} from './utils/append-style.js';\n\nexport class TextPrompt extends Common.ObjectWrapper.ObjectWrapper implements SuggestBoxDelegate {\n  _proxyElement!: HTMLElement|undefined;\n  _proxyElementDisplay: string;\n  _autocompletionTimeout: number;\n  _title: string;\n  _queryRange: TextUtils.TextRange.TextRange|null;\n  _previousText: string;\n  _currentSuggestion: Suggestion|null;\n  _completionRequestId: number;\n  _ghostTextElement: HTMLSpanElement;\n  _leftParenthesesIndices: number[];\n  _loadCompletions!: (this: null, arg1: string, arg2: string, arg3?: boolean|undefined) => Promise<Suggestion[]>;\n  _completionStopCharacters!: string;\n  _usesSuggestionBuilder!: boolean;\n  _element?: Element;\n  _boundOnKeyDown?: ((ev: Event) => void);\n  _boundOnInput?: ((ev: Event) => void);\n  _boundOnMouseWheel?: ((event: Event) => void);\n  _boundClearAutocomplete?: (() => void);\n  _contentElement?: HTMLElement;\n  _suggestBox?: SuggestBox;\n  _isEditing?: boolean;\n  _focusRestorer?: ElementFocusRestorer;\n  _blurListener?: ((arg0: Event) => void);\n  _oldTabIndex?: number;\n  _completeTimeout?: number;\n  _disableDefaultSuggestionForEmptyInput?: boolean;\n\n  constructor() {\n    super();\n    this._proxyElementDisplay = 'inline-block';\n    this._autocompletionTimeout = DefaultAutocompletionTimeout;\n    this._title = '';\n    this._queryRange = null;\n    this._previousText = '';\n    this._currentSuggestion = null;\n    this._completionRequestId = 0;\n    this._ghostTextElement = document.createElement('span');\n    this._ghostTextElement.classList.add('auto-complete-text');\n    this._ghostTextElement.setAttribute('contenteditable', 'false');\n    this._leftParenthesesIndices = [];\n    ARIAUtils.markAsHidden(this._ghostTextElement);\n  }\n\n  initialize(\n      completions: (this: null, arg1: string, arg2: string, arg3?: boolean|undefined) => Promise<Suggestion[]>,\n      stopCharacters?: string, usesSuggestionBuilder?: boolean): void {\n    this._loadCompletions = completions;\n    this._completionStopCharacters = stopCharacters || ' =:[({;,!+-*/&|^<>.';\n    this._usesSuggestionBuilder = usesSuggestionBuilder || false;\n  }\n\n  setAutocompletionTimeout(timeout: number): void {\n    this._autocompletionTimeout = timeout;\n  }\n\n  renderAsBlock(): void {\n    this._proxyElementDisplay = 'block';\n  }\n\n  /**\n   * Clients should never attach any event listeners to the |element|. Instead,\n   * they should use the result of this method to attach listeners for bubbling events.\n   */\n  attach(element: Element): Element {\n    return this._attachInternal(element);\n  }\n\n  /**\n   * Clients should never attach any event listeners to the |element|. Instead,\n   * they should use the result of this method to attach listeners for bubbling events\n   * or the |blurListener| parameter to register a \"blur\" event listener on the |element|\n   * (since the \"blur\" event does not bubble.)\n   */\n  attachAndStartEditing(element: Element, blurListener: (arg0: Event) => void): Element {\n    const proxyElement = this._attachInternal(element);\n    this._startEditing(blurListener);\n    return proxyElement;\n  }\n\n  _attachInternal(element: Element): Element {\n    if (this._proxyElement) {\n      throw 'Cannot attach an attached TextPrompt';\n    }\n    this._element = element;\n\n    this._boundOnKeyDown = this.onKeyDown.bind(this);\n    this._boundOnInput = this.onInput.bind(this);\n    this._boundOnMouseWheel = this.onMouseWheel.bind(this);\n    this._boundClearAutocomplete = this.clearAutocomplete.bind(this);\n    this._proxyElement = element.ownerDocument.createElement('span');\n    appendStyle(this._proxyElement, 'ui/legacy/textPrompt.css', {enableLegacyPatching: false});\n    this._contentElement = this._proxyElement.createChild('div', 'text-prompt-root');\n    this._proxyElement.style.display = this._proxyElementDisplay;\n    if (element.parentElement) {\n      element.parentElement.insertBefore(this._proxyElement, element);\n    }\n    this._contentElement.appendChild(element);\n    this._element.classList.add('text-prompt');\n    ARIAUtils.markAsTextBox(this._element);\n    ARIAUtils.setAutocomplete(this._element, ARIAUtils.AutocompleteInteractionModel.both);\n    ARIAUtils.setHasPopup(this._element, ARIAUtils.PopupRole.ListBox);\n    this._element.setAttribute('contenteditable', 'plaintext-only');\n    this.element().addEventListener('keydown', this._boundOnKeyDown, false);\n    this._element.addEventListener('input', this._boundOnInput, false);\n    this._element.addEventListener('wheel', this._boundOnMouseWheel, false);\n    this._element.addEventListener('selectstart', this._boundClearAutocomplete, false);\n    this._element.addEventListener('blur', this._boundClearAutocomplete, false);\n\n    this._suggestBox = new SuggestBox(this, 20);\n\n    if (this._title) {\n      Tooltip.install(this._proxyElement, this._title);\n    }\n\n    return this._proxyElement;\n  }\n\n  element(): HTMLElement {\n    if (!this._element) {\n      throw new Error('Expected an already attached element!');\n    }\n    return /** @type {!HTMLElement} */ this._element as HTMLElement;\n  }\n\n  detach(): void {\n    this._removeFromElement();\n    if (this._focusRestorer) {\n      this._focusRestorer.restore();\n    }\n    if (this._proxyElement && this._proxyElement.parentElement) {\n      this._proxyElement.parentElement.insertBefore(this.element(), this._proxyElement);\n      this._proxyElement.remove();\n    }\n    delete this._proxyElement;\n    this.element().classList.remove('text-prompt');\n    this.element().removeAttribute('contenteditable');\n    this.element().removeAttribute('role');\n    ARIAUtils.clearAutocomplete(this.element());\n    ARIAUtils.setHasPopup(this.element(), ARIAUtils.PopupRole.False);\n  }\n\n  textWithCurrentSuggestion(): string {\n    const text = this.text();\n    if (!this._queryRange || !this._currentSuggestion) {\n      return text;\n    }\n    const suggestion = this._currentSuggestion.text;\n    return text.substring(0, this._queryRange.startColumn) + suggestion + text.substring(this._queryRange.endColumn);\n  }\n\n  text(): string {\n    let text: string = this.element().textContent || '';\n    if (this._ghostTextElement.parentNode) {\n      const addition = this._ghostTextElement.textContent || '';\n      text = text.substring(0, text.length - addition.length);\n    }\n    return text;\n  }\n\n  setText(text: string): void {\n    this.clearAutocomplete();\n    this.element().textContent = text;\n    this._previousText = this.text();\n    if (this.element().hasFocus()) {\n      this.moveCaretToEndOfPrompt();\n      this.element().scrollIntoView();\n    }\n  }\n\n  setSelectedRange(startIndex: number, endIndex: number): void {\n    if (startIndex < 0) {\n      throw new RangeError('Selected range start must be a nonnegative integer');\n    }\n    const textContent = this.element().textContent;\n    const textContentLength = textContent ? textContent.length : 0;\n    if (endIndex > textContentLength) {\n      endIndex = textContentLength;\n    }\n    if (endIndex < startIndex) {\n      endIndex = startIndex;\n    }\n\n    const textNode = (this.element().childNodes[0] as Node);\n    const range = new Range();\n    range.setStart(textNode, startIndex);\n    range.setEnd(textNode, endIndex);\n    const selection = window.getSelection();\n    if (selection) {\n      selection.removeAllRanges();\n      selection.addRange(range);\n    }\n  }\n\n  focus(): void {\n    this.element().focus();\n  }\n\n  title(): string {\n    return this._title;\n  }\n\n  setTitle(title: string): void {\n    this._title = title;\n    if (this._proxyElement) {\n      Tooltip.install(this._proxyElement, title);\n    }\n  }\n\n  setPlaceholder(placeholder: string, ariaPlaceholder?: string): void {\n    if (placeholder) {\n      this.element().setAttribute('data-placeholder', placeholder);\n      // TODO(https://github.com/nvaccess/nvda/issues/10164): Remove ariaPlaceholder once the NVDA bug is fixed\n      // ariaPlaceholder and placeholder may differ, like in case the placeholder contains a '?'\n      ARIAUtils.setPlaceholder(this.element(), ariaPlaceholder || placeholder);\n    } else {\n      this.element().removeAttribute('data-placeholder');\n      ARIAUtils.setPlaceholder(this.element(), null);\n    }\n  }\n\n  setEnabled(enabled: boolean): void {\n    if (enabled) {\n      this.element().setAttribute('contenteditable', 'plaintext-only');\n    } else {\n      this.element().removeAttribute('contenteditable');\n    }\n    this.element().classList.toggle('disabled', !enabled);\n  }\n\n  _removeFromElement(): void {\n    this.clearAutocomplete();\n    this.element().removeEventListener(\n        'keydown', (this._boundOnKeyDown as (this: HTMLElement, arg1: Event) => void), false);\n    this.element().removeEventListener(\n        'input', (this._boundOnInput as (this: HTMLElement, arg1: Event) => void), false);\n    this.element().removeEventListener(\n        'selectstart', (this._boundClearAutocomplete as (this: HTMLElement, arg1: Event) => void), false);\n    this.element().removeEventListener(\n        'blur', (this._boundClearAutocomplete as (this: HTMLElement, arg1: Event) => void), false);\n    if (this._isEditing) {\n      this._stopEditing();\n    }\n    if (this._suggestBox) {\n      this._suggestBox.hide();\n    }\n  }\n\n  _startEditing(blurListener?: ((arg0: Event) => void)): void {\n    this._isEditing = true;\n    if (this._contentElement) {\n      this._contentElement.classList.add('text-prompt-editing');\n    }\n    this._focusRestorer = new ElementFocusRestorer(this.element());\n    if (blurListener) {\n      this._blurListener = blurListener;\n      this.element().addEventListener('blur', this._blurListener, false);\n    }\n    this._oldTabIndex = this.element().tabIndex;\n    if (this.element().tabIndex < 0) {\n      this.element().tabIndex = 0;\n    }\n    if (!this.text()) {\n      this.autoCompleteSoon();\n    }\n  }\n\n  _stopEditing(): void {\n    this.element().tabIndex = (this._oldTabIndex as number);\n    if (this._blurListener) {\n      this.element().removeEventListener('blur', this._blurListener, false);\n    }\n    if (this._contentElement) {\n      this._contentElement.classList.remove('text-prompt-editing');\n    }\n    delete this._isEditing;\n  }\n\n  onMouseWheel(_event: Event): void {\n    // Subclasses can implement.\n  }\n\n  onKeyDown(ev: Event): void {\n    let handled = false;\n    const event = (ev as KeyboardEvent);\n    if (this.isSuggestBoxVisible() && this._suggestBox && this._suggestBox.keyPressed(event)) {\n      event.consume(true);\n      return;\n    }\n\n    switch (event.key) {\n      case 'Tab':\n        handled = this.tabKeyPressed(event);\n        break;\n      case 'ArrowLeft':\n      case 'ArrowUp':\n      case 'PageUp':\n      case 'Home':\n        this.clearAutocomplete();\n        break;\n      case 'PageDown':\n      case 'ArrowRight':\n      case 'ArrowDown':\n      case 'End':\n        if (this._isCaretAtEndOfPrompt()) {\n          handled = this.acceptAutoComplete();\n        } else {\n          this.clearAutocomplete();\n        }\n        break;\n      case 'Escape':\n        if (this.isSuggestBoxVisible()) {\n          this.clearAutocomplete();\n          handled = true;\n        }\n        break;\n      case ' ':  // Space\n        if (event.ctrlKey && !event.metaKey && !event.altKey && !event.shiftKey) {\n          this.autoCompleteSoon(true);\n          handled = true;\n        }\n        break;\n    }\n\n    if (event.key === 'Enter') {\n      event.preventDefault();\n    }\n\n    if (handled) {\n      event.consume(true);\n    }\n  }\n\n  _acceptSuggestionOnStopCharacters(key: string): boolean {\n    if (!this._currentSuggestion || !this._queryRange || key.length !== 1 || !this._completionStopCharacters ||\n        !this._completionStopCharacters.includes(key)) {\n      return false;\n    }\n\n    const query = this.text().substring(this._queryRange.startColumn, this._queryRange.endColumn);\n    if (query && this._currentSuggestion.text.startsWith(query + key)) {\n      this._queryRange.endColumn += 1;\n      return this.acceptAutoComplete();\n    }\n    return false;\n  }\n\n  onInput(ev: Event): void {\n    const event = (ev as InputEvent);\n    let text = this.text();\n    const currentEntry = event.data;\n\n    if (event.inputType === 'insertFromPaste' && text.includes('\\n')) {\n      /* Ensure that we remove any linebreaks from copied/pasted content\n       * to avoid breaking the rendering of the filter bar.\n       * See crbug.com/849563.\n       * We don't let users enter linebreaks when\n       * typing manually, so we should escape them if copying text in.\n       */\n      text = Platform.StringUtilities.stripLineBreaks(text);\n      this.setText(text);\n    }\n\n    // Skip the current ')' entry if the caret is right before a ')' and there's an unmatched '('.\n    const caretPosition = this._getCaretPosition();\n    if (currentEntry === ')' && caretPosition >= 0 && this._leftParenthesesIndices.length > 0) {\n      const nextCharAtCaret = text[caretPosition];\n      if (nextCharAtCaret === ')' && this._tryMatchingLeftParenthesis(caretPosition)) {\n        text = text.substring(0, caretPosition) + text.substring(caretPosition + 1);\n        this.setText(text);\n        return;\n      }\n    }\n\n    if (currentEntry && !this._acceptSuggestionOnStopCharacters(currentEntry)) {\n      const hasCommonPrefix = text.startsWith(this._previousText) || this._previousText.startsWith(text);\n      if (this._queryRange && hasCommonPrefix) {\n        this._queryRange.endColumn += text.length - this._previousText.length;\n      }\n    }\n    this._refreshGhostText();\n    this._previousText = text;\n    this.dispatchEventToListeners(Events.TextChanged);\n\n    this.autoCompleteSoon();\n  }\n\n  acceptAutoComplete(): boolean {\n    let result = false;\n    if (this.isSuggestBoxVisible() && this._suggestBox) {\n      result = this._suggestBox.acceptSuggestion();\n    }\n    if (!result) {\n      result = this._acceptSuggestionInternal();\n    }\n    if (this._usesSuggestionBuilder && result) {\n      // Trigger autocompletions for text prompts using suggestion builders\n      this.autoCompleteSoon();\n    }\n    return result;\n  }\n\n  clearAutocomplete(): void {\n    const beforeText = this.textWithCurrentSuggestion();\n\n    if (this.isSuggestBoxVisible() && this._suggestBox) {\n      this._suggestBox.hide();\n    }\n    this._clearAutocompleteTimeout();\n    this._queryRange = null;\n    this._refreshGhostText();\n\n    if (beforeText !== this.textWithCurrentSuggestion()) {\n      this.dispatchEventToListeners(Events.TextChanged);\n    }\n  }\n\n  _refreshGhostText(): void {\n    if (this._currentSuggestion && this._currentSuggestion.hideGhostText) {\n      this._ghostTextElement.remove();\n      return;\n    }\n    if (this._queryRange && this._currentSuggestion && this._isCaretAtEndOfPrompt() &&\n        this._currentSuggestion.text.startsWith(this.text().substring(this._queryRange.startColumn))) {\n      this._ghostTextElement.textContent =\n          this._currentSuggestion.text.substring(this._queryRange.endColumn - this._queryRange.startColumn);\n      this.element().appendChild(this._ghostTextElement);\n    } else {\n      this._ghostTextElement.remove();\n    }\n  }\n\n  _clearAutocompleteTimeout(): void {\n    if (this._completeTimeout) {\n      clearTimeout(this._completeTimeout);\n      delete this._completeTimeout;\n    }\n    this._completionRequestId++;\n  }\n\n  autoCompleteSoon(force?: boolean): void {\n    const immediately = this.isSuggestBoxVisible() || force;\n    if (!this._completeTimeout) {\n      this._completeTimeout =\n          setTimeout(this.complete.bind(this, force), immediately ? 0 : this._autocompletionTimeout);\n    }\n  }\n\n  async complete(force?: boolean): Promise<void> {\n    this._clearAutocompleteTimeout();\n    const selection = this.element().getComponentSelection();\n    if (!selection || selection.rangeCount === 0) {\n      return;\n    }\n    const selectionRange = selection.getRangeAt(0);\n\n    let shouldExit;\n\n    if (!force && !this._isCaretAtEndOfPrompt() && !this.isSuggestBoxVisible()) {\n      shouldExit = true;\n    } else if (!selection.isCollapsed) {\n      shouldExit = true;\n    }\n\n    if (shouldExit) {\n      this.clearAutocomplete();\n      return;\n    }\n\n    const wordQueryRange = DOMExtension.DOMExtension.rangeOfWord(\n        selectionRange.startContainer, selectionRange.startOffset, this._completionStopCharacters, this.element(),\n        'backward');\n\n    const expressionRange = wordQueryRange.cloneRange();\n    expressionRange.collapse(true);\n    expressionRange.setStartBefore(this.element());\n    const completionRequestId = ++this._completionRequestId;\n    const completions =\n        await this._loadCompletions.call(null, expressionRange.toString(), wordQueryRange.toString(), Boolean(force));\n    this._completionsReady(completionRequestId, (selection as Selection), wordQueryRange, Boolean(force), completions);\n  }\n\n  disableDefaultSuggestionForEmptyInput(): void {\n    this._disableDefaultSuggestionForEmptyInput = true;\n  }\n\n  _boxForAnchorAtStart(selection: Selection, textRange: Range): AnchorBox {\n    const rangeCopy = selection.getRangeAt(0).cloneRange();\n    const anchorElement = document.createElement('span');\n    anchorElement.textContent = '\\u200B';\n    textRange.insertNode(anchorElement);\n    const box = anchorElement.boxInWindow(window);\n    anchorElement.remove();\n    selection.removeAllRanges();\n    selection.addRange(rangeCopy);\n    return box;\n  }\n\n  additionalCompletions(_query: string): Suggestion[] {\n    return [];\n  }\n\n  _completionsReady(\n      completionRequestId: number, selection: Selection, originalWordQueryRange: Range, force: boolean,\n      completions: Suggestion[]): void {\n    if (this._completionRequestId !== completionRequestId) {\n      return;\n    }\n\n    const query = originalWordQueryRange.toString();\n\n    // Filter out dupes.\n    const store = new Set<string>();\n    completions = completions.filter(item => !store.has(item.text) && Boolean(store.add(item.text)));\n\n    if (query || force) {\n      if (query) {\n        completions = completions.concat(this.additionalCompletions(query));\n      } else {\n        completions = this.additionalCompletions(query).concat(completions);\n      }\n    }\n\n    if (!completions.length) {\n      this.clearAutocomplete();\n      return;\n    }\n\n    const selectionRange = selection.getRangeAt(0);\n\n    const fullWordRange = document.createRange();\n    fullWordRange.setStart(originalWordQueryRange.startContainer, originalWordQueryRange.startOffset);\n    fullWordRange.setEnd(selectionRange.endContainer, selectionRange.endOffset);\n\n    if (query + selectionRange.toString() !== fullWordRange.toString()) {\n      return;\n    }\n\n    const beforeRange = document.createRange();\n    beforeRange.setStart(this.element(), 0);\n    beforeRange.setEnd(fullWordRange.startContainer, fullWordRange.startOffset);\n    this._queryRange = new TextUtils.TextRange.TextRange(\n        0, beforeRange.toString().length, 0, beforeRange.toString().length + fullWordRange.toString().length);\n\n    const shouldSelect = !this._disableDefaultSuggestionForEmptyInput || Boolean(this.text());\n    if (this._suggestBox) {\n      this._suggestBox.updateSuggestions(\n          this._boxForAnchorAtStart(selection, fullWordRange), completions, shouldSelect, !this._isCaretAtEndOfPrompt(),\n          this.text());\n    }\n  }\n\n  applySuggestion(suggestion: Suggestion|null, isIntermediateSuggestion?: boolean): void {\n    this._currentSuggestion = suggestion;\n    this._refreshGhostText();\n    if (isIntermediateSuggestion) {\n      this.dispatchEventToListeners(Events.TextChanged);\n    }\n  }\n\n  acceptSuggestion(): void {\n    this._acceptSuggestionInternal();\n  }\n\n  _acceptSuggestionInternal(): boolean {\n    if (!this._queryRange) {\n      return false;\n    }\n\n    const suggestionLength = this._currentSuggestion ? this._currentSuggestion.text.length : 0;\n    const selectionRange = this._currentSuggestion ? this._currentSuggestion.selectionRange : null;\n    const endColumn = selectionRange ? selectionRange.endColumn : suggestionLength;\n    const startColumn = selectionRange ? selectionRange.startColumn : suggestionLength;\n    this.element().textContent = this.textWithCurrentSuggestion();\n    this.setDOMSelection(this._queryRange.startColumn + startColumn, this._queryRange.startColumn + endColumn);\n    this._updateLeftParenthesesIndices();\n\n    this.clearAutocomplete();\n    this.dispatchEventToListeners(Events.TextChanged);\n\n    return true;\n  }\n\n  ariaControlledBy(): Element {\n    return this.element();\n  }\n\n  setDOMSelection(startColumn: number, endColumn: number): void {\n    this.element().normalize();\n    const node = this.element().childNodes[0];\n    if (!node || node === this._ghostTextElement) {\n      return;\n    }\n    const range = document.createRange();\n    range.setStart(node, startColumn);\n    range.setEnd(node, endColumn);\n    const selection = this.element().getComponentSelection();\n    if (selection) {\n      selection.removeAllRanges();\n      selection.addRange(range);\n    }\n  }\n\n  isSuggestBoxVisible(): boolean {\n    return this._suggestBox !== undefined && this._suggestBox.visible();\n  }\n\n  isCaretInsidePrompt(): boolean {\n    const selection = this.element().getComponentSelection();\n    if (!selection || selection.rangeCount === 0 || !selection.isCollapsed) {\n      return false;\n    }\n    // @see crbug.com/602541\n    const selectionRange = selection.getRangeAt(0);\n    return selectionRange.startContainer.isSelfOrDescendant(this.element());\n  }\n\n  _isCaretAtEndOfPrompt(): boolean {\n    const selection = this.element().getComponentSelection();\n    if (!selection || selection.rangeCount === 0 || !selection.isCollapsed) {\n      return false;\n    }\n\n    const selectionRange = selection.getRangeAt(0);\n    let node: (Node|null)|Node = selectionRange.startContainer;\n    if (!node.isSelfOrDescendant(this.element())) {\n      return false;\n    }\n\n    if (this._ghostTextElement.isAncestor(node)) {\n      return true;\n    }\n\n    if (node.nodeType === Node.TEXT_NODE && selectionRange.startOffset < (node.nodeValue || '').length) {\n      return false;\n    }\n\n    let foundNextText = false;\n    while (node) {\n      if (node.nodeType === Node.TEXT_NODE && node.nodeValue && node.nodeValue.length) {\n        if (foundNextText && !this._ghostTextElement.isAncestor(node)) {\n          return false;\n        }\n        foundNextText = true;\n      }\n\n      node = node.traverseNextNode(this._element);\n    }\n\n    return true;\n  }\n\n  moveCaretToEndOfPrompt(): void {\n    const selection = this.element().getComponentSelection();\n    const selectionRange = document.createRange();\n\n    let container: Node = this.element();\n    while (container.lastChild) {\n      container = container.lastChild;\n    }\n    let offset = 0;\n    if (container.nodeType === Node.TEXT_NODE) {\n      const textNode = (container as Text);\n      offset = (textNode.textContent || '').length;\n    }\n    selectionRange.setStart(container, offset);\n    selectionRange.setEnd(container, offset);\n\n    if (selection) {\n      selection.removeAllRanges();\n      selection.addRange(selectionRange);\n    }\n  }\n\n  /** -1 if no caret can be found in text prompt\n     */\n  _getCaretPosition(): number {\n    if (!this.element().hasFocus()) {\n      return -1;\n    }\n\n    const selection = this.element().getComponentSelection();\n    if (!selection || selection.rangeCount === 0 || !selection.isCollapsed) {\n      return -1;\n    }\n    const selectionRange = selection.getRangeAt(0);\n    if (selectionRange.startOffset !== selectionRange.endOffset) {\n      return -1;\n    }\n    return selectionRange.startOffset;\n  }\n\n  tabKeyPressed(_event: Event): boolean {\n    return this.acceptAutoComplete();\n  }\n\n  proxyElementForTests(): Element|null {\n    return this._proxyElement || null;\n  }\n\n  /**\n   * Try matching the most recent open parenthesis with the given right\n   * parenthesis, and closes the matched left parenthesis if found.\n   * Return the result of the matching.\n   */\n  _tryMatchingLeftParenthesis(rightParenthesisIndex: number): boolean {\n    const leftParenthesesIndices = this._leftParenthesesIndices;\n    if (leftParenthesesIndices.length === 0 || rightParenthesisIndex < 0) {\n      return false;\n    }\n\n    for (let i = leftParenthesesIndices.length - 1; i >= 0; --i) {\n      if (leftParenthesesIndices[i] < rightParenthesisIndex) {\n        leftParenthesesIndices.splice(i, 1);\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  _updateLeftParenthesesIndices(): void {\n    const text = this.text();\n    const leftParenthesesIndices: number[] = this._leftParenthesesIndices = [];\n    for (let i = 0; i < text.length; ++i) {\n      if (text[i] === '(') {\n        leftParenthesesIndices.push(i);\n      }\n    }\n  }\n}\n\nconst DefaultAutocompletionTimeout = 250;\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum Events {\n  TextChanged = 'TextChanged',\n}\n"]}