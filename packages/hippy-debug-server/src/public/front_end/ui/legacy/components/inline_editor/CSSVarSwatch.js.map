{"version":3,"file":"CSSVarSwatch.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/inline_editor/CSSVarSwatch.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as ComponentHelpers from '../../../components/helpers/helpers.js';\nimport * as LitHtml from '../../../lit-html/lit-html.js';\n\nconst UIStrings = {\n  /**\n  *@description Text displayed in a tooltip shown when hovering over a var() CSS function in the Styles pane when the custom property in this function does not exist. The parameter is the name of the property.\n  *@example {--my-custom-property-name} PH1\n  */\n  sIsNotDefined: '{PH1} is not defined',\n};\nconst str_ = i18n.i18n.registerUIStrings('ui/legacy/components/inline_editor/CSSVarSwatch.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst {render, html, Directives} = LitHtml;\n\nconst VARIABLE_FUNCTION_REGEX = /(var\\()(\\s*--[^,)]+)(.*)/;\n\ninterface SwatchRenderData {\n  text: string;\n  computedValue: string|null;\n  fromFallback: boolean;\n  onLinkActivate: (varialeName: string) => void;\n}\n\ninterface ParsedVariableFunction {\n  pre: string;\n  name: string;\n  post: string;\n}\n\nexport class CSSVarSwatch extends HTMLElement {\n  private readonly shadow = this.attachShadow({mode: 'open'});\n  private text: string = '';\n  private computedValue: string|null = null;\n  private fromFallback: boolean = false;\n  private onLinkActivate: (varialeName: string, event: MouseEvent|KeyboardEvent) => void = () => undefined;\n\n  constructor() {\n    super();\n\n    this.tabIndex = -1;\n\n    this.addEventListener('focus', () => {\n      const link = this.shadow.querySelector<HTMLElement>('[role=\"link\"]');\n\n      if (link) {\n        link.focus();\n      }\n    });\n  }\n\n  set data(data: SwatchRenderData) {\n    this.text = data.text;\n    this.computedValue = data.computedValue;\n    this.fromFallback = data.fromFallback;\n    this.onLinkActivate = (variableName: string, event: MouseEvent|KeyboardEvent): void => {\n      if (event instanceof MouseEvent && event.button !== 0) {\n        return;\n      }\n\n      if (event instanceof KeyboardEvent && !isEnterOrSpaceKey(event)) {\n        return;\n      }\n\n      data.onLinkActivate(variableName);\n      event.consume(true);\n    };\n    this.render();\n  }\n\n  private parseVariableFunctionParts(): ParsedVariableFunction|null {\n    // When the value of CSS var() is greater than two spaces, only one is\n    // always displayed, and the actual number of spaces is displayed when\n    // editing is clicked.\n    const result = this.text.replace(/\\s{2,}/g, ' ').match(VARIABLE_FUNCTION_REGEX);\n    if (!result) {\n      return null;\n    }\n\n    return {\n      pre: result[1],\n      name: result[2],\n      post: result[3],\n    };\n  }\n\n  private get variableName(): string {\n    const match = this.text.match(/--[^,)]+/);\n    if (match) {\n      return match[0];\n    }\n    return '';\n  }\n\n  private renderLink(variableName: string): LitHtml.TemplateResult {\n    const isDefined = this.computedValue && !this.fromFallback;\n\n    const classes = Directives.classMap({\n      'css-var-link': true,\n      'undefined': !isDefined,\n    });\n    const title = isDefined ? this.computedValue : i18nString(UIStrings.sIsNotDefined, {PH1: variableName});\n    // The this.variableName's space must be removed, otherwise it cannot be triggered when clicked.\n    const onActivate = isDefined ? this.onLinkActivate.bind(this, this.variableName.trim()) : null;\n\n    return html`<span class=\"${classes}\" title=\"${title}\" @mousedown=${onActivate} @keydown=${\n        onActivate} role=\"link\" tabindex=\"-1\">${variableName}</span>`;\n  }\n\n  private render(): void {\n    const functionParts = this.parseVariableFunctionParts();\n    if (!functionParts) {\n      render('', this.shadow, {host: this});\n      return;\n    }\n\n    const link = this.renderLink(functionParts.name);\n\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    render(\n      html`<style>\n      .css-var-link:not(.undefined) {\n        cursor: pointer;\n        text-underline-offset: 2px;\n        color: var(--color-link);\n      }\n\n      .css-var-link:hover:not(.undefined) {\n        text-decoration: underline;\n      }\n\n      .css-var-link:focus:not(:focus-visible) {\n        outline: none;\n      }\n\n      .css-var-link.undefined {\n        /* stylelint-disable-next-line plugin/use_theme_colors */\n        color: hsl(0deg 0% 46%);\n      }\n      </style><span title=\"${this.computedValue || ''}\">${functionParts.pre}${link}${functionParts.post}</span>`,\n      this.shadow, { host: this });\n    // clang-format on\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('devtools-css-var-swatch', CSSVarSwatch);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-css-var-swatch': CSSVarSwatch;\n  }\n}\n"]}