{"version":3,"file":"QuickPick.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/quick_open/QuickPick.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Diff from '../../../../third_party/diff/diff.js';\nimport * as UI from '../../legacy.js';  // eslint-disable-line no-unused-vars\nimport {FilteredListWidget, Provider} from './FilteredListWidget.js';\nexport interface QuickPickItem {\n  label: string;\n  description?: string;\n  detail?: string;\n}\nexport interface QuickPickOptions {\n  placeHolder: string;\n  matchOnDescription?: boolean;\n  matchOnDetail?: boolean;\n}\n\nexport class QuickPick {\n  private constructor() {\n    throw new ReferenceError('Instance type not implemented.');\n  }\n\n  static show(items: QuickPickItem[], options: QuickPickOptions): Promise<QuickPickItem|undefined> {\n    let canceledPromise: Promise<undefined> =\n        new Promise<undefined>(_r => {});  // Intentionally creates an unresolved promise\n    const fulfilledPromise = new Promise<QuickPickItem>(resolve => {\n      const provider =\n          new QuickPickProvider(items, resolve, options.matchOnDescription ? 0.5 : 0, options.matchOnDetail ? 0.25 : 0);\n      const widget = new FilteredListWidget(provider);\n      widget.setPlaceholder(options.placeHolder);\n      widget.setPromptTitle(options.placeHolder);\n      widget.showAsDialog(options.placeHolder);\n      canceledPromise = (widget.once('hidden') as Promise<undefined>);\n      widget.setQuery('');\n    });\n\n    return Promise.race([fulfilledPromise, canceledPromise]).then(values => {\n      // If it was fulfilled, then `result` will have a value.\n      // If it was canceled, then `result` will be undefined.\n      // Either way, it has the value that we want.\n      return values;\n    });\n  }\n}\n\nclass QuickPickProvider extends Provider {\n  _resolve: Function;\n  _items: QuickPickItem[];\n  _matchOnDescription: number;\n  _matchOnDetail: number;\n  constructor(\n      items: QuickPickItem[], resolve: Function, matchOnDescription: number|undefined = 0.5,\n      matchOnDetail: number|undefined = 0.25) {\n    super();\n    this._resolve = resolve;\n    this._items = items;\n    this._matchOnDescription = matchOnDescription;\n    this._matchOnDetail = matchOnDetail;\n  }\n\n  itemCount(): number {\n    return this._items.length;\n  }\n\n  itemKeyAt(itemIndex: number): string {\n    const item = this._items[itemIndex];\n    let key = item.label;\n    if (this._matchOnDescription) {\n      key += ' ' + item.description;\n    }\n    if (this._matchOnDetail) {\n      key += ' ' + item.detail;\n    }\n    return key;\n  }\n\n  itemScoreAt(itemIndex: number, query: string): number {\n    const item = this._items[itemIndex];\n    const test = query.toLowerCase();\n    let score = Diff.Diff.DiffWrapper.characterScore(test, item.label.toLowerCase());\n\n    if (this._matchOnDescription && item.description) {\n      const descriptionScore = Diff.Diff.DiffWrapper.characterScore(test, item.description.toLowerCase());\n      score += descriptionScore * this._matchOnDescription;\n    }\n\n    if (this._matchOnDetail && item.detail) {\n      const detailScore = Diff.Diff.DiffWrapper.characterScore(test, item.detail.toLowerCase());\n      score += detailScore * this._matchOnDetail;\n    }\n\n    return score;\n  }\n\n  renderItem(itemIndex: number, query: string, titleElement: Element, subtitleElement: Element): void {\n    const item = this._items[itemIndex];\n    titleElement.removeChildren();\n    const labelElement = titleElement.createChild('span');\n    UI.UIUtils.createTextChild(labelElement, item.label);\n    FilteredListWidget.highlightRanges(titleElement, query, true);\n    if (item.description) {\n      const descriptionElement = titleElement.createChild('span', 'quickpick-description');\n      UI.UIUtils.createTextChild(descriptionElement, item.description);\n      if (this._matchOnDescription) {\n        FilteredListWidget.highlightRanges(descriptionElement, query, true);\n      }\n    }\n    if (item.detail) {\n      UI.UIUtils.createTextChild(subtitleElement, item.detail);\n      if (this._matchOnDetail) {\n        FilteredListWidget.highlightRanges(subtitleElement, query, true);\n      }\n    }\n  }\n\n  renderAsTwoRows(): boolean {\n    return this._items.some(i => Boolean(i.detail));\n  }\n\n  selectItem(itemIndex: number|null, _promptValue: string): void {\n    if (typeof itemIndex === 'number') {\n      this._resolve(this._items[itemIndex]);\n      return;\n    }\n\n    this._resolve(undefined);\n  }\n}\n"]}