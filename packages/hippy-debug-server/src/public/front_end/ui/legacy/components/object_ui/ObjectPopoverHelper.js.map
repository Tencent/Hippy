{"version":3,"file":"ObjectPopoverHelper.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/object_ui/ObjectPopoverHelper.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA4BG;AAEH,uDAAuD;AAEvD,OAAO,KAAK,QAAQ,MAAM,uCAAuC,CAAC;AAClE,OAAO,KAAK,GAAG,MAAM,6BAA6B,CAAC;AACnD,OAAO,KAAK,EAAE,MAAM,iBAAiB,CAAC;AACtC,OAAO,KAAK,UAAU,MAAM,mBAAmB,CAAC;AAEhD,OAAO,EAAC,sBAAsB,EAAC,MAAM,6BAA6B,CAAC;AACnE,OAAO,EAAC,uBAAuB,EAAC,MAAM,8BAA8B,CAAC;AAErE,MAAM,OAAO,mBAAmB;IAC9B,UAAU,CAAsC;IAChD,uBAAuB,CAAU;IACjC,YAAY,SAA8C,EAAE,sBAA+B;QACzF,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;QAC5B,IAAI,CAAC,uBAAuB,GAAG,sBAAsB,CAAC;IACxD,CAAC;IAED,OAAO;QACL,IAAI,IAAI,CAAC,uBAAuB,EAAE;YAChC,GAAG,CAAC,YAAY,CAAC,YAAY,CAAC,oBAAoB,EAAE,CAAC;SACtD;QACD,IAAI,IAAI,CAAC,UAAU,EAAE;YACnB,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC;SAC3B;IACH,CAAC;IAED,MAAM,CAAC,KAAK,CAAC,kBAAkB,CAAC,MAAqC,EAAE,OAA+B;QAEpG,MAAM,WAAW,GAAG,QAAQ,CAAC,eAAe,CAAC,oBAAoB,CAAC,MAAM,CAAC,WAAW,IAAI,EAAE,EAAE,oBAAoB,CAAC,CAAC;QAClH,IAAI,qBAAqB,GAAwC,IAAI,CAAC;QACtE,IAAI,MAAM,CAAC,IAAI,KAAK,QAAQ,EAAE;YAC5B,IAAI,SAAS,GAAwC,IAAI,CAAC;YAC1D,IAAI,sBAAsB,GAAG,KAAK,CAAC;YACnC,IAAI,MAAM,CAAC,OAAO,KAAK,MAAM,EAAE;gBAC7B,GAAG,CAAC,YAAY,CAAC,YAAY,CAAC,wBAAwB,CAAC,MAAM,CAAC,CAAC;gBAC/D,sBAAsB,GAAG,IAAI,CAAC;aAC/B;YAED,IAAI,MAAM,CAAC,aAAa,EAAE,EAAE;gBAC1B,MAAM,sBAAsB,GAAG,IAAI,sBAAsB,CAAC,MAAM,CAAC,CAAC;gBAClE,sBAAsB,CAAC,gBAAgB,EAAE,CAAC;gBAC1C,qBAAqB,GAAG,sBAAsB,CAAC,OAAO,CAAC;aACxD;iBAAM;gBACL,qBAAqB,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;gBACtD,qBAAqB,CAAC,SAAS,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC;gBAC9D,EAAE,CAAC,KAAK,CAAC,WAAW,CAChB,qBAAqB,EAAE,kDAAkD,EAAE,EAAC,oBAAoB,EAAE,KAAK,EAAC,CAAC,CAAC;gBAC9G,MAAM,YAAY,GAAG,qBAAqB,CAAC,WAAW,CAAC,KAAK,EAAE,gCAAgC,CAAC,CAAC;gBAChG,YAAY,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,WAAW,GAAG,WAAW,CAAC;gBAC3D,SAAS,GAAG,IAAI,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC;gBACjD,MAAM,OAAO,GAAG,IAAI,uBAAuB,CACvC,MAAM,EAAE,EAAE,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;gBACrF,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;gBACrD,OAAO,CAAC,aAAa,EAAE,CAAC;gBACxB,qBAAqB,CAAC,WAAW,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;aACpD;YACD,qBAAqB,CAAC,OAAO,CAAC,iBAAiB,GAAG,wBAAwB,CAAC;YAC3E,OAAO,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC;YAC1D,OAAO,CAAC,eAAe,CAAC,EAAE,CAAC,SAAS,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;YAChE,OAAO,CAAC,cAAc,CAAC,WAAW,CAAC,qBAAqB,CAAC,CAAC;YAC1D,OAAO,IAAI,mBAAmB,CAAC,SAAS,EAAE,sBAAsB,CAAC,CAAC;SACnE;QAED,qBAAqB,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QACvD,qBAAqB,CAAC,OAAO,CAAC,iBAAiB,GAAG,wBAAwB,CAAC;QAC3E,EAAE,CAAC,KAAK,CAAC,WAAW,CAChB,qBAAqB,EAAE,gDAAgD,EAAE,EAAC,oBAAoB,EAAE,KAAK,EAAC,CAAC,CAAC;QAC5G,EAAE,CAAC,KAAK,CAAC,WAAW,CAChB,qBAAqB,EAAE,kDAAkD,EAAE,EAAC,oBAAoB,EAAE,KAAK,EAAC,CAAC,CAAC;QAC9G,MAAM,YAAY,GAAG,qBAAqB,CAAC,WAAW,CAAC,MAAM,EAAE,yBAAyB,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;QACxG,YAAY,CAAC,KAAK,CAAC,UAAU,GAAG,KAAK,CAAC;QAEtC,IAAI,MAAM,CAAC,IAAI,KAAK,QAAQ,EAAE;YAC5B,EAAE,CAAC,OAAO,CAAC,kBAAkB,CAAC,YAAY,EAAE,IAAI,WAAW,GAAG,CAAC,CAAC;SACjE;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,UAAU,EAAE;YACrC,YAAY,CAAC,WAAW,GAAG,WAAW,CAAC;SACxC;QAED,IAAI,MAAM,CAAC,IAAI,KAAK,UAAU,EAAE;YAC9B,OAAO,CAAC,cAAc,CAAC,WAAW,CAAC,qBAAqB,CAAC,CAAC;YAC1D,OAAO,IAAI,mBAAmB,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;SAC7C;QAED,uBAAuB,CAAC,sBAAsB,CAAC,MAAM,EAAE,YAAY,EAAE,IAAI,CAAC,CAAC;QAC3E,MAAM,QAAQ,GAAG,MAAM,MAAM,CAAC,aAAa,EAAE,CAAC,sBAAsB,CAAC,MAAM,CAAC,CAAC;QAC7E,IAAI,CAAC,QAAQ,EAAE;YACb,OAAO,IAAI,CAAC;SACb;QAED,MAAM,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAChD,SAAS,CAAC,SAAS,CAAC,GAAG,CAAC,0BAA0B,CAAC,CAAC;QACpD,MAAM,KAAK,GAAG,SAAS,CAAC,WAAW,CAAC,KAAK,EAAE,oCAAoC,CAAC,CAAC;QACjF,MAAM,YAAY,GAAG,KAAK,CAAC,WAAW,CAAC,MAAM,EAAE,eAAe,CAAC,CAAC;QAChE,YAAY,CAAC,WAAW,GAAG,EAAE,CAAC,OAAO,CAAC,oBAAoB,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;QAElF,MAAM,WAAW,GAAG,QAAQ,CAAC,QAAQ,CAAC;QACtC,MAAM,aAAa,GAAG,KAAK,CAAC,WAAW,CAAC,KAAK,EAAE,+BAA+B,CAAC,CAAC;QAChF,MAAM,MAAM,GAAG,WAAW,IAAI,WAAW,CAAC,MAAM,EAAE,CAAC;QACnD,MAAM,SAAS,GAAG,MAAM,IAAI,MAAM,CAAC,SAAS,CAAC;QAC7C,IAAI,SAAS,GAAwC,IAAI,CAAC;QAC1D,IAAI,SAAS,EAAE;YACb,SAAS,GAAG,IAAI,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC,SAAS,EAAE,SAAS,EAAE,OAAO,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;YAC5G,aAAa,CAAC,WAAW,CAAC,SAAS,CAAC,kBAAkB,CAAE,WAA0C,EAAE,SAAS,CAAC,CAAC,CAAC;SACjH;QACD,SAAS,CAAC,WAAW,CAAC,qBAAqB,CAAC,CAAC;QAC7C,OAAO,CAAC,cAAc,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;QAC9C,OAAO,IAAI,mBAAmB,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;IACnD,CAAC;CACF;AAED,MAAM,oBAAoB,GAAG,KAAK,CAAC","sourcesContent":["/*\n * Copyright (C) 2011 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Platform from '../../../../core/platform/platform.js';\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport * as UI from '../../legacy.js';\nimport * as Components from '../utils/utils.js';\n\nimport {CustomPreviewComponent} from './CustomPreviewComponent.js';\nimport {ObjectPropertiesSection} from './ObjectPropertiesSection.js';\n\nexport class ObjectPopoverHelper {\n  _linkifier: Components.Linkifier.Linkifier|null;\n  _resultHighlightedAsDOM: boolean;\n  constructor(linkifier: Components.Linkifier.Linkifier|null, resultHighlightedAsDOM: boolean) {\n    this._linkifier = linkifier;\n    this._resultHighlightedAsDOM = resultHighlightedAsDOM;\n  }\n\n  dispose(): void {\n    if (this._resultHighlightedAsDOM) {\n      SDK.OverlayModel.OverlayModel.hideDOMNodeHighlight();\n    }\n    if (this._linkifier) {\n      this._linkifier.dispose();\n    }\n  }\n\n  static async buildObjectPopover(result: SDK.RemoteObject.RemoteObject, popover: UI.GlassPane.GlassPane):\n      Promise<ObjectPopoverHelper|null> {\n    const description = Platform.StringUtilities.trimEndWithMaxLength(result.description || '', MaxPopoverTextLength);\n    let popoverContentElement: HTMLSpanElement|HTMLDivElement|null = null;\n    if (result.type === 'object') {\n      let linkifier: Components.Linkifier.Linkifier|null = null;\n      let resultHighlightedAsDOM = false;\n      if (result.subtype === 'node') {\n        SDK.OverlayModel.OverlayModel.highlightObjectAsDOMNode(result);\n        resultHighlightedAsDOM = true;\n      }\n\n      if (result.customPreview()) {\n        const customPreviewComponent = new CustomPreviewComponent(result);\n        customPreviewComponent.expandIfPossible();\n        popoverContentElement = customPreviewComponent.element;\n      } else {\n        popoverContentElement = document.createElement('div');\n        popoverContentElement.classList.add('object-popover-content');\n        UI.Utils.appendStyle(\n            popoverContentElement, 'ui/legacy/components/object_ui/objectPopover.css', {enableLegacyPatching: false});\n        const titleElement = popoverContentElement.createChild('div', 'monospace object-popover-title');\n        titleElement.createChild('span').textContent = description;\n        linkifier = new Components.Linkifier.Linkifier();\n        const section = new ObjectPropertiesSection(\n            result, '', linkifier, undefined, undefined, undefined, true /* showOverflow */);\n        section.element.classList.add('object-popover-tree');\n        section.titleLessMode();\n        popoverContentElement.appendChild(section.element);\n      }\n      popoverContentElement.dataset.stableNameForTest = 'object-popover-content';\n      popover.setMaxContentSize(new UI.Geometry.Size(300, 250));\n      popover.setSizeBehavior(UI.GlassPane.SizeBehavior.SetExactSize);\n      popover.contentElement.appendChild(popoverContentElement);\n      return new ObjectPopoverHelper(linkifier, resultHighlightedAsDOM);\n    }\n\n    popoverContentElement = document.createElement('span');\n    popoverContentElement.dataset.stableNameForTest = 'object-popover-content';\n    UI.Utils.appendStyle(\n        popoverContentElement, 'ui/legacy/components/object_ui/objectValue.css', {enableLegacyPatching: false});\n    UI.Utils.appendStyle(\n        popoverContentElement, 'ui/legacy/components/object_ui/objectPopover.css', {enableLegacyPatching: false});\n    const valueElement = popoverContentElement.createChild('span', 'monospace object-value-' + result.type);\n    valueElement.style.whiteSpace = 'pre';\n\n    if (result.type === 'string') {\n      UI.UIUtils.createTextChildren(valueElement, `\"${description}\"`);\n    } else if (result.type !== 'function') {\n      valueElement.textContent = description;\n    }\n\n    if (result.type !== 'function') {\n      popover.contentElement.appendChild(popoverContentElement);\n      return new ObjectPopoverHelper(null, false);\n    }\n\n    ObjectPropertiesSection.formatObjectAsFunction(result, valueElement, true);\n    const response = await result.debuggerModel().functionDetailsPromise(result);\n    if (!response) {\n      return null;\n    }\n\n    const container = document.createElement('div');\n    container.classList.add('object-popover-container');\n    const title = container.createChild('div', 'function-popover-title source-code');\n    const functionName = title.createChild('span', 'function-name');\n    functionName.textContent = UI.UIUtils.beautifyFunctionName(response.functionName);\n\n    const rawLocation = response.location;\n    const linkContainer = title.createChild('div', 'function-title-link-container');\n    const script = rawLocation && rawLocation.script();\n    const sourceURL = script && script.sourceURL;\n    let linkifier: Components.Linkifier.Linkifier|null = null;\n    if (sourceURL) {\n      linkifier = new Components.Linkifier.Linkifier(undefined, undefined, popover.positionContent.bind(popover));\n      linkContainer.appendChild(linkifier.linkifyRawLocation((rawLocation as SDK.DebuggerModel.Location), sourceURL));\n    }\n    container.appendChild(popoverContentElement);\n    popover.contentElement.appendChild(container);\n    return new ObjectPopoverHelper(linkifier, false);\n  }\n}\n\nconst MaxPopoverTextLength = 10000;\n"]}