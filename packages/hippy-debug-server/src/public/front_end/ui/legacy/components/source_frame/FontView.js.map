{"version":3,"file":"FontView.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/source_frame/FontView.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B;;;;;;;;;;;;;;;;;;;;;;;;;;GA0BG;AAEH,uDAAuD;AAEvD,OAAO,KAAK,IAAI,MAAM,+BAA+B,CAAC;AACtD,OAAO,KAAK,QAAQ,MAAM,uCAAuC,CAAC;AAClE,OAAO,KAAK,SAAS,MAAM,6CAA6C,CAAC;AACzE,OAAO,KAAK,EAAE,MAAM,iBAAiB,CAAC;AAEtC,MAAM,SAAS,GAAG;IAChB;;MAEE;IACF,IAAI,EAAE,MAAM;IACZ;;;MAGE;IACF,kBAAkB,EAAE,4BAA4B;CACjD,CAAC;AACF,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,+CAA+C,EAAE,SAAS,CAAC,CAAC;AACrG,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;AACtE,MAAM,OAAO,QAAS,SAAQ,EAAE,CAAC,IAAI,CAAC,UAAU;IAC9C,IAAI,CAAS;IACb,SAAS,CAAS;IAClB,gBAAgB,CAA4C;IAC5D,cAAc,CAAyB;IACvC,kBAAkB,CAAoB;IACtC,aAAa,CAAoB;IACjC,gBAAgB,CAAyB;IACzC,SAAS,CAAgB;IACzB,YAAY,QAAgB,EAAE,eAA0D;QACtF,KAAK,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;QAClC,IAAI,CAAC,mBAAmB,CAAC,gDAAgD,EAAE,EAAC,oBAAoB,EAAE,KAAK,EAAC,CAAC,CAAC;QAC1G,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;QACxC,IAAI,CAAC,IAAI,GAAG,eAAe,CAAC,UAAU,EAAE,CAAC;QACzC,EAAE,CAAC,SAAS,CAAC,iBAAiB,CAAC,IAAI,CAAC,OAAO,EAAE,UAAU,CAAC,SAAS,CAAC,kBAAkB,EAAE,EAAC,GAAG,EAAE,IAAI,CAAC,IAAI,EAAC,CAAC,CAAC,CAAC;QACzG,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;QAC1B,IAAI,CAAC,gBAAgB,GAAG,eAAe,CAAC;QACxC,IAAI,CAAC,cAAc,GAAG,IAAI,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;IAC7D,CAAC;IAED,KAAK,CAAC,YAAY;QAChB,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IAC/B,CAAC;IAED,oBAAoB,CAAC,cAAsB,EAAE,eAA0D;QACrG,MAAM,EAAC,OAAO,EAAC,GAAG,eAAe,CAAC;QAClC,MAAM,GAAG,GAAG,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC,eAAe,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC;QAC5G,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE;YAC1B,OAAO;SACR;QACD,IAAI,CAAC,gBAAgB,CAAC,WAAW;YAC7B,QAAQ,CAAC,eAAe,CAAC,OAAO,CAAC,iDAAiD,EAAE,cAAc,EAAE,GAAG,CAAC,CAAC;QAC7G,IAAI,CAAC,qBAAqB,EAAE,CAAC;IAC/B,CAAC;IAED,sBAAsB;QACpB,IAAI,IAAI,CAAC,kBAAkB,EAAE;YAC3B,OAAO;SACR;QAED,MAAM,cAAc,GAAG,yBAAyB,GAAG,CAAC,EAAE,OAAO,CAAC,CAAC;QAC/D,IAAI,CAAC,gBAAgB,GAAI,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAsB,CAAC;QAC9E,IAAI,CAAC,gBAAgB,CAAC,cAAc,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,EAAE;YAC5D,IAAI,CAAC,oBAAoB,CAAC,cAAc,EAAE,eAAe,CAAC,CAAC;QAC7D,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAEhD,MAAM,WAAW,GAAI,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAoB,CAAC;QACtE,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,iBAAiB,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;YACjD,IAAI,CAAC,GAAG,CAAC,EAAE;gBACT,WAAW,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;aAC/B;YACD,EAAE,CAAC,OAAO,CAAC,eAAe,CAAC,WAAW,EAAE,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;SAC/D;QACD,IAAI,CAAC,kBAAkB,GAAI,WAAW,CAAC,SAAS,CAAC,IAAI,CAAoB,CAAC;QAC1E,IAAI,CAAC,IAAI,CAAC,kBAAkB,EAAE;YAC5B,OAAO;SACR;QACD,EAAE,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QACnD,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,QAAQ,GAAG,QAAQ,CAAC;QAClD,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,WAAW,CAAC,aAAa,EAAE,cAAc,CAAC,CAAC;QACzE,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,WAAW,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC;QAElE,IAAI,CAAC,aAAa,GAAG,WAAW,CAAC;QACjC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,UAAU,GAAG,QAAQ,CAAC;QAC/C,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC;QACvC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,OAAO,GAAG,QAAQ,CAAC;QAC5C,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;QAC/C,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,WAAW,CAAC,aAAa,EAAE,cAAc,CAAC,CAAC;QACpE,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,WAAW,CAAC,WAAW,EAAE,gBAAgB,GAAG,IAAI,CAAC,CAAC;QAE3E,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;IACpD,CAAC;IAED,QAAQ;QACN,IAAI,CAAC,sBAAsB,EAAE,CAAC;QAE9B,IAAI,CAAC,qBAAqB,EAAE,CAAC;IAC/B,CAAC;IAED,QAAQ;QACN,IAAI,IAAI,CAAC,SAAS,EAAE;YAClB,OAAO;SACR;QAED,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI;YACF,IAAI,CAAC,qBAAqB,EAAE,CAAC;SAC9B;gBAAS;YACR,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;SACvB;IACH,CAAC;IAED,eAAe;QAIb,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;YACvB,MAAM,IAAI,KAAK,CAAC,wBAAwB,CAAC,CAAC;SAC3C;QACD,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC7C,MAAM,MAAM,GAAG,EAAC,KAAK,EAAE,IAAI,CAAC,aAAa,CAAC,WAAW,EAAE,MAAM,EAAE,IAAI,CAAC,aAAa,CAAC,YAAY,EAAC,CAAC;QAChG,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAE7C,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,qBAAqB;QACnB,IAAI,CAAC,IAAI,CAAC,kBAAkB,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE;YACjD,OAAO;SACR;QAED,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,cAAc,CAAC,YAAY,CAAC,CAAC;QAC3D,MAAM,SAAS,GAAG,IAAI,CAAC,eAAe,EAAE,CAAC;QAEzC,MAAM,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC;QAChC,MAAM,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC;QAE9B,gGAAgG;QAChG,MAAM,cAAc,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,GAAG,EAAE,CAAC;QACrD,MAAM,eAAe,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,GAAG,EAAE,CAAC;QAEvD,IAAI,CAAC,MAAM,IAAI,CAAC,KAAK,IAAI,CAAC,cAAc,IAAI,CAAC,eAAe,EAAE;YAC5D,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;YAC1D,OAAO;SACR;QAED,MAAM,UAAU,GAAG,cAAc,GAAG,KAAK,CAAC;QAC1C,MAAM,WAAW,GAAG,eAAe,GAAG,MAAM,CAAC;QAC7C,MAAM,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,gBAAgB,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,WAAW,CAAC,CAAC,GAAG,CAAC,CAAC;QAE3F,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,WAAW,CAAC,WAAW,EAAE,aAAa,GAAG,IAAI,EAAE,SAAS,CAAC,CAAC;IAC1F,CAAC;CACF;AAED,oEAAoE;AACpE,gEAAgE;AAChE,IAAI,OAAO,GAAG,CAAC,CAAC;AAEhB,oEAAoE;AACpE,gEAAgE;AAChE,MAAM,iBAAiB,GAAG,CAAC,eAAe,EAAE,eAAe,EAAE,eAAe,EAAE,eAAe,EAAE,YAAY,CAAC,CAAC;AAE7G,oEAAoE;AACpE,gEAAgE;AAChE,MAAM,gBAAgB,GAAG,EAAE,CAAC","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/*\n * Copyright (C) 2007, 2008 Apple Inc.  All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as Platform from '../../../../core/platform/platform.js';\nimport * as TextUtils from '../../../../models/text_utils/text_utils.js';\nimport * as UI from '../../legacy.js';\n\nconst UIStrings = {\n  /**\n  *@description Text that appears on a button for the font resource type filter.\n  */\n  font: 'Font',\n  /**\n  *@description Aria accessible name in Font View of the Sources panel\n  *@example {https://example.com} PH1\n  */\n  previewOfFontFromS: 'Preview of font from {PH1}',\n};\nconst str_ = i18n.i18n.registerUIStrings('ui/legacy/components/source_frame/FontView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class FontView extends UI.View.SimpleView {\n  _url: string;\n  _mimeType: string;\n  _contentProvider: TextUtils.ContentProvider.ContentProvider;\n  _mimeTypeLabel: UI.Toolbar.ToolbarText;\n  fontPreviewElement!: HTMLElement|null;\n  _dummyElement!: HTMLElement|null;\n  fontStyleElement!: HTMLStyleElement|null;\n  _inResize!: boolean|null;\n  constructor(mimeType: string, contentProvider: TextUtils.ContentProvider.ContentProvider) {\n    super(i18nString(UIStrings.font));\n    this.registerRequiredCSS('ui/legacy/components/source_frame/fontView.css', {enableLegacyPatching: false});\n    this.element.classList.add('font-view');\n    this._url = contentProvider.contentURL();\n    UI.ARIAUtils.setAccessibleName(this.element, i18nString(UIStrings.previewOfFontFromS, {PH1: this._url}));\n    this._mimeType = mimeType;\n    this._contentProvider = contentProvider;\n    this._mimeTypeLabel = new UI.Toolbar.ToolbarText(mimeType);\n  }\n\n  async toolbarItems(): Promise<UI.Toolbar.ToolbarItem[]> {\n    return [this._mimeTypeLabel];\n  }\n\n  _onFontContentLoaded(uniqueFontName: string, deferredContent: TextUtils.ContentProvider.DeferredContent): void {\n    const {content} = deferredContent;\n    const url = content ? TextUtils.ContentProvider.contentAsDataURL(content, this._mimeType, true) : this._url;\n    if (!this.fontStyleElement) {\n      return;\n    }\n    this.fontStyleElement.textContent =\n        Platform.StringUtilities.sprintf('@font-face { font-family: \"%s\"; src: url(%s); }', uniqueFontName, url);\n    this.updateFontPreviewSize();\n  }\n\n  _createContentIfNeeded(): void {\n    if (this.fontPreviewElement) {\n      return;\n    }\n\n    const uniqueFontName = 'WebInspectorFontPreview' + (++_fontId);\n    this.fontStyleElement = (document.createElement('style') as HTMLStyleElement);\n    this._contentProvider.requestContent().then(deferredContent => {\n      this._onFontContentLoaded(uniqueFontName, deferredContent);\n    });\n    this.element.appendChild(this.fontStyleElement);\n\n    const fontPreview = (document.createElement('div') as HTMLDivElement);\n    for (let i = 0; i < _fontPreviewLines.length; ++i) {\n      if (i > 0) {\n        fontPreview.createChild('br');\n      }\n      UI.UIUtils.createTextChild(fontPreview, _fontPreviewLines[i]);\n    }\n    this.fontPreviewElement = (fontPreview.cloneNode(true) as HTMLDivElement);\n    if (!this.fontPreviewElement) {\n      return;\n    }\n    UI.ARIAUtils.markAsHidden(this.fontPreviewElement);\n    this.fontPreviewElement.style.overflow = 'hidden';\n    this.fontPreviewElement.style.setProperty('font-family', uniqueFontName);\n    this.fontPreviewElement.style.setProperty('visibility', 'hidden');\n\n    this._dummyElement = fontPreview;\n    this._dummyElement.style.visibility = 'hidden';\n    this._dummyElement.style.zIndex = '-1';\n    this._dummyElement.style.display = 'inline';\n    this._dummyElement.style.position = 'absolute';\n    this._dummyElement.style.setProperty('font-family', uniqueFontName);\n    this._dummyElement.style.setProperty('font-size', _measureFontSize + 'px');\n\n    this.element.appendChild(this.fontPreviewElement);\n  }\n\n  wasShown(): void {\n    this._createContentIfNeeded();\n\n    this.updateFontPreviewSize();\n  }\n\n  onResize(): void {\n    if (this._inResize) {\n      return;\n    }\n\n    this._inResize = true;\n    try {\n      this.updateFontPreviewSize();\n    } finally {\n      this._inResize = null;\n    }\n  }\n\n  _measureElement(): {\n    width: number,\n    height: number,\n  } {\n    if (!this._dummyElement) {\n      throw new Error('No font preview loaded');\n    }\n    this.element.appendChild(this._dummyElement);\n    const result = {width: this._dummyElement.offsetWidth, height: this._dummyElement.offsetHeight};\n    this.element.removeChild(this._dummyElement);\n\n    return result;\n  }\n\n  updateFontPreviewSize(): void {\n    if (!this.fontPreviewElement || !this.isShowing()) {\n      return;\n    }\n\n    this.fontPreviewElement.style.removeProperty('visibility');\n    const dimension = this._measureElement();\n\n    const height = dimension.height;\n    const width = dimension.width;\n\n    // Subtract some padding. This should match the paddings in the CSS plus room for the scrollbar.\n    const containerWidth = this.element.offsetWidth - 50;\n    const containerHeight = this.element.offsetHeight - 30;\n\n    if (!height || !width || !containerWidth || !containerHeight) {\n      this.fontPreviewElement.style.removeProperty('font-size');\n      return;\n    }\n\n    const widthRatio = containerWidth / width;\n    const heightRatio = containerHeight / height;\n    const finalFontSize = Math.floor(_measureFontSize * Math.min(widthRatio, heightRatio)) - 2;\n\n    this.fontPreviewElement.style.setProperty('font-size', finalFontSize + 'px', undefined);\n  }\n}\n\n// TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration)\n// eslint-disable-next-line @typescript-eslint/naming-convention\nlet _fontId = 0;\n\n// TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration)\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst _fontPreviewLines = ['ABCDEFGHIJKLM', 'NOPQRSTUVWXYZ', 'abcdefghijklm', 'nopqrstuvwxyz', '1234567890'];\n\n// TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration)\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst _measureFontSize = 50;\n"]}