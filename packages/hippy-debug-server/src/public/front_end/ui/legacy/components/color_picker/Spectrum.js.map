{"version":3,"file":"Spectrum.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/color_picker/Spectrum.ts"],"names":[],"mappings":"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AE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;IAClH,SAAS,EACL,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;IAClH,SAAS,EACL,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;IAClH,SAAS,EACL,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;IAClH,SAAS,EACL,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;IAClH,SAAS,EACL,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;IAClH,SAAS,EACL,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;IAClH,SAAS,EACL,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;IAClH,SAAS,EACL,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;IAClH,SAAS,EACL,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;IAClH,SAAS,EACL,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EA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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/*\n * Copyright (C) 2011 Brian Grinstead All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as Host from '../../../../core/host/host.js';\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as Platform from '../../../../core/platform/platform.js';\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport * as IconButton from '../../../components/icon_button/icon_button.js';\nimport * as UI from '../../legacy.js';\n\nimport {ContrastDetails, Events as ContrastDetailsEvents} from './ContrastDetails.js';\n\nimport type {ContrastInfo} from './ContrastInfo.js';\nimport {ContrastOverlay} from './ContrastOverlay.js';\n\nconst UIStrings = {\n  /**\n  *@description Tooltip text that appears when hovering over largeicon eyedropper button in Spectrum of the Color Picker\n  */\n  toggleColorPicker: 'Toggle color picker',\n  /**\n  *@description Aria label for hue slider in Color Picker\n  */\n  changeHue: 'Change hue',\n  /**\n  * @description Aria label for alpha slider in Color Picker. Alpha refers to the alpha channel of a\n  * color, and this tool allows the user to change the alpha value.\n  */\n  changeAlpha: 'Change alpha',\n  /**\n  *@description Aria label for HEX color format input\n  */\n  hex: 'HEX',\n  /**\n  *@description Aria label for color format switcher button in Color Picker\n  */\n  changeColorFormat: 'Change color format',\n  /**\n  *@description Screen reader reads this text when palette switcher button receives focus\n  */\n  previewPalettes: 'Preview palettes',\n  /**\n  *@description Tooltip text that appears when hovering over the largeicon add button in the Spectrum of the Color Picker\n  */\n  addToPalette: 'Add to palette',\n  /**\n  *@description Title text content in Spectrum of the Color Picker\n  */\n  colorPalettes: 'Color Palettes',\n  /**\n  *@description Label for close button in Color Picker\n  */\n  returnToColorPicker: 'Return to color picker',\n  /**\n  *@description Aria label which declares hex value of a swatch in the Color Picker\n  *@example {#969696} PH1\n  */\n  colorS: 'Color {PH1}',\n  /**\n  *@description Color element title in Spectrum of the Color Picker\n  *@example {#9c1724} PH1\n  */\n  longclickOrLongpressSpaceToShow: 'Long-click or long-press space to show alternate shades of {PH1}',\n  /**\n  *@description A context menu item in the Color Picker to organize the user-defined color palette (removes the user-defined color to which this action is performed)\"\n  */\n  removeColor: 'Remove color',\n  /**\n  *@description A context menu item in the Color Picker to organize the user-defined color palette (removes all user-defined colors to the right of the color to which this action is performed)\"\n  */\n  removeAllToTheRight: 'Remove all to the right',\n  /**\n  *@description A context menu item in the Color Picker to organize the user-defined color palette (removes all user-defined colors)\"\n  */\n  clearPalette: 'Clear palette',\n  /**\n  *@description Aria label for RGBA and HSLA color format inputs in Color Picker\n  *@example {R} PH1\n  *@example {RGBA} PH2\n  */\n  sInS: '{PH1} in {PH2}',\n  /**\n  *@description Swatch copy icon title in Spectrum of the Color Picker\n  */\n  copyColorToClipboard: 'Copy color to clipboard',\n  /**\n  *@description Aria text for the swatch position. Swatch is the color picker spectrum tool.\n  */\n  pressArrowKeysMessage:\n      'Press arrow keys with or without modifiers to move swatch position. Arrow key with Shift key moves position largely, with Ctrl key it is less and with Alt key it is even less',\n};\nconst str_ = i18n.i18n.registerUIStrings('ui/legacy/components/color_picker/Spectrum.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst colorElementToMutable = new WeakMap<HTMLElement, boolean>();\n\nconst colorElementToColor = new WeakMap<HTMLElement, string>();\n\nexport class Spectrum extends UI.Widget.VBox {\n  _colorElement: HTMLElement;\n  _colorDragElement: HTMLElement;\n  _dragX: number;\n  _dragY: number;\n  _colorPickerButton: UI.Toolbar.ToolbarToggle;\n  _swatch: Swatch;\n  _hueElement: HTMLElement;\n  _hueSlider: HTMLElement;\n  _alphaElement: HTMLElement;\n  _alphaElementBackground: HTMLElement;\n  _alphaSlider: HTMLElement;\n  _displayContainer: HTMLElement;\n  _textValues: HTMLInputElement[];\n  _textLabels: HTMLElement;\n  _hexContainer: HTMLElement;\n  _hexValue: HTMLInputElement;\n  _contrastInfo: ContrastInfo|undefined;\n  _contrastOverlay: ContrastOverlay|undefined;\n  _contrastDetails: ContrastDetails|undefined;\n  _contrastDetailsBackgroundColorPickedToggledBound: ((event: {\n                                                        data: unknown,\n                                                      }) => void)|undefined;\n  _palettes: Map<string, Palette>;\n  _palettePanel: HTMLElement;\n  _palettePanelShowing: boolean;\n  _paletteSectionContainer: HTMLElement;\n  _paletteContainer: HTMLElement;\n  _shadesContainer: HTMLElement;\n  _deleteIconToolbar: UI.Toolbar.Toolbar;\n  _deleteButton: UI.Toolbar.ToolbarButton;\n  _addColorToolbar: UI.Toolbar.Toolbar;\n  _colorPickedBound: (event: Common.EventTarget.EventTargetEvent) => void;\n  _hsv!: number[];\n  _hueAlphaWidth!: number;\n  dragWidth!: number;\n  dragHeight!: number;\n  _colorDragElementHeight!: number;\n  slideHelperWidth!: number;\n  _numPaletteRowsShown: number;\n  _selectedColorPalette!: Common.Settings.Setting<string>;\n  _customPaletteSetting!: Common.Settings.Setting<Palette>;\n  _colorOffset?: {\n    left: number,\n    top: number,\n  };\n  _closeButton?: UI.Toolbar.ToolbarButton;\n  _paletteContainerMutable?: boolean;\n  _shadesCloseHandler?: (() => void);\n  _dragElement?: HTMLElement;\n  _dragHotSpotX?: number;\n  _dragHotSpotY?: number;\n  _originalFormat?: string;\n  _colorName?: string;\n  _colorString?: string;\n  _colorFormat?: string;\n  constructor(contrastInfo?: ContrastInfo|null) {\n    super(true);\n    this.registerRequiredCSS('ui/legacy/components/color_picker/spectrum.css', {enableLegacyPatching: false});\n\n    this.contentElement.tabIndex = 0;\n    this._colorElement = this.contentElement.createChild('div', 'spectrum-color');\n    this._colorElement.tabIndex = 0;\n    this.setDefaultFocusedElement(this._colorElement);\n    this._colorElement.addEventListener('keydown', this._onSliderKeydown.bind(this, positionColor.bind(this)));\n    const swatchAriaText = i18nString(UIStrings.pressArrowKeysMessage);\n    UI.ARIAUtils.setAccessibleName(this._colorElement, swatchAriaText);\n    UI.ARIAUtils.markAsApplication(this._colorElement);\n    this._colorDragElement = this._colorElement.createChild('div', 'spectrum-sat fill')\n                                 .createChild('div', 'spectrum-val fill')\n                                 .createChild('div', 'spectrum-dragger');\n    this._dragX = 0;\n    this._dragY = 0;\n\n    const toolsContainer: HTMLElement = this.contentElement.createChild('div', 'spectrum-tools') as HTMLElement;\n    const toolbar = new UI.Toolbar.Toolbar('spectrum-eye-dropper', toolsContainer);\n    this._colorPickerButton =\n        new UI.Toolbar.ToolbarToggle(i18nString(UIStrings.toggleColorPicker), 'largeicon-eyedropper');\n    this._colorPickerButton.setToggled(true);\n    this._colorPickerButton.addEventListener(\n        UI.Toolbar.ToolbarButton.Events.Click, this._toggleColorPicker.bind(this, undefined));\n    toolbar.appendToolbarItem(this._colorPickerButton);\n\n    this._swatch = new Swatch(toolsContainer);\n\n    this._hueElement = toolsContainer.createChild('div', 'spectrum-hue');\n    this._hueElement.tabIndex = 0;\n    this._hueElement.addEventListener('keydown', this._onSliderKeydown.bind(this, positionHue.bind(this)));\n    UI.ARIAUtils.setAccessibleName(this._hueElement, i18nString(UIStrings.changeHue));\n    UI.ARIAUtils.markAsSlider(this._hueElement, 0, 360);\n    this._hueSlider = this._hueElement.createChild('div', 'spectrum-slider');\n    this._alphaElement = toolsContainer.createChild('div', 'spectrum-alpha');\n    this._alphaElement.tabIndex = 0;\n    this._alphaElement.addEventListener('keydown', this._onSliderKeydown.bind(this, positionAlpha.bind(this)));\n    UI.ARIAUtils.setAccessibleName(this._alphaElement, i18nString(UIStrings.changeAlpha));\n    UI.ARIAUtils.markAsSlider(this._alphaElement, 0, 1);\n    this._alphaElementBackground = this._alphaElement.createChild('div', 'spectrum-alpha-background');\n    this._alphaSlider = this._alphaElement.createChild('div', 'spectrum-slider');\n\n    // RGBA/HSLA display.\n    this._displayContainer = toolsContainer.createChild('div', 'spectrum-text source-code');\n    UI.ARIAUtils.markAsPoliteLiveRegion(this._displayContainer, true);\n    this._textValues = [];\n    for (let i = 0; i < 4; ++i) {\n      const inputValue = UI.UIUtils.createInput('spectrum-text-value');\n      this._displayContainer.appendChild(inputValue);\n      inputValue.maxLength = 4;\n      this._textValues.push(inputValue);\n      inputValue.addEventListener('keydown', this._inputChanged.bind(this), false);\n      inputValue.addEventListener('input', this._inputChanged.bind(this), false);\n      inputValue.addEventListener('wheel', this._inputChanged.bind(this), false);\n      inputValue.addEventListener('paste', this._pasted.bind(this), false);\n    }\n\n    this._textLabels = this._displayContainer.createChild('div', 'spectrum-text-label');\n\n    // HEX display.\n    this._hexContainer = toolsContainer.createChild('div', 'spectrum-text spectrum-text-hex source-code');\n    UI.ARIAUtils.markAsPoliteLiveRegion(this._hexContainer, true);\n    this._hexValue = UI.UIUtils.createInput('spectrum-text-value');\n    this._hexContainer.appendChild(this._hexValue);\n    this._hexValue.maxLength = 9;\n    this._hexValue.addEventListener('keydown', this._inputChanged.bind(this), false);\n    this._hexValue.addEventListener('input', this._inputChanged.bind(this), false);\n    this._hexValue.addEventListener('wheel', this._inputChanged.bind(this), false);\n    this._hexValue.addEventListener('paste', this._pasted.bind(this), false);\n\n    const label = this._hexContainer.createChild('div', 'spectrum-text-label');\n    label.textContent = i18nString(UIStrings.hex);\n    UI.ARIAUtils.setAccessibleName(this._hexValue, label.textContent);\n\n    const displaySwitcher = toolsContainer.createChild('div', 'spectrum-display-switcher spectrum-switcher');\n    appendSwitcherIcon(displaySwitcher);\n    UI.UIUtils.setTitle(displaySwitcher, i18nString(UIStrings.changeColorFormat));\n    displaySwitcher.tabIndex = 0;\n    self.onInvokeElement(displaySwitcher, event => {\n      this._formatViewSwitch();\n      event.consume(true);\n    });\n    UI.ARIAUtils.markAsButton(displaySwitcher);\n\n    UI.UIUtils.installDragHandle(\n        this._hueElement, this._dragStart.bind(this, positionHue.bind(this)), positionHue.bind(this), null, 'pointer',\n        'default');\n    UI.UIUtils.installDragHandle(\n        this._alphaElement, this._dragStart.bind(this, positionAlpha.bind(this)), positionAlpha.bind(this), null,\n        'pointer', 'default');\n    UI.UIUtils.installDragHandle(\n        this._colorElement, this._dragStart.bind(this, positionColor.bind(this)), positionColor.bind(this), null,\n        'pointer', 'default');\n\n    // Color contrast business.\n    if (contrastInfo) {\n      this._contrastInfo = contrastInfo;\n      this._contrastOverlay = new ContrastOverlay(this._contrastInfo, this._colorElement);\n      this._contrastDetails = new ContrastDetails(\n          this._contrastInfo, this.contentElement, this._toggleColorPicker.bind(this),\n          this._contrastPanelExpanded.bind(this), this.colorSelected.bind(this));\n\n      this._contrastDetailsBackgroundColorPickedToggledBound =\n          this._contrastDetailsBackgroundColorPickedToggled.bind(this);\n    }\n\n    this.element.classList.add('flex-none');\n    this._palettes = new Map();\n    this._palettePanel = this.contentElement.createChild('div', 'palette-panel');\n    this._palettePanelShowing = false;\n    this._paletteSectionContainer = this.contentElement.createChild('div', 'spectrum-palette-container');\n    this._paletteContainer = this._paletteSectionContainer.createChild('div', 'spectrum-palette');\n    this._paletteContainer.addEventListener('contextmenu', this._showPaletteColorContextMenu.bind(this, -1));\n    this._shadesContainer = this.contentElement.createChild('div', 'palette-color-shades hidden');\n    UI.UIUtils.installDragHandle(\n        this._paletteContainer, this._paletteDragStart.bind(this), this._paletteDrag.bind(this),\n        this._paletteDragEnd.bind(this), 'default');\n    const paletteSwitcher =\n        this._paletteSectionContainer.createChild('div', 'spectrum-palette-switcher spectrum-switcher');\n    appendSwitcherIcon(paletteSwitcher);\n    UI.UIUtils.setTitle(paletteSwitcher, i18nString(UIStrings.previewPalettes));\n    UI.ARIAUtils.markAsButton(paletteSwitcher);\n    paletteSwitcher.tabIndex = 0;\n    self.onInvokeElement(paletteSwitcher, event => {\n      this._togglePalettePanel(true);\n      event.consume(true);\n    });\n\n    this._deleteIconToolbar = new UI.Toolbar.Toolbar('delete-color-toolbar');\n    this._deleteButton = new UI.Toolbar.ToolbarButton('', 'largeicon-trash-bin');\n    this._deleteIconToolbar.appendToolbarItem(this._deleteButton);\n\n    const overlay = this.contentElement.createChild('div', 'spectrum-overlay fill');\n    overlay.addEventListener('click', this._togglePalettePanel.bind(this, false));\n\n    this._addColorToolbar = new UI.Toolbar.Toolbar('add-color-toolbar');\n    const addColorButton = new UI.Toolbar.ToolbarButton(i18nString(UIStrings.addToPalette), 'largeicon-add');\n    addColorButton.addEventListener(UI.Toolbar.ToolbarButton.Events.Click, this._onAddColorMousedown.bind(this));\n    addColorButton.element.addEventListener('keydown', this._onAddColorKeydown.bind(this));\n    this._addColorToolbar.appendToolbarItem(addColorButton);\n\n    this._colorPickedBound = this._colorPicked.bind(this);\n\n    this._numPaletteRowsShown = -1;\n\n    this._loadPalettes();\n    new PaletteGenerator(palette => {\n      if (palette.colors.length) {\n        this.addPalette(palette);\n      } else if (this._selectedColorPalette.get() === palette.title) {\n        this._paletteSelected(MaterialPalette);\n      }\n    });\n\n    function getUpdatedSliderPosition(element: Element, event: Event): number {\n      const keyboardEvent = event as KeyboardEvent;\n      const elementPosition = element.getBoundingClientRect();\n      switch (keyboardEvent.key) {\n        case 'ArrowLeft':\n        case 'ArrowDown':\n          return elementPosition.left - 1;\n        case 'ArrowRight':\n        case 'ArrowUp':\n          return elementPosition.right + 1;\n        default:\n          return /** @type {!MouseEvent} */ (event as MouseEvent).x;\n      }\n    }\n\n    function positionHue(this: Spectrum, event: Event): void {\n      const hsva = this._hsv.slice();\n      const sliderPosition = getUpdatedSliderPosition(this._hueSlider, event);\n      const hueAlphaLeft = this._hueElement.getBoundingClientRect().left;\n      const positionFraction = (sliderPosition - hueAlphaLeft) / this._hueAlphaWidth;\n      const newHue = 1 - positionFraction;\n      hsva[0] = Platform.NumberUtilities.clamp(newHue, 0, 1);\n      this._innerSetColor(hsva, '', undefined /* colorName */, undefined, ChangeSource.Other);\n      const colorValues = this._color().canonicalHSLA();\n      UI.ARIAUtils.setValueNow(this._hueElement, colorValues[0]);\n    }\n\n    function positionAlpha(this: Spectrum, event: Event): void {\n      const hsva = this._hsv.slice();\n      const sliderPosition = getUpdatedSliderPosition(this._alphaSlider, event);\n      const hueAlphaLeft = this._hueElement.getBoundingClientRect().left;\n      const positionFraction = (sliderPosition - hueAlphaLeft) / this._hueAlphaWidth;\n      const newAlpha = Math.round(positionFraction * 100) / 100;\n      hsva[3] = Platform.NumberUtilities.clamp(newAlpha, 0, 1);\n      this._innerSetColor(hsva, '', undefined /* colorName */, undefined, ChangeSource.Other);\n      const colorValues = this._color().canonicalHSLA();\n      UI.ARIAUtils.setValueText(this._alphaElement, colorValues[3]);\n    }\n\n    function positionColor(this: Spectrum, event: Event): void {\n      const hsva = this._hsv.slice();\n      const colorPosition = getUpdatedColorPosition(this._colorDragElement, event);\n      this._colorOffset = this._colorElement.totalOffset();\n      hsva[1] = Platform.NumberUtilities.clamp((colorPosition.x - this._colorOffset.left) / this.dragWidth, 0, 1);\n      hsva[2] = Platform.NumberUtilities.clamp(1 - (colorPosition.y - this._colorOffset.top) / this.dragHeight, 0, 1);\n\n      this._innerSetColor(hsva, '', undefined /* colorName */, undefined, ChangeSource.Other);\n    }\n\n    function getUpdatedColorPosition(dragElement: Element, event: Event): {\n      x: number,\n      y: number,\n    } {\n      const elementPosition = dragElement.getBoundingClientRect();\n      const verticalX = elementPosition.x + elementPosition.width / 2;\n      const horizontalY = elementPosition.y + elementPosition.width / 2;\n      const defaultUnit = elementPosition.width / 4;\n      const unit = getUnitToMove(defaultUnit, event);\n      const keyboardEvent = event as KeyboardEvent;\n      switch (keyboardEvent.key) {\n        case 'ArrowLeft':\n          return {x: elementPosition.left - unit, y: horizontalY};\n        case 'ArrowRight':\n          return {x: elementPosition.right + unit, y: horizontalY};\n        case 'ArrowDown':\n          return {x: verticalX, y: elementPosition.bottom + unit};\n        case 'ArrowUp':\n          return {x: verticalX, y: elementPosition.top - unit};\n        default:\n          return {\n            x: (event as MouseEvent).x,\n            y: (event as MouseEvent).y,\n          };\n      }\n    }\n\n    function getUnitToMove(unit: number, event: Event): number {\n      const keyboardEvent = event as KeyboardEvent;\n      if (keyboardEvent.altKey) {\n        unit = 1;\n      } else if (keyboardEvent.ctrlKey) {\n        unit = 10;\n      } else if (keyboardEvent.shiftKey) {\n        unit = 20;\n      }\n      return unit;\n    }\n\n    function appendSwitcherIcon(parentElement: Element): void {\n      const switcherIcon = new IconButton.Icon.Icon();\n      switcherIcon.data = {iconName: 'switcherIcon', color: 'var(--color-text-primary)', width: '16px', height: '16px'};\n      parentElement.appendChild(switcherIcon);\n    }\n  }\n\n  _dragStart(this: Spectrum, callback: (arg0: Event) => void, event: Event): boolean {\n    this._colorOffset = this._colorElement.totalOffset();\n    callback(event);\n    return true;\n  }\n\n  _contrastDetailsBackgroundColorPickedToggled(event: {\n    data: unknown,\n  }): void {\n    if (event.data) {\n      this._toggleColorPicker(false);\n    }\n  }\n\n  _contrastPanelExpanded(): void {\n    if (!this._contrastOverlay || !this._contrastDetails) {\n      return;\n    }\n    this._contrastOverlay.setVisible(this._contrastDetails.expanded());\n    this._resizeForSelectedPalette(true);\n  }\n\n  _updatePalettePanel(): void {\n    this._palettePanel.removeChildren();\n    const title = this._palettePanel.createChild('div', 'palette-title');\n    title.textContent = i18nString(UIStrings.colorPalettes);\n    const toolbar = new UI.Toolbar.Toolbar('', this._palettePanel);\n    this._closeButton = new UI.Toolbar.ToolbarButton(i18nString(UIStrings.returnToColorPicker), 'largeicon-delete');\n    this._closeButton.addEventListener(\n        UI.Toolbar.ToolbarButton.Events.Click, this._togglePalettePanel.bind(this, false));\n    this._closeButton.element.addEventListener('keydown', this._onCloseBtnKeydown.bind(this));\n    toolbar.appendToolbarItem(this._closeButton);\n    for (const palette of this._palettes.values()) {\n      this._palettePanel.appendChild(this._createPreviewPaletteElement(palette));\n    }\n  }\n\n  _togglePalettePanel(show: boolean): void {\n    if (this._palettePanelShowing === show) {\n      return;\n    }\n    if (show) {\n      this._updatePalettePanel();\n    }\n    this._palettePanelShowing = show;\n    this.contentElement.classList.toggle('palette-panel-showing', show);\n    this._focus();\n  }\n\n  _onCloseBtnKeydown(event: Event): void {\n    if (isEscKey(event) || isEnterOrSpaceKey(event)) {\n      this._togglePalettePanel(false);\n      event.consume(true);\n    }\n  }\n\n  _onSliderKeydown(sliderNewPosition: (arg0: Event) => void, event: Event): void {\n    const keyboardEvent = event as KeyboardEvent;\n    switch (keyboardEvent.key) {\n      case 'ArrowLeft':\n      case 'ArrowRight':\n      case 'ArrowDown':\n      case 'ArrowUp':\n        sliderNewPosition(event);\n        event.consume(true);\n    }\n  }\n\n  /**\n   * (Suppress warning about preventScroll)\n   */\n  _focus(): void {\n    if (!this.isShowing()) {\n      return;\n    }\n    if (this._palettePanelShowing && this._closeButton) {\n      this._closeButton.element.focus({preventScroll: true});\n    } else {\n      this.contentElement.focus();\n    }\n  }\n\n  _createPaletteColor(colorText: string, colorName?: string, animationDelay?: number): HTMLElement {\n    const element = document.createElement('div') as HTMLElement;\n    element.classList.add('spectrum-palette-color');\n    element.style.background =\n        Platform.StringUtilities.sprintf('linear-gradient(%s, %s), var(--image-file-checker)', colorText, colorText);\n    if (animationDelay) {\n      element.animate([{opacity: 0}, {opacity: 1}], {duration: 100, delay: animationDelay, fill: 'backwards'});\n    }\n    UI.Tooltip.Tooltip.install(element, colorName || colorText);\n    return element;\n  }\n\n  _showPalette(palette: Palette, animate: boolean, _event?: Event): void {\n    this._resizeForSelectedPalette();\n    this._paletteContainer.removeChildren();\n    for (let i = 0; i < palette.colors.length; i++) {\n      const animationDelay = animate ? i * 100 / palette.colors.length : 0;\n      const colorElement = this._createPaletteColor(palette.colors[i], palette.colorNames[i], animationDelay);\n      UI.ARIAUtils.markAsButton(colorElement);\n      UI.ARIAUtils.setAccessibleName(colorElement, i18nString(UIStrings.colorS, {PH1: palette.colors[i]}));\n      colorElement.tabIndex = -1;\n      colorElement.addEventListener(\n          'mousedown',\n          this._paletteColorSelected.bind(\n              this, palette.colors[i], palette.colorNames[i], Boolean(palette.matchUserFormat)));\n      colorElement.addEventListener(\n          'focus',\n          this._paletteColorSelected.bind(\n              this, palette.colors[i], palette.colorNames[i], Boolean(palette.matchUserFormat)));\n      colorElement.addEventListener('keydown', this._onPaletteColorKeydown.bind(this, i));\n      if (palette.mutable) {\n        colorElementToMutable.set(colorElement, true);\n        colorElementToColor.set(colorElement, palette.colors[i]);\n        colorElement.addEventListener('contextmenu', this._showPaletteColorContextMenu.bind(this, i));\n      } else if (palette === MaterialPalette) {\n        colorElement.classList.add('has-material-shades');\n        let shadow = colorElement.createChild('div', 'spectrum-palette-color spectrum-palette-color-shadow');\n        shadow.style.background = palette.colors[i];\n        shadow = colorElement.createChild('div', 'spectrum-palette-color spectrum-palette-color-shadow');\n        shadow.style.background = palette.colors[i];\n        UI.Tooltip.Tooltip.install(\n            colorElement, i18nString(UIStrings.longclickOrLongpressSpaceToShow, {PH1: palette.colors[i]}));\n        UI.ARIAUtils.setAccessibleName(colorElement, UI.Tooltip.Tooltip.getContent(colorElement));\n        new UI.UIUtils.LongClickController(\n            colorElement, this._showLightnessShades.bind(this, colorElement, palette.colors[i]));\n      }\n      this._paletteContainer.appendChild(colorElement);\n    }\n    if (this._paletteContainer.childNodes.length > 0) {\n      (this._paletteContainer.childNodes[0] as HTMLElement).tabIndex = 0;\n    }\n    this._paletteContainerMutable = palette.mutable;\n\n    if (palette.mutable) {\n      this._paletteContainer.appendChild(this._addColorToolbar.element);\n      this._paletteContainer.appendChild(this._deleteIconToolbar.element);\n    } else {\n      this._addColorToolbar.element.remove();\n      this._deleteIconToolbar.element.remove();\n    }\n\n    this._togglePalettePanel(false);\n    this._focus();\n  }\n\n  _showLightnessShades(colorElement: HTMLElement, colorText: string, _event: Event): void {\n    function closeLightnessShades(this: Spectrum, element: Element): void {\n      this._shadesContainer.classList.add('hidden');\n      element.classList.remove('spectrum-shades-shown');\n      if (this._shadesCloseHandler) {\n        this._shadesContainer.ownerDocument.removeEventListener('mousedown', this._shadesCloseHandler, true);\n      }\n      delete this._shadesCloseHandler;\n    }\n\n    if (this._shadesCloseHandler) {\n      this._shadesCloseHandler();\n    }\n\n    this._shadesContainer.classList.remove('hidden');\n    this._shadesContainer.removeChildren();\n    this._shadesContainer.animate(\n        [{transform: 'scaleY(0)', opacity: '0'}, {transform: 'scaleY(1)', opacity: '1'}],\n        {duration: 200, easing: 'cubic-bezier(0.4, 0, 0.2, 1)'});\n    let shadesTop = this._paletteContainer.offsetTop + colorElement.offsetTop +\n        (colorElement.parentElement ? colorElement.parentElement.offsetTop : 0);\n    if (this._contrastDetails) {\n      shadesTop += this._contrastDetails.element().offsetHeight;\n    }\n    this._shadesContainer.style.top = shadesTop + 'px';\n    this._shadesContainer.style.left = colorElement.offsetLeft + 'px';\n    colorElement.classList.add('spectrum-shades-shown');\n\n    const shades = MaterialPaletteShades[colorText];\n    for (let i = shades.length - 1; i >= 0; i--) {\n      const shadeElement =\n          this._createPaletteColor(shades[i], undefined /* colorName */, i * 200 / shades.length + 100);\n      UI.ARIAUtils.markAsButton(shadeElement);\n      UI.ARIAUtils.setAccessibleName(shadeElement, i18nString(UIStrings.colorS, {PH1: shades[i]}));\n      shadeElement.tabIndex = -1;\n      shadeElement.addEventListener('mousedown', this._paletteColorSelected.bind(this, shades[i], shades[i], false));\n      shadeElement.addEventListener('focus', this._paletteColorSelected.bind(this, shades[i], shades[i], false));\n      shadeElement.addEventListener('keydown', this._onShadeColorKeydown.bind(this, colorElement));\n      this._shadesContainer.appendChild(shadeElement);\n    }\n\n    if (this._shadesContainer.childNodes.length > 0) {\n      (this._shadesContainer.childNodes[this._shadesContainer.childNodes.length - 1] as HTMLElement).focus();\n    }\n    this._shadesCloseHandler = closeLightnessShades.bind(this, colorElement);\n    this._shadesContainer.ownerDocument.addEventListener('mousedown', this._shadesCloseHandler, true);\n  }\n\n  _slotIndexForEvent(event: Event): number {\n    const mouseEvent = event as MouseEvent;\n    const localX = mouseEvent.pageX - this._paletteContainer.totalOffsetLeft();\n    const localY = mouseEvent.pageY - this._paletteContainer.totalOffsetTop();\n    const col = Math.min(localX / COLOR_CHIP_SIZE | 0, ITEMS_PER_PALETTE_ROW - 1);\n    const row = (localY / COLOR_CHIP_SIZE) | 0;\n    return Math.min(row * ITEMS_PER_PALETTE_ROW + col, this._customPaletteSetting.get().colors.length - 1);\n  }\n\n  _isDraggingToBin(event: Event): boolean {\n    const mouseEvent = event as MouseEvent;\n    return mouseEvent.pageX > this._deleteIconToolbar.element.totalOffsetLeft();\n  }\n\n  _paletteDragStart(event: Event): boolean {\n    const element = UI.UIUtils.deepElementFromEvent(event) as HTMLElement;\n    if (!element || !colorElementToMutable.get(element)) {\n      return false;\n    }\n\n    const index = this._slotIndexForEvent(event);\n    this._dragElement = element;\n    const mouseEvent = event as MouseEvent;\n    this._dragHotSpotX = mouseEvent.pageX - (index % ITEMS_PER_PALETTE_ROW) * COLOR_CHIP_SIZE;\n    this._dragHotSpotY = mouseEvent.pageY - (index / ITEMS_PER_PALETTE_ROW | 0) * COLOR_CHIP_SIZE;\n    return true;\n  }\n\n  _paletteDrag(event: Event): void {\n    const mouseEvent = event as MouseEvent;\n    if (mouseEvent.pageX < this._paletteContainer.totalOffsetLeft() ||\n        mouseEvent.pageY < this._paletteContainer.totalOffsetTop()) {\n      return;\n    }\n    if (!this._dragElement || this._dragHotSpotX === undefined || this._dragHotSpotY === undefined) {\n      return;\n    }\n    const newIndex = this._slotIndexForEvent(event);\n    const offsetX = mouseEvent.pageX - (newIndex % ITEMS_PER_PALETTE_ROW) * COLOR_CHIP_SIZE;\n    const offsetY = mouseEvent.pageY - (newIndex / ITEMS_PER_PALETTE_ROW | 0) * COLOR_CHIP_SIZE;\n\n    const isDeleting = this._isDraggingToBin(event);\n    this._deleteIconToolbar.element.classList.add('dragging');\n    this._deleteIconToolbar.element.classList.toggle('delete-color-toolbar-active', isDeleting);\n    const dragElementTransform =\n        'translateX(' + (offsetX - this._dragHotSpotX) + 'px) translateY(' + (offsetY - this._dragHotSpotY) + 'px)';\n    this._dragElement.style.transform = isDeleting ? dragElementTransform + ' scale(0.8)' : dragElementTransform;\n    const children = Array.prototype.slice.call(this._paletteContainer.children);\n    const index = children.indexOf(this._dragElement);\n    const swatchOffsets = new Map<Element, {left: number, top: number}>();\n    for (const swatch of children) {\n      swatchOffsets.set(swatch, swatch.totalOffset());\n    }\n\n    if (index !== newIndex) {\n      this._paletteContainer.insertBefore(this._dragElement, children[newIndex > index ? newIndex + 1 : newIndex]);\n    }\n\n    for (const swatch of children) {\n      if (swatch === this._dragElement) {\n        continue;\n      }\n      const before = swatchOffsets.get(swatch);\n      const after = swatch.totalOffset();\n      if (before && (before.left !== after.left || before.top !== after.top)) {\n        swatch.animate(\n            [\n              {\n                transform:\n                    'translateX(' + (before.left - after.left) + 'px) translateY(' + (before.top - after.top) + 'px)',\n              },\n              {transform: 'none'},\n            ],\n            {duration: 100, easing: 'cubic-bezier(0, 0, 0.2, 1)'});\n      }\n    }\n  }\n\n  _paletteDragEnd(e: Event): void {\n    if (!this._dragElement) {\n      return;\n    }\n    if (this._isDraggingToBin(e)) {\n      this._dragElement.remove();\n    }\n    this._dragElement.style.removeProperty('transform');\n    const children = this._paletteContainer.children;\n    const colors = [];\n    for (let i = 0; i < children.length; ++i) {\n      const color = colorElementToColor.get(children[i] as HTMLElement);\n      if (color) {\n        colors.push(color);\n      }\n    }\n    const palette = this._customPaletteSetting.get() as Palette;\n    palette.colors = colors;\n    this._customPaletteSetting.set(palette);\n    this._showPalette(palette, false);\n\n    this._deleteIconToolbar.element.classList.remove('dragging');\n    this._deleteIconToolbar.element.classList.remove('delete-color-toolbar-active');\n  }\n\n  _loadPalettes(): void {\n    this._palettes.set(MaterialPalette.title, MaterialPalette);\n    const defaultCustomPalette:\n        Palette = {title: 'Custom', colors: [], colorNames: [], mutable: true, matchUserFormat: undefined};\n    this._customPaletteSetting =\n        Common.Settings.Settings.instance().createSetting('customColorPalette', defaultCustomPalette);\n    const customPalette = this._customPaletteSetting.get() as Palette;\n    // Fallback case for custom palettes created pre-m67\n    customPalette.colorNames = customPalette.colorNames || [];\n    this._palettes.set(customPalette.title, customPalette);\n\n    this._selectedColorPalette =\n        Common.Settings.Settings.instance().createSetting('selectedColorPalette', GeneratedPaletteTitle);\n    const palette = this._palettes.get(this._selectedColorPalette.get() as string);\n    if (palette) {\n      this._showPalette(palette, true);\n    }\n  }\n\n  addPalette(palette: Palette): void {\n    this._palettes.set(palette.title, palette);\n    if (this._selectedColorPalette.get() === palette.title) {\n      this._showPalette(palette, true);\n    }\n  }\n\n  _createPreviewPaletteElement(palette: Palette): Element {\n    const colorsPerPreviewRow = 5;\n    const previewElement = document.createElement('div');\n    previewElement.classList.add('palette-preview');\n    UI.ARIAUtils.markAsButton(previewElement);\n    previewElement.tabIndex = 0;\n    const titleElement = previewElement.createChild('div', 'palette-preview-title');\n    titleElement.textContent = palette.title;\n    let i;\n    for (i = 0; i < colorsPerPreviewRow && i < palette.colors.length; i++) {\n      previewElement.appendChild(this._createPaletteColor(palette.colors[i], palette.colorNames[i]));\n    }\n    for (; i < colorsPerPreviewRow; i++) {\n      previewElement.createChild('div', 'spectrum-palette-color empty-color');\n    }\n    self.onInvokeElement(previewElement, event => {\n      this._paletteSelected(palette);\n      event.consume(true);\n    });\n    return previewElement;\n  }\n\n  _paletteSelected(palette: Palette): void {\n    this._selectedColorPalette.set(palette.title);\n    this._showPalette(palette, true);\n  }\n\n  _resizeForSelectedPalette(force?: boolean): void {\n    const palette = this._palettes.get(this._selectedColorPalette.get() as string);\n    if (!palette) {\n      return;\n    }\n    let numColors = palette.colors.length;\n    if (palette === this._customPaletteSetting.get()) {\n      numColors++;\n    }\n    const rowsNeeded = Math.max(1, Math.ceil(numColors / ITEMS_PER_PALETTE_ROW));\n    if (this._numPaletteRowsShown === rowsNeeded && !force) {\n      return;\n    }\n    this._numPaletteRowsShown = rowsNeeded;\n    const paletteColorHeight = 12;\n    const paletteMargin = 12;\n    let paletteTop = 236;\n    if (this._contrastDetails) {\n      if (this._contrastDetails.expanded()) {\n        paletteTop += 78;\n      } else {\n        paletteTop += 36;\n      }\n    }\n    this.element.style.height = (paletteTop + paletteMargin + (paletteColorHeight + paletteMargin) * rowsNeeded) + 'px';\n    this.dispatchEventToListeners(Events.SizeChanged);\n  }\n\n  _paletteColorSelected(colorText: string, colorName: string|undefined, matchUserFormat: boolean): void {\n    const color = Common.Color.Color.parse(colorText);\n    if (!color) {\n      return;\n    }\n    this._innerSetColor(\n        color.hsva(), colorText, colorName, matchUserFormat ? this._colorFormat : color.format(), ChangeSource.Other);\n  }\n\n  _onPaletteColorKeydown(colorIndex: number, event: Event): void {\n    const keyboardEvent = event as KeyboardEvent;\n    let nextColorIndex;\n    switch (keyboardEvent.key) {\n      case 'ArrowLeft':\n        nextColorIndex = colorIndex - 1;\n        break;\n      case 'ArrowRight':\n        nextColorIndex = colorIndex + 1;\n        break;\n      case 'ArrowUp':\n        nextColorIndex = colorIndex - ITEMS_PER_PALETTE_ROW;\n        break;\n      case 'ArrowDown':\n        nextColorIndex = colorIndex + ITEMS_PER_PALETTE_ROW;\n        break;\n    }\n    if (nextColorIndex !== undefined && nextColorIndex > -1 &&\n        nextColorIndex < this._paletteContainer.childNodes.length) {\n      (this._paletteContainer.childNodes[nextColorIndex] as HTMLElement).focus();\n    }\n  }\n\n  _onShadeColorKeydown(colorElement: HTMLElement, event: Event): void {\n    const keyboardEvent = event as KeyboardEvent;\n    const target = keyboardEvent.target as HTMLElement;\n    if (isEscKey(event) || keyboardEvent.key === 'Tab') {\n      colorElement.focus();\n      if (this._shadesCloseHandler) {\n        this._shadesCloseHandler();\n      }\n      event.consume(true);\n    } else if (keyboardEvent.key === 'ArrowUp' && target.previousElementSibling) {\n      (target.previousElementSibling as HTMLElement).focus();\n      event.consume(true);\n    } else if (keyboardEvent.key === 'ArrowDown' && target.nextElementSibling) {\n      (target.nextElementSibling as HTMLElement).focus();\n      event.consume(true);\n    }\n  }\n\n  _onAddColorMousedown(): void {\n    this._addColorToCustomPalette();\n  }\n\n  _onAddColorKeydown(event: Event): void {\n    if (isEnterOrSpaceKey(event)) {\n      this._addColorToCustomPalette();\n      event.consume(true);\n    }\n  }\n\n  _addColorToCustomPalette(): void {\n    const palette = this._customPaletteSetting.get() as Palette;\n    palette.colors.push(this.colorString());\n    this._customPaletteSetting.set(palette);\n    this._showPalette(palette, false);\n    const colorElements = this._paletteContainer.querySelectorAll('.spectrum-palette-color');\n    (colorElements[colorElements.length - 1] as HTMLElement).focus();\n  }\n\n  _showPaletteColorContextMenu(colorIndex: number, event: Event): void {\n    if (!this._paletteContainerMutable) {\n      return;\n    }\n    const contextMenu = new UI.ContextMenu.ContextMenu(event);\n    if (colorIndex !== -1) {\n      contextMenu.defaultSection().appendItem(\n          i18nString(UIStrings.removeColor), this._deletePaletteColors.bind(this, colorIndex, false));\n      contextMenu.defaultSection().appendItem(\n          i18nString(UIStrings.removeAllToTheRight), this._deletePaletteColors.bind(this, colorIndex, true));\n    }\n    contextMenu.defaultSection().appendItem(\n        i18nString(UIStrings.clearPalette), this._deletePaletteColors.bind(this, -1, true));\n    contextMenu.show();\n  }\n\n  _deletePaletteColors(colorIndex: number, toRight: boolean): void {\n    const palette = this._customPaletteSetting.get() as Palette;\n    if (toRight) {\n      palette.colors.splice(colorIndex + 1, palette.colors.length - colorIndex - 1);\n    } else {\n      palette.colors.splice(colorIndex, 1);\n    }\n    this._customPaletteSetting.set(palette);\n    this._showPalette(palette, false);\n  }\n\n  setColor(color: Common.Color.Color, colorFormat: string): void {\n    this._originalFormat = colorFormat;\n    this._innerSetColor(color.hsva(), '', undefined /* colorName */, colorFormat, ChangeSource.Model);\n    const colorValues = this._color().canonicalHSLA();\n    UI.ARIAUtils.setValueNow(this._hueElement, colorValues[0]);\n    UI.ARIAUtils.setValueText(this._alphaElement, colorValues[3]);\n  }\n\n  colorSelected(color: Common.Color.Color): void {\n    this._innerSetColor(color.hsva(), '', undefined /* colorName */, undefined /* colorFormat */, ChangeSource.Other);\n  }\n\n  _innerSetColor(\n      hsva: number[]|undefined, colorString: string|undefined, colorName: string|undefined,\n      colorFormat: string|undefined, changeSource: string): void {\n    if (hsva !== undefined) {\n      this._hsv = hsva;\n    }\n    this._colorName = colorName;\n    if (colorString !== undefined) {\n      this._colorString = colorString;\n    }\n    if (colorFormat !== undefined) {\n      const cf = Common.Color.Format;\n      console.assert(colorFormat !== cf.Original, 'Spectrum\\'s color format cannot be Original');\n      if (colorFormat === cf.RGBA) {\n        colorFormat = cf.RGB;\n      } else if (colorFormat === cf.HSLA) {\n        colorFormat = cf.HSL;\n      } else if (colorFormat === cf.HEXA) {\n        colorFormat = cf.HEX;\n      } else if (colorFormat === cf.ShortHEXA) {\n        colorFormat = cf.ShortHEX;\n      }\n      this._colorFormat = colorFormat;\n    }\n\n    if (this._contrastInfo) {\n      this._contrastInfo.setColor(Common.Color.Color.fromHSVA(this._hsv), this._colorFormat);\n    }\n\n    this._updateHelperLocations();\n    this._updateUI();\n\n    if (changeSource !== ChangeSource.Input) {\n      this._updateInput();\n    }\n    if (changeSource !== ChangeSource.Model) {\n      this.dispatchEventToListeners(Events.ColorChanged, this.colorString());\n    }\n  }\n\n  _color(): Common.Color.Color {\n    return Common.Color.Color.fromHSVA(this._hsv);\n  }\n\n  colorName(): string|undefined {\n    return this._colorName;\n  }\n\n  colorString(): string {\n    if (this._colorString) {\n      return this._colorString;\n    }\n    const cf = Common.Color.Format;\n    const color = this._color();\n\n    let colorString = color.asString(this._colorFormat);\n    if (colorString) {\n      return colorString;\n    }\n\n    if (this._colorFormat === cf.Nickname) {\n      colorString = color.asString(color.hasAlpha() ? cf.HEXA : cf.HEX);\n    } else if (this._colorFormat === cf.ShortHEX) {\n      colorString = color.asString(color.detectHEXFormat());\n    } else if (this._colorFormat === cf.HEX) {\n      colorString = color.asString(cf.HEXA);\n    } else if (this._colorFormat === cf.HSL) {\n      colorString = color.asString(cf.HSLA);\n    } else {\n      colorString = color.asString(cf.RGBA);\n    }\n\n    console.assert(Boolean(colorString));\n    return colorString || '';\n  }\n\n  _updateHelperLocations(): void {\n    const h = this._hsv[0];\n    const s = this._hsv[1];\n    const v = this._hsv[2];\n    const alpha = this._hsv[3];\n\n    // Where to show the little circle that displays your current selected color.\n    this._dragX = s * this.dragWidth;\n    this._dragY = this.dragHeight - (v * this.dragHeight);\n\n    const dragX = Math.max(\n        -this._colorDragElementHeight,\n        Math.min(this.dragWidth - this._colorDragElementHeight, this._dragX - this._colorDragElementHeight));\n    const dragY = Math.max(\n        -this._colorDragElementHeight,\n        Math.min(this.dragHeight - this._colorDragElementHeight, this._dragY - this._colorDragElementHeight));\n\n    this._colorDragElement.positionAt(dragX, dragY);\n\n    // Where to show the bar that displays your current selected hue.\n    const hueSlideX = (1 - h) * this._hueAlphaWidth - this.slideHelperWidth;\n    this._hueSlider.style.left = hueSlideX + 'px';\n    const alphaSlideX = alpha * this._hueAlphaWidth - this.slideHelperWidth;\n    this._alphaSlider.style.left = alphaSlideX + 'px';\n  }\n\n  _updateInput(): void {\n    const cf = Common.Color.Format;\n    if (this._colorFormat === cf.HEX || this._colorFormat === cf.ShortHEX || this._colorFormat === cf.Nickname) {\n      this._hexContainer.hidden = false;\n      this._displayContainer.hidden = true;\n      if (this._colorFormat === cf.ShortHEX) {\n        this._hexValue.value = String(this._color().asString(this._color().detectHEXFormat()));\n      } else {  // Don't use ShortHEX if original was not in that format.\n        this._hexValue.value = String(this._color().asString(this._color().hasAlpha() ? cf.HEXA : cf.HEX));\n      }\n    } else {\n      // RGBA, HSLA display.\n      this._hexContainer.hidden = true;\n      this._displayContainer.hidden = false;\n      const isRgb = this._colorFormat === cf.RGB;\n      this._textLabels.textContent = isRgb ? 'RGBA' : 'HSLA';\n      const colorValues = isRgb ? this._color().canonicalRGBA() : this._color().canonicalHSLA();\n      for (let i = 0; i < 3; ++i) {\n        UI.ARIAUtils.setAccessibleName(\n            this._textValues[i],\n            /** R in RGBA */ i18nString(UIStrings.sInS, {\n              PH1: this._textLabels.textContent.charAt(i),\n              PH2: this._textLabels.textContent,\n            }));\n        this._textValues[i].value = String(colorValues[i]);\n        if (!isRgb && (i === 1 || i === 2)) {\n          this._textValues[i].value += '%';\n        }\n      }\n      UI.ARIAUtils.setAccessibleName(\n          this._textValues[3],\n          /** A in RGBA */ i18nString(UIStrings.sInS, {\n            PH1: this._textLabels.textContent.charAt(3),\n            PH2: this._textLabels.textContent,\n          }));\n      this._textValues[3].value = String(Math.round(colorValues[3] * 100) / 100);\n    }\n  }\n\n  _updateUI(): void {\n    const h = Common.Color.Color.fromHSVA([this._hsv[0], 1, 1, 1]);\n    this._colorElement.style.backgroundColor = h.asString(Common.Color.Format.RGB) as string;\n    if (this._contrastOverlay) {\n      this._contrastOverlay.setDimensions(this.dragWidth, this.dragHeight);\n    }\n\n    this._swatch.setColor(this._color(), this.colorString());\n    this._colorDragElement.style.backgroundColor = this._color().asString(Common.Color.Format.RGBA) as string;\n    const noAlpha = Common.Color.Color.fromHSVA(this._hsv.slice(0, 3).concat(1));\n    this._alphaElementBackground.style.backgroundImage = Platform.StringUtilities.sprintf(\n        'linear-gradient(to right, rgba(0,0,0,0), %s)', noAlpha.asString(Common.Color.Format.RGB));\n  }\n\n  _formatViewSwitch(): void {\n    const cf = Common.Color.Format;\n    let format: string = cf.RGB;\n    if (this._colorFormat === cf.RGB) {\n      format = cf.HSL;\n    } else if (this._colorFormat === cf.HSL) {\n      format = (this._originalFormat === cf.ShortHEX || this._originalFormat === cf.ShortHEXA) ? cf.ShortHEX : cf.HEX;\n    }\n    this._innerSetColor(undefined, '', undefined /* colorName */, format, ChangeSource.Other);\n  }\n\n  /**\n   * If the pasted input is parsable as a color, applies it converting to the current user format\n   */\n  _pasted(/** @type {!ClipboardEvent} */ event: ClipboardEvent): void {\n    if (!event.clipboardData) {\n      return;\n    }\n    const text = event.clipboardData.getData('text');\n    const color = Common.Color.Color.parse(text);\n    if (!color) {\n      return;\n    }\n    this._innerSetColor(color.hsva(), text, undefined /* colorName */, undefined /* colorFormat */, ChangeSource.Other);\n    event.preventDefault();\n  }\n\n  _inputChanged(event: Event): void {\n    function elementValue(element: HTMLInputElement): string {\n      return element.value;\n    }\n\n    const inputElement = event.currentTarget as HTMLInputElement;\n    const newValue = UI.UIUtils.createReplacementString(inputElement.value, event);\n    if (newValue) {\n      inputElement.value = newValue;\n      inputElement.selectionStart = 0;\n      inputElement.selectionEnd = newValue.length;\n      event.consume(true);\n    }\n\n    const cf = Common.Color.Format;\n    let colorString;\n    if (this._colorFormat === cf.Nickname || this._colorFormat === cf.HEX || this._colorFormat === cf.ShortHEX) {\n      colorString = this._hexValue.value;\n    } else {\n      const format = this._colorFormat === cf.RGB ? 'rgb' : 'hsl';\n      const values = this._textValues.slice(0, -1).map(elementValue).join(' ');\n      const alpha = this._textValues.slice(-1).map(elementValue).join(' ');\n      colorString = Platform.StringUtilities.sprintf('%s(%s)', format, [values, alpha].join(' / '));\n    }\n\n    const color = Common.Color.Color.parse(colorString);\n    if (!color) {\n      return;\n    }\n\n    let colorFormat: string|undefined = undefined;\n    if (this._colorFormat === cf.HEX || this._colorFormat === cf.ShortHEX) {\n      colorFormat = color.detectHEXFormat();\n    }\n    this._innerSetColor(color.hsva(), colorString, undefined /* colorName */, colorFormat, ChangeSource.Input);\n  }\n\n  wasShown(): void {\n    this._hueAlphaWidth = this._hueElement.offsetWidth;\n    this.slideHelperWidth = this._hueSlider.offsetWidth / 2;\n    this.dragWidth = this._colorElement.offsetWidth;\n    this.dragHeight = this._colorElement.offsetHeight;\n    this._colorDragElementHeight = this._colorDragElement.offsetHeight / 2;\n    this._innerSetColor(undefined, undefined, undefined /* colorName */, undefined, ChangeSource.Model);\n    this._toggleColorPicker(true);\n\n    if (this._contrastDetails && this._contrastDetailsBackgroundColorPickedToggledBound) {\n      this._contrastDetails.addEventListener(\n          ContrastDetailsEvents.BackgroundColorPickerWillBeToggled,\n          this._contrastDetailsBackgroundColorPickedToggledBound);\n    }\n  }\n\n  willHide(): void {\n    this._toggleColorPicker(false);\n    if (this._contrastDetails && this._contrastDetailsBackgroundColorPickedToggledBound) {\n      this._contrastDetails.removeEventListener(\n          ContrastDetailsEvents.BackgroundColorPickerWillBeToggled,\n          this._contrastDetailsBackgroundColorPickedToggledBound);\n    }\n  }\n\n  _toggleColorPicker(enabled?: boolean, _event?: Common.EventTarget.EventTargetEvent): void {\n    if (enabled === undefined) {\n      enabled = !this._colorPickerButton.toggled();\n    }\n    this._colorPickerButton.setToggled(enabled);\n\n    // This is to make sure that only one picker is open at a time\n    // Also have a look at this._contrastDetailsBackgroundColorPickedToggled\n    if (this._contrastDetails && enabled && this._contrastDetails.backgroundColorPickerEnabled()) {\n      this._contrastDetails.toggleBackgroundColorPicker(false);\n    }\n\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.setEyeDropperActive(enabled);\n    if (enabled) {\n      Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(\n          Host.InspectorFrontendHostAPI.Events.EyeDropperPickedColor, this._colorPickedBound);\n    } else {\n      Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.removeEventListener(\n          Host.InspectorFrontendHostAPI.Events.EyeDropperPickedColor, this._colorPickedBound);\n    }\n  }\n\n  _colorPicked(event: Common.EventTarget.EventTargetEvent): void {\n    const rgbColor = event.data as {\n      r: number,\n      g: number,\n      b: number,\n      a: number,\n    };\n    const rgba = [rgbColor.r, rgbColor.g, rgbColor.b, (rgbColor.a / 2.55 | 0) / 100];\n    const color = Common.Color.Color.fromRGBA(rgba);\n    this._innerSetColor(color.hsva(), '', undefined /* colorName */, undefined, ChangeSource.Other);\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.bringToFront();\n  }\n}\n\nexport const ChangeSource = {\n  Input: 'Input',\n  Model: 'Model',\n  Other: 'Other',\n};\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum Events {\n  ColorChanged = 'ColorChanged',\n  SizeChanged = 'SizeChanged',\n}\n\nconst COLOR_CHIP_SIZE = 24;\nconst ITEMS_PER_PALETTE_ROW = 8;\nconst GeneratedPaletteTitle = 'Page colors';\n\nexport class PaletteGenerator {\n  _callback: (arg0: Palette) => void;\n  _frequencyMap: Map<string, number>;\n  constructor(callback: (arg0: Palette) => void) {\n    this._callback = callback;\n    this._frequencyMap = new Map();\n    const stylesheetPromises = [];\n    for (const cssModel of SDK.TargetManager.TargetManager.instance().models(SDK.CSSModel.CSSModel)) {\n      for (const stylesheet of cssModel.allStyleSheets()) {\n        stylesheetPromises.push(this._processStylesheet(stylesheet));\n      }\n    }\n    Promise.all(stylesheetPromises)\n        .catch(error => {\n          console.error(error);\n        })\n        .then(this._finish.bind(this));\n  }\n\n  _frequencyComparator(a: string, b: string): number {\n    return (this._frequencyMap.get(b) as number) - (this._frequencyMap.get(a) as number);\n  }\n\n  _finish(): void {\n    function hueComparator(a: string, b: string): number {\n      const hsva = (paletteColors.get(a) as Common.Color.Color).hsva();\n      const hsvb = (paletteColors.get(b) as Common.Color.Color).hsva();\n\n      // First trim the shades of gray\n      if (hsvb[1] < 0.12 && hsva[1] < 0.12) {\n        return hsvb[2] * hsvb[3] - hsva[2] * hsva[3];\n      }\n      if (hsvb[1] < 0.12) {\n        return -1;\n      }\n      if (hsva[1] < 0.12) {\n        return 1;\n      }\n\n      // Equal hue -> sort by sat\n      if (hsvb[0] === hsva[0]) {\n        return hsvb[1] * hsvb[3] - hsva[1] * hsva[3];\n      }\n\n      return (hsvb[0] + 0.94) % 1 - (hsva[0] + 0.94) % 1;\n    }\n\n    let colors: string[]|string[] = [...this._frequencyMap.keys()];\n    colors = colors.sort(this._frequencyComparator.bind(this));\n    const paletteColors = new Map<string, Common.Color.Color>();\n    const colorsPerRow = 24;\n    while (paletteColors.size < colorsPerRow && colors.length) {\n      const colorText = colors.shift() as string;\n      const color = Common.Color.Color.parse(colorText);\n      if (!color || color.nickname() === 'white' || color.nickname() === 'black') {\n        continue;\n      }\n      paletteColors.set(colorText, color);\n    }\n\n    this._callback({\n      title: GeneratedPaletteTitle,\n      colors: [...paletteColors.keys()].sort(hueComparator),\n      colorNames: [],\n      mutable: false,\n      matchUserFormat: undefined,\n    });\n  }\n\n  async _processStylesheet(stylesheet: SDK.CSSStyleSheetHeader.CSSStyleSheetHeader): Promise<void> {\n    let text: string = (await stylesheet.requestContent()).content || '';\n    text = text.toLowerCase();\n    const regexResult = text.match(/((?:rgb|hsl)a?\\([^)]+\\)|#[0-9a-f]{6}|#[0-9a-f]{3})/g) || [];\n    for (const c of regexResult) {\n      let frequency = this._frequencyMap.get(c) || 0;\n      this._frequencyMap.set(c, ++frequency);\n    }\n  }\n}\n\nexport const MaterialPaletteShades: {\n  [x: string]: string[],\n} = {\n  '#F44336':\n      ['#FFEBEE', '#FFCDD2', '#EF9A9A', '#E57373', '#EF5350', '#F44336', '#E53935', '#D32F2F', '#C62828', '#B71C1C'],\n  '#E91E63':\n      ['#FCE4EC', '#F8BBD0', '#F48FB1', '#F06292', '#EC407A', '#E91E63', '#D81B60', '#C2185B', '#AD1457', '#880E4F'],\n  '#9C27B0':\n      ['#F3E5F5', '#E1BEE7', '#CE93D8', '#BA68C8', '#AB47BC', '#9C27B0', '#8E24AA', '#7B1FA2', '#6A1B9A', '#4A148C'],\n  '#673AB7':\n      ['#EDE7F6', '#D1C4E9', '#B39DDB', '#9575CD', '#7E57C2', '#673AB7', '#5E35B1', '#512DA8', '#4527A0', '#311B92'],\n  '#3F51B5':\n      ['#E8EAF6', '#C5CAE9', '#9FA8DA', '#7986CB', '#5C6BC0', '#3F51B5', '#3949AB', '#303F9F', '#283593', '#1A237E'],\n  '#2196F3':\n      ['#E3F2FD', '#BBDEFB', '#90CAF9', '#64B5F6', '#42A5F5', '#2196F3', '#1E88E5', '#1976D2', '#1565C0', '#0D47A1'],\n  '#03A9F4':\n      ['#E1F5FE', '#B3E5FC', '#81D4FA', '#4FC3F7', '#29B6F6', '#03A9F4', '#039BE5', '#0288D1', '#0277BD', '#01579B'],\n  '#00BCD4':\n      ['#E0F7FA', '#B2EBF2', '#80DEEA', '#4DD0E1', '#26C6DA', '#00BCD4', '#00ACC1', '#0097A7', '#00838F', '#006064'],\n  '#009688':\n      ['#E0F2F1', '#B2DFDB', '#80CBC4', '#4DB6AC', '#26A69A', '#009688', '#00897B', '#00796B', '#00695C', '#004D40'],\n  '#4CAF50':\n      ['#E8F5E9', '#C8E6C9', '#A5D6A7', '#81C784', '#66BB6A', '#4CAF50', '#43A047', '#388E3C', '#2E7D32', '#1B5E20'],\n  '#8BC34A':\n      ['#F1F8E9', '#DCEDC8', '#C5E1A5', '#AED581', '#9CCC65', '#8BC34A', '#7CB342', '#689F38', '#558B2F', '#33691E'],\n  '#CDDC39':\n      ['#F9FBE7', '#F0F4C3', '#E6EE9C', '#DCE775', '#D4E157', '#CDDC39', '#C0CA33', '#AFB42B', '#9E9D24', '#827717'],\n  '#FFEB3B':\n      ['#FFFDE7', '#FFF9C4', '#FFF59D', '#FFF176', '#FFEE58', '#FFEB3B', '#FDD835', '#FBC02D', '#F9A825', '#F57F17'],\n  '#FFC107':\n      ['#FFF8E1', '#FFECB3', '#FFE082', '#FFD54F', '#FFCA28', '#FFC107', '#FFB300', '#FFA000', '#FF8F00', '#FF6F00'],\n  '#FF9800':\n      ['#FFF3E0', '#FFE0B2', '#FFCC80', '#FFB74D', '#FFA726', '#FF9800', '#FB8C00', '#F57C00', '#EF6C00', '#E65100'],\n  '#FF5722':\n      ['#FBE9E7', '#FFCCBC', '#FFAB91', '#FF8A65', '#FF7043', '#FF5722', '#F4511E', '#E64A19', '#D84315', '#BF360C'],\n  '#795548':\n      ['#EFEBE9', '#D7CCC8', '#BCAAA4', '#A1887F', '#8D6E63', '#795548', '#6D4C41', '#5D4037', '#4E342E', '#3E2723'],\n  '#9E9E9E':\n      ['#FAFAFA', '#F5F5F5', '#EEEEEE', '#E0E0E0', '#BDBDBD', '#9E9E9E', '#757575', '#616161', '#424242', '#212121'],\n  '#607D8B':\n      ['#ECEFF1', '#CFD8DC', '#B0BEC5', '#90A4AE', '#78909C', '#607D8B', '#546E7A', '#455A64', '#37474F', '#263238'],\n};\n\nexport const MaterialPalette = {\n  title: 'Material',\n  mutable: false,\n  matchUserFormat: true,\n  colors: Object.keys(MaterialPaletteShades),\n  colorNames: [],\n};\n\nexport class Swatch {\n  _colorString!: string|null;\n  _swatchInnerElement: HTMLElement;\n  _swatchOverlayElement: HTMLElement;\n  _swatchCopyIcon: UI.Icon.Icon;\n  constructor(parentElement: HTMLElement) {\n    const swatchElement = parentElement.createChild('span', 'swatch');\n    this._swatchInnerElement = swatchElement.createChild('span', 'swatch-inner');\n    this._swatchOverlayElement = swatchElement.createChild('span', 'swatch-overlay') as HTMLElement;\n    UI.ARIAUtils.markAsButton(this._swatchOverlayElement);\n    UI.ARIAUtils.setPressed(this._swatchOverlayElement, false);\n    this._swatchOverlayElement.tabIndex = 0;\n    self.onInvokeElement(this._swatchOverlayElement, this._onCopyText.bind(this));\n    this._swatchOverlayElement.addEventListener('mouseout', this._onCopyIconMouseout.bind(this));\n    this._swatchOverlayElement.addEventListener('blur', this._onCopyIconMouseout.bind(this));\n    this._swatchCopyIcon = UI.Icon.Icon.create('largeicon-copy', 'copy-color-icon');\n    UI.Tooltip.Tooltip.install(this._swatchCopyIcon, i18nString(UIStrings.copyColorToClipboard));\n    this._swatchOverlayElement.appendChild(this._swatchCopyIcon);\n    UI.ARIAUtils.setAccessibleName(this._swatchOverlayElement, this._swatchCopyIcon.title);\n  }\n\n  setColor(color: Common.Color.Color, colorString?: string): void {\n    this._swatchInnerElement.style.backgroundColor = color.asString(Common.Color.Format.RGBA) as string;\n    // Show border if the swatch is white.\n    this._swatchInnerElement.classList.toggle('swatch-inner-white', color.hsla()[2] > 0.9);\n    this._colorString = colorString || null;\n    if (colorString) {\n      this._swatchOverlayElement.hidden = false;\n    } else {\n      this._swatchOverlayElement.hidden = true;\n    }\n  }\n\n  _onCopyText(event: Event): void {\n    this._swatchCopyIcon.setIconType('largeicon-checkmark');\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(this._colorString);\n    UI.ARIAUtils.setPressed(this._swatchOverlayElement, true);\n    event.consume();\n  }\n\n  _onCopyIconMouseout(): void {\n    this._swatchCopyIcon.setIconType('largeicon-copy');\n    UI.ARIAUtils.setPressed(this._swatchOverlayElement, false);\n  }\n}\nexport interface Palette {\n  title: string;\n  colors: string[];\n  colorNames: string[];\n  mutable: boolean;\n  matchUserFormat?: boolean;\n}\n"]}