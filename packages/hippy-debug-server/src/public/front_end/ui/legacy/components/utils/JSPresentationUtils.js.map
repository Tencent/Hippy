{"version":3,"file":"JSPresentationUtils.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/utils/JSPresentationUtils.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/*\n * Copyright (C) 2011 Google Inc.  All rights reserved.\n * Copyright (C) 2007, 2008 Apple Inc.  All rights reserved.\n * Copyright (C) 2008 Matt Lilek <webkit@mattlilek.com>\n * Copyright (C) 2009 Joseph Pecoraro\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport type * as SDK from '../../../../core/sdk/sdk.js'; // eslint-disable-line no-unused-vars\nimport * as Bindings from '../../../../models/bindings/bindings.js';\nimport type * as Protocol from '../../../../generated/protocol.js';\nimport * as UI from '../../legacy.js';\n\nimport {Linkifier} from './Linkifier.js';\n\nconst UIStrings = {\n  /**\n  *@description Text to stop preventing the debugger from stepping into library code\n  */\n  removeFromIgnore: 'Remove from ignore list',\n  /**\n  *@description Text for scripts that should not be stepped into when debugging\n  */\n  addToIgnore: 'Add script to ignore list',\n  /**\n  * @description A context menu item to show more frames when they are available. Never 0.\n  */\n  showSMoreFrames: '{n, plural, =1 {Show # more frame} other {Show # more frames}}',\n  /**\n   *@description Text indicating that source url of a link is currently unknown\n   */\n  unknownSource: 'unknown',\n};\nconst str_ = i18n.i18n.registerUIStrings('ui/legacy/components/utils/JSPresentationUtils.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nfunction populateContextMenu(link: Element, event: Event): void {\n  const contextMenu = new UI.ContextMenu.ContextMenu(event);\n  event.consume(true);\n  const uiLocation = Linkifier.uiLocation(link);\n  if (uiLocation &&\n      Bindings.IgnoreListManager.IgnoreListManager.instance().canIgnoreListUISourceCode(uiLocation.uiSourceCode)) {\n    if (Bindings.IgnoreListManager.IgnoreListManager.instance().isIgnoreListedUISourceCode(uiLocation.uiSourceCode)) {\n      contextMenu.debugSection().appendItem(\n          i18nString(UIStrings.removeFromIgnore),\n          () => Bindings.IgnoreListManager.IgnoreListManager.instance().unIgnoreListUISourceCode(\n              uiLocation.uiSourceCode));\n    } else {\n      contextMenu.debugSection().appendItem(\n          i18nString(UIStrings.addToIgnore),\n          () =>\n              Bindings.IgnoreListManager.IgnoreListManager.instance().ignoreListUISourceCode(uiLocation.uiSourceCode));\n    }\n  }\n  contextMenu.appendApplicableItems(event);\n  contextMenu.show();\n}\n\nexport function buildStackTraceRows(\n    stackTrace: Protocol.Runtime.StackTrace,\n    target: SDK.Target.Target|null,\n    linkifier: Linkifier,\n    tabStops: boolean|undefined,\n    updateCallback?: (arg0: (StackTraceRegularRow|StackTraceAsyncRow)[]) => void,\n    ): (StackTraceRegularRow|StackTraceAsyncRow)[] {\n  const stackTraceRows: (StackTraceRegularRow|StackTraceAsyncRow)[] = [];\n  let regularRowCount = 0;\n\n  if (updateCallback) {\n    const throttler = new Common.Throttler.Throttler(100);\n    linkifier.setLiveLocationUpdateCallback(\n        () => throttler.schedule(async () => updateHiddenRows(updateCallback, stackTraceRows)));\n  }\n\n  function buildStackTraceRowsHelper(stackTrace: Protocol.Runtime.StackTrace, asyncFlag: boolean): void {\n    let asyncRow: StackTraceAsyncRow|null = null;\n    if (asyncFlag) {\n      asyncRow = {\n        asyncDescription: UI.UIUtils.asyncStackTraceLabel(stackTrace.description),\n        ignoreListHide: false,\n        rowCountHide: false,\n      };\n      stackTraceRows.push(asyncRow);\n    }\n    let hiddenCallFrames = 0;\n    for (const stackFrame of stackTrace.callFrames) {\n      regularRowCount++;\n      const rowCountHide = regularRowCount > 30 && stackTrace.callFrames.length > 31;\n      let ignoreListHide = false;\n      const functionName = UI.UIUtils.beautifyFunctionName(stackFrame.functionName);\n      const link = linkifier.maybeLinkifyConsoleCallFrame(\n          target, stackFrame,\n          {tabStop: Boolean(tabStops), className: undefined, columnNumber: undefined, inlineFrameIndex: 0});\n      if (link) {\n        link.addEventListener('contextmenu', populateContextMenu.bind(null, link));\n        // TODO(crbug.com/1183325): fix race condition with uiLocation still being null here\n        const uiLocation = Linkifier.uiLocation(link);\n        if (uiLocation &&\n            Bindings.IgnoreListManager.IgnoreListManager.instance().isIgnoreListedUISourceCode(\n                uiLocation.uiSourceCode)) {\n          ignoreListHide = true;\n        }\n        // Linkifier is using a workaround with the 'zero width space' (\\u200b).\n        // TODO(szuend): Remove once the Linkfier is no longer using the workaround.\n        if (!link.textContent || link.textContent === '\\u200b') {\n          link.textContent = i18nString(UIStrings.unknownSource);\n        }\n      }\n      if (rowCountHide || ignoreListHide) {\n        ++hiddenCallFrames;\n      }\n      stackTraceRows.push({functionName, link, ignoreListHide, rowCountHide});\n    }\n    if (asyncFlag && asyncRow && hiddenCallFrames > 0 && hiddenCallFrames === stackTrace.callFrames.length) {\n      stackTraceRows[1].rowCountHide ? asyncRow.rowCountHide = true : asyncRow.ignoreListHide = true;\n    }\n  }\n\n  buildStackTraceRowsHelper(stackTrace, false);\n  let asyncStackTrace = stackTrace.parent;\n  while (asyncStackTrace) {\n    if (asyncStackTrace.callFrames.length) {\n      buildStackTraceRowsHelper(asyncStackTrace, true);\n    }\n    asyncStackTrace = asyncStackTrace.parent;\n  }\n  return stackTraceRows;\n}\n\n/**\n * @param {function(!Array<!StackTraceRegularRow|!StackTraceAsyncRow>): *} renderCallback\n * @param {!Array<!StackTraceRegularRow|!StackTraceAsyncRow>} stackTraceRows\n */\nfunction updateHiddenRows(\n    renderCallback: (arg0: (StackTraceRegularRow|StackTraceAsyncRow)[]) => void,\n    stackTraceRows: (StackTraceRegularRow|StackTraceAsyncRow)[],\n    ): void {\n  let shouldHideSubCount = 0;  // keeps track of number hidden (regular) rows between asyncRows\n  let indexOfAsyncRow = stackTraceRows.length;\n\n  for (let i = stackTraceRows.length - 1; i >= 0; i--) {\n    const row = stackTraceRows[i];\n\n    if ('link' in row && row.link) {\n      const uiLocation = Linkifier.uiLocation(row.link);\n      if (uiLocation &&\n          Bindings.IgnoreListManager.IgnoreListManager.instance().isIgnoreListedUISourceCode(uiLocation.uiSourceCode)) {\n        row.ignoreListHide = true;\n      }\n      if (row.rowCountHide || row.ignoreListHide) {\n        shouldHideSubCount++;\n      }\n    }\n    if ('asyncDescription' in row) {\n      // hide current row if all (regular) rows since the previous asyncRow are hidden\n      if (shouldHideSubCount > 0 && shouldHideSubCount === indexOfAsyncRow - i - 1) {\n        stackTraceRows[i + 1].rowCountHide ? row.rowCountHide = true : row.ignoreListHide = true;\n      }\n      indexOfAsyncRow = i;\n      shouldHideSubCount = 0;\n    }\n  }\n  renderCallback(stackTraceRows);\n}\n\nexport function buildStackTracePreviewContents(\n    target: SDK.Target.Target|null, linkifier: Linkifier, options: Options = {\n      stackTrace: undefined,\n      tabStops: undefined,\n    }): {element: HTMLElement, links: HTMLElement[]} {\n  const {stackTrace, tabStops} = options;\n  const element = document.createElement('span');\n  element.classList.add('monospace');\n  element.style.display = 'inline-block';\n  const shadowRoot = UI.Utils.createShadowRootWithCoreStyles(\n      element,\n      {cssFile: 'ui/legacy/components/utils/jsUtils.css', enableLegacyPatching: false, delegatesFocus: undefined});\n  const contentElement = shadowRoot.createChild('table', 'stack-preview-container');\n  if (!stackTrace) {\n    return {element, links: []};\n  }\n\n  const updateCallback = renderStackTraceTable.bind(null, contentElement);\n  const stackTraceRows = buildStackTraceRows(stackTrace, target, linkifier, tabStops, updateCallback);\n  const links = renderStackTraceTable(contentElement, stackTraceRows);\n  return {element, links};\n}\n\nfunction renderStackTraceTable(\n    container: Element, stackTraceRows: (StackTraceRegularRow|StackTraceAsyncRow)[]): HTMLElement[] {\n  container.removeChildren();\n  let hiddenCallFramesCount = 0;\n  const links: HTMLElement[] = [];\n\n  for (const item of stackTraceRows) {\n    const row = container.createChild('tr');\n    if ('asyncDescription' in item) {\n      row.createChild('td').textContent = '\\n';\n      row.createChild('td', 'stack-preview-async-description').textContent = item.asyncDescription;\n      row.createChild('td');\n      row.createChild('td');\n    } else {\n      row.createChild('td').textContent = '\\n';\n      row.createChild('td', 'function-name').textContent = item.functionName;\n      row.createChild('td').textContent = ' @ ';\n      if (item.link) {\n        row.createChild('td').appendChild(item.link);\n        links.push(item.link);\n      }\n      if (item.rowCountHide || item.ignoreListHide) {\n        ++hiddenCallFramesCount;\n      }\n    }\n    if (item.rowCountHide || item.ignoreListHide) {\n      row.classList.add('hidden-row');\n    }\n    container.appendChild(row);\n  }\n\n  if (hiddenCallFramesCount) {\n    const showAllRow = container.createChild('tr', 'show-all-link');\n    showAllRow.createChild('td').textContent = '\\n';\n    const cell = showAllRow.createChild('td') as HTMLTableCellElement;\n    cell.colSpan = 4;\n    const showAllLink = cell.createChild('span', 'link');\n    showAllLink.textContent = i18nString(UIStrings.showSMoreFrames, {n: hiddenCallFramesCount});\n    showAllLink.addEventListener('click', () => {\n      container.classList.add('show-hidden-rows');\n    }, false);\n  }\n  return links;\n}\n\nexport interface Options {\n  stackTrace: Protocol.Runtime.StackTrace|undefined;\n  tabStops: boolean|undefined;\n}\n\nexport interface StackTraceRegularRow {\n  functionName: string;\n  ignoreListHide: boolean;\n  link: HTMLElement|null;\n  rowCountHide: boolean;\n}\n\nexport interface StackTraceAsyncRow {\n  asyncDescription: string;\n  ignoreListHide: boolean;\n  rowCountHide: boolean;\n}\n"]}