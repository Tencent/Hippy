{"version":3,"file":"CSSAngle.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/inline_editor/CSSAngle.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as ComponentHelpers from '../../../components/helpers/helpers.js';\nimport * as LitHtml from '../../../lit-html/lit-html.js';\n\nimport type {Angle} from './CSSAngleUtils.js';\nimport {AngleUnit, convertAngleUnit, getNewAngleFromEvent, getNextUnit, parseText, roundAngleByUnit} from './CSSAngleUtils.js';\n\nimport type {CSSAngleEditorData} from './CSSAngleEditor.js';\nimport {CSSAngleEditor} from './CSSAngleEditor.js';\nimport type {CSSAngleSwatchData} from './CSSAngleSwatch.js';\nimport {CSSAngleSwatch} from './CSSAngleSwatch.js';\n\nconst {render, html} = LitHtml;\nconst styleMap = LitHtml.Directives.styleMap;\n\nconst ContextAwareProperties = new Set(['color', 'background', 'background-color']);\n\nexport class PopoverToggledEvent extends Event {\n  data: {open: boolean};\n\n  constructor(open: boolean) {\n    super('popovertoggled', {});\n    this.data = {open};\n  }\n}\n\nexport class ValueChangedEvent extends Event {\n  data: {value: string};\n\n  constructor(value: string) {\n    super('valuechanged', {});\n    this.data = {value};\n  }\n}\n\nexport class UnitChangedEvent extends Event {\n  data: {value: string};\n\n  constructor(value: string) {\n    super('unitchanged', {});\n    this.data = {value};\n  }\n}\n\nexport interface CSSAngleData {\n  propertyName: string;\n  propertyValue: string;\n  angleText: string;\n  containingPane: HTMLElement;\n}\n\nconst DefaultAngle = {\n  value: 0,\n  unit: AngleUnit.Rad,\n};\n\nexport class CSSAngle extends HTMLElement {\n  private readonly shadow = this.attachShadow({mode: 'open'});\n  private angle: Angle = DefaultAngle;\n  private displayedAngle: Angle = DefaultAngle;\n  private propertyName = '';\n  private propertyValue = '';\n  private containingPane?: HTMLElement;\n  private angleElement: HTMLElement|null = null;\n  private swatchElement: HTMLElement|null = null;\n  private popoverOpen = false;\n  private popoverStyleTop = '';\n  private popoverStyleLeft = '';\n  private onMinifyingAction = this.minify.bind(this);\n  private onAngleUpdate = this.updateAngle.bind(this);\n\n  set data(data: CSSAngleData) {\n    const parsedResult = parseText(data.angleText);\n    if (!parsedResult) {\n      return;\n    }\n    this.angle = parsedResult;\n    this.displayedAngle = {...parsedResult};\n    this.propertyName = data.propertyName;\n    this.propertyValue = data.propertyValue;\n    this.containingPane = data.containingPane;\n    this.render();\n  }\n\n  disconnectedCallback(): void {\n    this.unbindMinifyingAction();\n  }\n\n  // We bind and unbind mouse event listeners upon popping over and minifying,\n  // because we anticipate most of the time this widget is minified even when\n  // it's attached to the DOM tree.\n  popover(): void {\n    if (!this.containingPane) {\n      return;\n    }\n\n    if (!this.angleElement) {\n      this.angleElement = this.shadow.querySelector<HTMLElement>('.css-angle');\n    }\n    if (!this.swatchElement) {\n      this.swatchElement = this.shadow.querySelector<HTMLElement>('devtools-css-angle-swatch');\n    }\n    if (!this.angleElement || !this.swatchElement) {\n      return;\n    }\n\n    this.dispatchEvent(new PopoverToggledEvent(true));\n    this.bindMinifyingAction();\n\n    const miniIconBottom = this.swatchElement.getBoundingClientRect().bottom;\n    const miniIconLeft = this.swatchElement.getBoundingClientRect().left;\n    if (miniIconBottom && miniIconLeft) {\n      // We offset mini icon's X and Y positions with the containing styles\n      // pane's positions because DevTools' root SplitWidget's\n      // insertion-point-sidebar slot, where most of the DevTools content lives,\n      // has an offset of positions, which makes all of its children's DOMRect\n      // positions to have this offset.\n      const offsetTop = this.containingPane.getBoundingClientRect().top;\n      const offsetLeft = this.containingPane.getBoundingClientRect().left;\n      this.popoverStyleTop = `${miniIconBottom - offsetTop}px`;\n      this.popoverStyleLeft = `${miniIconLeft - offsetLeft}px`;\n    }\n\n    this.popoverOpen = true;\n    this.render();\n    this.angleElement.focus();\n  }\n\n  minify(): void {\n    if (this.popoverOpen === false) {\n      return;\n    }\n\n    this.popoverOpen = false;\n    this.dispatchEvent(new PopoverToggledEvent(false));\n    this.unbindMinifyingAction();\n    this.render();\n  }\n\n  updateProperty(name: string, value: string): void {\n    this.propertyName = name;\n    this.propertyValue = value;\n    this.render();\n  }\n\n  private updateAngle(angle: Angle): void {\n    this.displayedAngle = roundAngleByUnit(convertAngleUnit(angle, this.displayedAngle.unit));\n    this.angle = this.displayedAngle;\n    this.dispatchEvent(new ValueChangedEvent(`${this.angle.value}${this.angle.unit}`));\n  }\n\n  private displayNextUnit(): void {\n    const nextUnit = getNextUnit(this.displayedAngle.unit);\n    this.displayedAngle = roundAngleByUnit(convertAngleUnit(this.angle, nextUnit));\n    this.dispatchEvent(new UnitChangedEvent(`${this.displayedAngle.value}${this.displayedAngle.unit}`));\n  }\n\n  private bindMinifyingAction(): void {\n    document.addEventListener('mousedown', this.onMinifyingAction);\n    if (this.containingPane) {\n      this.containingPane.addEventListener('scroll', this.onMinifyingAction);\n    }\n  }\n\n  private unbindMinifyingAction(): void {\n    document.removeEventListener('mousedown', this.onMinifyingAction);\n    if (this.containingPane) {\n      this.containingPane.removeEventListener('scroll', this.onMinifyingAction);\n    }\n  }\n\n  private onMiniIconClick(event: MouseEvent): void {\n    event.stopPropagation();\n    if (event.shiftKey && !this.popoverOpen) {\n      this.displayNextUnit();\n      return;\n    }\n    this.popoverOpen ? this.minify() : this.popover();\n  }\n\n  // Fix that the previous text will be selected when double-clicking the angle icon\n  private consume(event: MouseEvent): void {\n    event.stopPropagation();\n  }\n\n  private onKeydown(event: KeyboardEvent): void {\n    if (!this.popoverOpen) {\n      return;\n    }\n\n    switch (event.key) {\n      case 'Escape':\n        event.stopPropagation();\n        this.minify();\n        this.blur();\n        break;\n      case 'ArrowUp':\n      case 'ArrowDown': {\n        const newAngle = getNewAngleFromEvent(this.angle, event);\n        if (newAngle) {\n          this.updateAngle(newAngle);\n        }\n        event.preventDefault();\n        break;\n      }\n    }\n  }\n\n  private render(): void {\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    render(html`\n      <style>\n        .css-angle {\n          display: inline-block;\n          position: relative;\n          outline: none;\n        }\n\n        devtools-css-angle-swatch {\n          display: inline-block;\n          margin-right: 2px;\n          user-select: none;\n        }\n\n        devtools-css-angle-editor {\n          --dial-color: #a3a3a3;\n          --border-color: var(--color-background-elevation-1);\n\n          position: fixed;\n          z-index: 2;\n        }\n      </style>\n\n      <div class=\"css-angle\" @keydown=${this.onKeydown} tabindex=\"-1\">\n        <div class=\"preview\">\n          <${CSSAngleSwatch.litTagName}\n            @click=${this.onMiniIconClick}\n            @mousedown=${this.consume}\n            @dblclick=${this.consume}\n            .data=${{\n              angle: this.angle,\n            } as CSSAngleSwatchData}>\n          </${CSSAngleSwatch.litTagName}><slot></slot>\n        </div>\n        ${this.popoverOpen ? this.renderPopover() : null}\n      </div>\n    `, this.shadow, {\n      host: this,\n    });\n    // clang-format on\n  }\n\n  private renderPopover(): LitHtml.TemplateResult {\n    let contextualBackground = '';\n    // TODO(crbug.com/1143010): for now we ignore values with \"url\"; when we refactor\n    // CSS value parsing we should properly apply atomic contextual background.\n    if (ContextAwareProperties.has(this.propertyName) && !this.propertyValue.match(/url\\(.*\\)/i)) {\n      contextualBackground = this.propertyValue;\n    }\n\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    return html`\n    <${CSSAngleEditor.litTagName}\n      class=\"popover popover-css-angle\"\n      style=${styleMap({top: this.popoverStyleTop, left: this.popoverStyleLeft})}\n      .data=${{\n        angle: this.angle,\n        onAngleUpdate: this.onAngleUpdate,\n        background: contextualBackground,\n      } as CSSAngleEditorData}\n    ></${CSSAngleEditor.litTagName}>\n    `;\n    // clang-format on\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('devtools-css-angle', CSSAngle);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-css-angle': CSSAngle;\n  }\n}\n"]}