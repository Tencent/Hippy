{"version":3,"file":"TracingModel.js","sourceRoot":"","sources":["../../../../../../front_end/core/sdk/TracingModel.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2014 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Common from '../common/common.js';\n\nimport type {EventPayload} from './TracingManager.js'; // eslint-disable-line no-unused-vars\n\ntype IgnoreListArgs = {\n  [key: string]: string|number|ObjectSnapshot,\n};\n\nexport class TracingModel {\n  _backingStorage: BackingStorage;\n  _firstWritePending: boolean;\n  _processById: Map<string|number, Process>;\n  // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  _processByName: Map<any, any>;\n  _minimumRecordTime: number;\n  _maximumRecordTime: number;\n  _devToolsMetadataEvents: Event[];\n  _asyncEvents: AsyncEvent[];\n  _openAsyncEvents: Map<string, AsyncEvent>;\n  _openNestableAsyncEvents: Map<string, AsyncEvent[]>;\n  _profileGroups: Map<string, ProfileEventsGroup>;\n  _parsedCategories: Map<string, Set<string>>;\n  _mainFrameNavStartTimes: Map<string, Event>;\n\n  constructor(backingStorage: BackingStorage) {\n    this._backingStorage = backingStorage;\n    // Avoid extra reset of the storage as it's expensive.\n    this._firstWritePending = true;\n    this._processById = new Map();\n    this._processByName = new Map();\n    this._minimumRecordTime = 0;\n    this._maximumRecordTime = 0;\n    this._devToolsMetadataEvents = [];\n    this._asyncEvents = [];\n    this._openAsyncEvents = new Map();\n    this._openNestableAsyncEvents = new Map();\n    this._profileGroups = new Map();\n    this._parsedCategories = new Map();\n    this._mainFrameNavStartTimes = new Map();\n  }\n\n  static isNestableAsyncPhase(phase: string): boolean {\n    return phase === 'b' || phase === 'e' || phase === 'n';\n  }\n\n  static isAsyncBeginPhase(phase: string): boolean {\n    return phase === 'S' || phase === 'b';\n  }\n\n  static isAsyncPhase(phase: string): boolean {\n    return TracingModel.isNestableAsyncPhase(phase) || phase === 'S' || phase === 'T' || phase === 'F' || phase === 'p';\n  }\n\n  static isFlowPhase(phase: string): boolean {\n    return phase === 's' || phase === 't' || phase === 'f';\n  }\n\n  static isCompletePhase(phase: string): boolean {\n    return phase === 'X';\n  }\n\n  static isTopLevelEvent(event: Event): boolean {\n    return event.hasCategory(DevToolsTimelineEventCategory) && event.name === 'RunTask' ||\n        event.hasCategory(LegacyTopLevelEventCategory) ||\n        event.hasCategory(DevToolsMetadataEventCategory) &&\n        event.name === 'Program';  // Older timelines may have this instead of toplevel.\n  }\n\n  static _extractId(payload: EventPayload): string|undefined {\n    const scope = payload.scope || '';\n    if (typeof payload.id2 === 'undefined') {\n      return scope && payload.id ? `${scope}@${payload.id}` : payload.id;\n    }\n    const id2 = payload.id2;\n    if (typeof id2 === 'object' && ('global' in id2) !== ('local' in id2)) {\n      return typeof id2['global'] !== 'undefined' ? `:${scope}:${id2['global']}` :\n                                                    `:${scope}:${payload.pid}:${id2['local']}`;\n    }\n    console.error(\n        `Unexpected id2 field at ${payload.ts / 1000}, one and only one of 'local' and 'global' should be present.`);\n    return undefined;\n  }\n\n  static browserMainThread(tracingModel: TracingModel): Thread|null {\n    const processes = tracingModel.sortedProcesses();\n    // Avoid warning for an empty model.\n    if (!processes.length) {\n      return null;\n    }\n    const browserMainThreadName = 'CrBrowserMain';\n    const browserProcesses = [];\n    const browserMainThreads = [];\n    for (const process of processes) {\n      if (process.name().toLowerCase().endsWith('browser')) {\n        browserProcesses.push(process);\n      }\n      browserMainThreads.push(...process.sortedThreads().filter(t => t.name() === browserMainThreadName));\n    }\n    if (browserMainThreads.length === 1) {\n      return browserMainThreads[0];\n    }\n    if (browserProcesses.length === 1) {\n      return browserProcesses[0].threadByName(browserMainThreadName);\n    }\n    const tracingStartedInBrowser =\n        tracingModel.devToolsMetadataEvents().filter(e => e.name === 'TracingStartedInBrowser');\n    if (tracingStartedInBrowser.length === 1) {\n      return tracingStartedInBrowser[0].thread;\n    }\n    Common.Console.Console.instance().error(\n        'Failed to find browser main thread in trace, some timeline features may be unavailable');\n    return null;\n  }\n\n  devToolsMetadataEvents(): Event[] {\n    return this._devToolsMetadataEvents;\n  }\n\n  addEvents(events: EventPayload[]): void {\n    for (let i = 0; i < events.length; ++i) {\n      this._addEvent(events[i]);\n    }\n  }\n\n  tracingComplete(): void {\n    this._processPendingAsyncEvents();\n    this._backingStorage.appendString(this._firstWritePending ? '[]' : ']');\n    this._backingStorage.finishWriting();\n    this._firstWritePending = false;\n    for (const process of this._processById.values()) {\n      for (const thread of process._threads.values()) {\n        thread.tracingComplete();\n      }\n    }\n  }\n\n  dispose(): void {\n    if (!this._firstWritePending) {\n      this._backingStorage.reset();\n    }\n  }\n\n  adjustTime(offset: number): void {\n    this._minimumRecordTime += offset;\n    this._maximumRecordTime += offset;\n    for (const process of this._processById.values()) {\n      for (const thread of process._threads.values()) {\n        for (const event of thread.events()) {\n          event.startTime += offset;\n          if (typeof event.endTime === 'number') {\n            event.endTime += offset;\n          }\n        }\n        for (const event of thread.asyncEvents()) {\n          event.startTime += offset;\n          if (typeof event.endTime === 'number') {\n            event.endTime += offset;\n          }\n        }\n      }\n    }\n  }\n\n  _addEvent(payload: EventPayload): void {\n    let process = this._processById.get(payload.pid);\n    if (!process) {\n      process = new Process(this, payload.pid);\n      this._processById.set(payload.pid, process);\n    }\n\n    const phase = Phase;\n    const eventsDelimiter = ',\\n';\n    this._backingStorage.appendString(this._firstWritePending ? '[' : eventsDelimiter);\n    this._firstWritePending = false;\n    const stringPayload = JSON.stringify(payload);\n    const isAccessible = payload.ph === phase.SnapshotObject;\n    let backingStorage: (() => Promise<string|null>)|null = null;\n    const keepStringsLessThan = 10000;\n    if (isAccessible && stringPayload.length > keepStringsLessThan) {\n      backingStorage = this._backingStorage.appendAccessibleString(stringPayload);\n    } else {\n      this._backingStorage.appendString(stringPayload);\n    }\n\n    const timestamp = payload.ts / 1000;\n    // We do allow records for unrelated threads to arrive out-of-order,\n    // so there's a chance we're getting records from the past.\n    if (timestamp && (!this._minimumRecordTime || timestamp < this._minimumRecordTime) &&\n        (payload.ph === phase.Begin || payload.ph === phase.Complete || payload.ph === phase.Instant) &&\n        // UMA related events are ignored when calculating the minimumRecordTime because they might\n        // be related to previous navigations that happened before the current trace started and\n        // will currently not be displayed anyways.\n        // See crbug.com/1201198\n        (!payload.name.endsWith('::UMA'))) {\n      this._minimumRecordTime = timestamp;\n    }\n\n    // Track only main thread navigation start items. This is done by tracking isLoadingMainFrame,\n    // and whether documentLoaderURL is set.\n    if (payload.name === 'navigationStart') {\n      const data = (payload.args.data as {\n        isLoadingMainFrame: boolean,\n        documentLoaderURL: string,\n        navigationId: string,\n      } | null);\n      if (data) {\n        const {isLoadingMainFrame, documentLoaderURL, navigationId} = data;\n        if (isLoadingMainFrame && documentLoaderURL !== '') {\n          const thread = process.threadById(payload.tid);\n          const navStartEvent = Event.fromPayload(payload, thread);\n          this._mainFrameNavStartTimes.set(navigationId, navStartEvent);\n        }\n      }\n    }\n\n    const endTimeStamp = (payload.ts + (payload.dur || 0)) / 1000;\n    this._maximumRecordTime = Math.max(this._maximumRecordTime, endTimeStamp);\n    const event = process._addEvent(payload);\n    if (!event) {\n      return;\n    }\n    if (payload.ph === phase.Sample) {\n      this._addSampleEvent(event);\n      return;\n    }\n    // Build async event when we've got events from all threads & processes, so we can sort them and process in the\n    // chronological order. However, also add individual async events to the thread flow (above), so we can easily\n    // display them on the same chart as other events, should we choose so.\n    if (TracingModel.isAsyncPhase(payload.ph)) {\n      this._asyncEvents.push((event as AsyncEvent));\n    }\n    event._setBackingStorage(backingStorage);\n    if (event.hasCategory(DevToolsMetadataEventCategory)) {\n      this._devToolsMetadataEvents.push(event);\n    }\n\n    if (payload.ph !== phase.Metadata) {\n      return;\n    }\n\n    switch (payload.name) {\n      case MetadataEvent.ProcessSortIndex: {\n        process._setSortIndex(payload.args['sort_index']);\n        break;\n      }\n      case MetadataEvent.ProcessName: {\n        const processName = payload.args['name'];\n        process._setName(processName);\n        this._processByName.set(processName, process);\n        break;\n      }\n      case MetadataEvent.ThreadSortIndex: {\n        process.threadById(payload.tid)._setSortIndex(payload.args['sort_index']);\n        break;\n      }\n      case MetadataEvent.ThreadName: {\n        process.threadById(payload.tid)._setName(payload.args['name']);\n        break;\n      }\n    }\n  }\n\n  _addSampleEvent(event: Event): void {\n    const id = `${event.thread.process().id()}:${event.id}`;\n    const group = this._profileGroups.get(id);\n    if (group) {\n      group._addChild(event);\n    } else {\n      this._profileGroups.set(id, new ProfileEventsGroup(event));\n    }\n  }\n\n  profileGroup(event: Event): ProfileEventsGroup|null {\n    return this._profileGroups.get(`${event.thread.process().id()}:${event.id}`) || null;\n  }\n\n  minimumRecordTime(): number {\n    return this._minimumRecordTime;\n  }\n\n  maximumRecordTime(): number {\n    return this._maximumRecordTime;\n  }\n\n  navStartTimes(): Map<string, Event> {\n    return this._mainFrameNavStartTimes;\n  }\n\n  sortedProcesses(): Process[] {\n    return Sorter.sort([...this._processById.values()]);\n  }\n\n  processByName(name: string): Process|null {\n    return this._processByName.get(name);\n  }\n\n  processById(pid: number): Process|null {\n    return this._processById.get(pid) || null;\n  }\n\n  threadByName(processName: string, threadName: string): Thread|null {\n    const process = this.processByName(processName);\n    return process && process.threadByName(threadName);\n  }\n\n  extractEventsFromThreadByName(processName: string, threadName: string, eventName: string): Event[] {\n    const thread = this.threadByName(processName, threadName);\n    if (!thread) {\n      return [];\n    }\n\n    return thread.removeEventsByName(eventName);\n  }\n\n  _processPendingAsyncEvents(): void {\n    this._asyncEvents.sort(Event.compareStartTime);\n    for (let i = 0; i < this._asyncEvents.length; ++i) {\n      const event = this._asyncEvents[i];\n      if (TracingModel.isNestableAsyncPhase(event.phase)) {\n        this._addNestableAsyncEvent(event);\n      } else {\n        this._addAsyncEvent(event);\n      }\n    }\n    this._asyncEvents = [];\n    this._closeOpenAsyncEvents();\n  }\n\n  _closeOpenAsyncEvents(): void {\n    for (const event of this._openAsyncEvents.values()) {\n      event.setEndTime(this._maximumRecordTime);\n      // FIXME: remove this once we figure a better way to convert async console\n      // events to sync [waterfall] timeline records.\n      event.steps[0].setEndTime(this._maximumRecordTime);\n    }\n    this._openAsyncEvents.clear();\n\n    for (const eventStack of this._openNestableAsyncEvents.values()) {\n      while (eventStack.length) {\n        const event = eventStack.pop();\n        if (!event) {\n          continue;\n        }\n        event.setEndTime(this._maximumRecordTime);\n      }\n    }\n    this._openNestableAsyncEvents.clear();\n  }\n\n  _addNestableAsyncEvent(event: Event): void {\n    const phase = Phase;\n    const key = event.categoriesString + '.' + event.id;\n    let openEventsStack = this._openNestableAsyncEvents.get(key);\n\n    switch (event.phase) {\n      case phase.NestableAsyncBegin: {\n        if (!openEventsStack) {\n          openEventsStack = [];\n          this._openNestableAsyncEvents.set(key, openEventsStack);\n        }\n        const asyncEvent = new AsyncEvent(event);\n        openEventsStack.push(asyncEvent);\n        event.thread._addAsyncEvent(asyncEvent);\n        break;\n      }\n\n      case phase.NestableAsyncInstant: {\n        if (openEventsStack && openEventsStack.length) {\n          const event = openEventsStack[openEventsStack.length - 1];\n          if (event) {\n            event._addStep(event);\n          }\n        }\n        break;\n      }\n\n      case phase.NestableAsyncEnd: {\n        if (!openEventsStack || !openEventsStack.length) {\n          break;\n        }\n        const top = openEventsStack.pop();\n        if (!top) {\n          break;\n        }\n        if (top.name !== event.name) {\n          console.error(\n              `Begin/end event mismatch for nestable async event, ${top.name} vs. ${event.name}, key: ${key}`);\n          break;\n        }\n        top._addStep(event);\n      }\n    }\n  }\n\n  _addAsyncEvent(event: Event): void {\n    const phase = Phase;\n    const key = event.categoriesString + '.' + event.name + '.' + event.id;\n    let asyncEvent = this._openAsyncEvents.get(key);\n\n    if (event.phase === phase.AsyncBegin) {\n      if (asyncEvent) {\n        console.error(`Event ${event.name} has already been started`);\n        return;\n      }\n      asyncEvent = new AsyncEvent(event);\n      this._openAsyncEvents.set(key, asyncEvent);\n      event.thread._addAsyncEvent(asyncEvent);\n      return;\n    }\n    if (!asyncEvent) {\n      // Quietly ignore stray async events, we're probably too late for the start.\n      return;\n    }\n    if (event.phase === phase.AsyncEnd) {\n      asyncEvent._addStep(event);\n      this._openAsyncEvents.delete(key);\n      return;\n    }\n    if (event.phase === phase.AsyncStepInto || event.phase === phase.AsyncStepPast) {\n      const lastStep = asyncEvent.steps[asyncEvent.steps.length - 1];\n      if (lastStep && lastStep.phase !== phase.AsyncBegin && lastStep.phase !== event.phase) {\n        console.assert(\n            false,\n            'Async event step phase mismatch: ' + lastStep.phase + ' at ' + lastStep.startTime + ' vs. ' + event.phase +\n                ' at ' + event.startTime);\n        return;\n      }\n      asyncEvent._addStep(event);\n      return;\n    }\n    console.assert(false, 'Invalid async event phase');\n  }\n\n  backingStorage(): BackingStorage {\n    return this._backingStorage;\n  }\n\n  _parsedCategoriesForString(str: string): Set<string> {\n    let parsedCategories = this._parsedCategories.get(str);\n    if (!parsedCategories) {\n      parsedCategories = new Set(str ? str.split(',') : []);\n      this._parsedCategories.set(str, parsedCategories);\n    }\n    return parsedCategories;\n  }\n}\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum Phase {\n  Begin = 'B',\n  End = 'E',\n  Complete = 'X',\n  Instant = 'I',\n  AsyncBegin = 'S',\n  AsyncStepInto = 'T',\n  AsyncStepPast = 'p',\n  AsyncEnd = 'F',\n  NestableAsyncBegin = 'b',\n  NestableAsyncEnd = 'e',\n  NestableAsyncInstant = 'n',\n  FlowBegin = 's',\n  FlowStep = 't',\n  FlowEnd = 'f',\n  Metadata = 'M',\n  Counter = 'C',\n  Sample = 'P',\n  CreateObject = 'N',\n  SnapshotObject = 'O',\n  DeleteObject = 'D',\n}\n\n\nexport const MetadataEvent = {\n  ProcessSortIndex: 'process_sort_index',\n  ProcessName: 'process_name',\n  ThreadSortIndex: 'thread_sort_index',\n  ThreadName: 'thread_name',\n};\n\n// TODO(alph): LegacyTopLevelEventCategory is not recorded since M74 and used for loading\n// legacy profiles. Drop at some point.\nexport const LegacyTopLevelEventCategory = 'toplevel';\n\nexport const DevToolsMetadataEventCategory = 'disabled-by-default-devtools.timeline';\nexport const DevToolsTimelineEventCategory = 'disabled-by-default-devtools.timeline';\n\nexport abstract class BackingStorage {\n  appendString(_string: string): void {\n  }\n\n  abstract appendAccessibleString(string: string): () => Promise<string|null>;\n\n  finishWriting(): void {\n  }\n\n  reset(): void {\n  }\n}\n\nexport class Event {\n  categoriesString: string;\n  _parsedCategories: Set<string>;\n  name: string;\n  phase: Phase;\n  startTime: number;\n  thread: Thread;\n  // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  args: any;\n  id!: string|null;\n  // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  bind_id!: string|null;\n  ordinal: number;\n  selfTime: number;\n  endTime?: number;\n  duration?: number;\n\n  constructor(categories: string|undefined, name: string, phase: Phase, startTime: number, thread: Thread) {\n    this.categoriesString = categories || '';\n    this._parsedCategories = thread._model._parsedCategoriesForString(this.categoriesString);\n    this.name = name;\n    this.phase = phase;\n    this.startTime = startTime;\n    this.thread = thread;\n    this.args = {};\n    this.ordinal = 0;\n\n    this.selfTime = 0;\n  }\n\n  static fromPayload(payload: EventPayload, thread: Thread): Event {\n    const event = new Event(payload.cat, payload.name, (payload.ph as Phase), payload.ts / 1000, thread);\n    if (payload.args) {\n      event.addArgs(payload.args);\n    }\n    if (typeof payload.dur === 'number') {\n      event.setEndTime((payload.ts + payload.dur) / 1000);\n    }\n    const id = TracingModel._extractId(payload);\n    if (typeof id !== 'undefined') {\n      event.id = id;\n    }\n    if (payload.bind_id) {\n      event.bind_id = payload.bind_id;\n    }\n\n    return event;\n  }\n\n  static compareStartTime(a: Event|null, b: Event|null): number {\n    if (!a || !b) {\n      return 0;\n    }\n\n    return a.startTime - b.startTime;\n  }\n\n  static orderedCompareStartTime(a: Event, b: Event): number {\n    // Array.mergeOrdered coalesces objects if comparator returns 0.\n    // To change this behavior this comparator return -1 in the case events\n    // startTime's are equal, so both events got placed into the result array.\n    return a.startTime - b.startTime || a.ordinal - b.ordinal || -1;\n  }\n\n  hasCategory(categoryName: string): boolean {\n    return this._parsedCategories.has(categoryName);\n  }\n\n  setEndTime(endTime: number): void {\n    if (endTime < this.startTime) {\n      console.assert(false, 'Event out of order: ' + this.name);\n      return;\n    }\n    this.endTime = endTime;\n    this.duration = endTime - this.startTime;\n  }\n\n  // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  addArgs(args: any): void {\n    // Shallow copy args to avoid modifying original payload which may be saved to file.\n    for (const name in args) {\n      if (name in this.args) {\n        console.error('Same argument name (' + name + ') is used for begin and end phases of ' + this.name);\n      }\n\n      (this.args as IgnoreListArgs)[name] = (args as IgnoreListArgs)[name];\n    }\n  }\n\n  _complete(endEvent: Event): void {\n    if (endEvent.args) {\n      this.addArgs(endEvent.args);\n    } else {\n      console.error('Missing mandatory event argument \\'args\\' at ' + endEvent.startTime);\n    }\n    this.setEndTime(endEvent.startTime);\n  }\n\n  _setBackingStorage(_backingStorage: (() => Promise<string|null>)|null): void {\n  }\n}\n\n// eslint-disable-next-line rulesdir/enforce_custom_event_names\nexport class ObjectSnapshot extends Event {\n  _backingStorage: (() => Promise<string|null>)|null;\n  _objectPromise: Promise<ObjectSnapshot|null>|null;\n\n  constructor(category: string|undefined, name: string, startTime: number, thread: Thread) {\n    super(category, name, Phase.SnapshotObject, startTime, thread);\n    this._backingStorage = null;\n    this._objectPromise = null;\n  }\n\n  static fromPayload(payload: EventPayload, thread: Thread): ObjectSnapshot {\n    const snapshot = new ObjectSnapshot(payload.cat, payload.name, payload.ts / 1000, thread);\n    const id = TracingModel._extractId(payload);\n    if (typeof id !== 'undefined') {\n      snapshot.id = id;\n    }\n    if (!payload.args || !payload.args['snapshot']) {\n      console.error('Missing mandatory \\'snapshot\\' argument at ' + payload.ts / 1000);\n      return snapshot;\n    }\n    if (payload.args) {\n      snapshot.addArgs(payload.args);\n    }\n    return snapshot;\n  }\n\n  requestObject(callback: (arg0: ObjectSnapshot|null) => void): void {\n    const snapshot = this.args['snapshot'];\n    if (snapshot) {\n      callback((snapshot as ObjectSnapshot));\n      return;\n    }\n    const storage = this._backingStorage;\n    if (storage) {\n      storage().then(onRead, callback.bind(null, null));\n    }\n\n    function onRead(result: string|null): void {\n      if (!result) {\n        callback(null);\n        return;\n      }\n      try {\n        const payload = JSON.parse(result);\n        callback(payload['args']['snapshot']);\n      } catch (e) {\n        Common.Console.Console.instance().error('Malformed event data in backing storage');\n        callback(null);\n      }\n    }\n  }\n\n  objectPromise(): Promise<ObjectSnapshot|null> {\n    if (!this._objectPromise) {\n      this._objectPromise = new Promise(this.requestObject.bind(this));\n    }\n    return this._objectPromise;\n  }\n\n  _setBackingStorage(backingStorage: (() => Promise<string|null>)|null): void {\n    if (!backingStorage) {\n      return;\n    }\n    this._backingStorage = backingStorage;\n    this.args = {};\n  }\n}\n\n// eslint-disable-next-line rulesdir/enforce_custom_event_names\nexport class AsyncEvent extends Event {\n  steps: Event[];\n  causedFrame: boolean;\n\n  constructor(startEvent: Event) {\n    super(startEvent.categoriesString, startEvent.name, startEvent.phase, startEvent.startTime, startEvent.thread);\n    this.addArgs(startEvent.args);\n    this.steps = [startEvent];\n    this.causedFrame = false;\n  }\n\n  _addStep(event: Event): void {\n    this.steps.push(event);\n    if (event.phase === Phase.AsyncEnd || event.phase === Phase.NestableAsyncEnd) {\n      this.setEndTime(event.startTime);\n      // FIXME: ideally, we shouldn't do this, but this makes the logic of converting\n      // async console events to sync ones much simpler.\n      this.steps[0].setEndTime(event.startTime);\n    }\n  }\n}\n\nclass ProfileEventsGroup {\n  children: Event[];\n  constructor(event: Event) {\n    this.children = [event];\n  }\n\n  _addChild(event: Event): void {\n    this.children.push(event);\n  }\n}\ninterface Sortable {\n  _sortIndex: number;\n  name: () => string;\n}\n\nclass Sorter {\n  static sort<Item>(array: Item[]): Item[] {\n    function comparator(a: Sortable, b: Sortable): number {\n      return a._sortIndex !== b._sortIndex ? a._sortIndex - b._sortIndex : a.name().localeCompare(b.name());\n    }\n    // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return (array as any).sort(comparator);\n  }\n}\n\nclass NamedObject {\n  _model: TracingModel;\n  _id: number;\n  _name: string;\n  _sortIndex: number;\n  constructor(model: TracingModel, id: number) {\n    this._model = model;\n    this._id = id;\n    this._name = '';\n    this._sortIndex = 0;\n  }\n\n  _setName(name: string): void {\n    this._name = name;\n  }\n\n  name(): string {\n    return this._name;\n  }\n\n  _setSortIndex(sortIndex: number): void {\n    this._sortIndex = sortIndex;\n  }\n}\n\nexport class Process extends NamedObject {\n  _threads: Map<number, Thread>;\n  _threadByName: Map<string, Thread|null>;\n  constructor(model: TracingModel, id: number) {\n    super(model, id);\n    this._threads = new Map();\n    this._threadByName = new Map();\n  }\n\n  id(): number {\n    return this._id;\n  }\n\n  threadById(id: number): Thread {\n    let thread = this._threads.get(id);\n    if (!thread) {\n      thread = new Thread(this, id);\n      this._threads.set(id, thread);\n    }\n    return thread;\n  }\n\n  threadByName(name: string): Thread|null {\n    return this._threadByName.get(name) || null;\n  }\n\n  _setThreadByName(name: string, thread: Thread): void {\n    this._threadByName.set(name, thread);\n  }\n\n  _addEvent(payload: EventPayload): Event|null {\n    return this.threadById(payload.tid)._addEvent(payload);\n  }\n\n  sortedThreads(): Thread[] {\n    return Sorter.sort([...this._threads.values()]);\n  }\n}\n\nexport class Thread extends NamedObject {\n  _process: Process;\n  _events: Event[];\n  _asyncEvents: AsyncEvent[];\n  _lastTopLevelEvent: Event|null;\n  constructor(process: Process, id: number) {\n    super(process._model, id);\n    this._process = process;\n\n    this._events = [];\n    this._asyncEvents = [];\n    this._lastTopLevelEvent = null;\n  }\n\n  tracingComplete(): void {\n    this._asyncEvents.sort(Event.compareStartTime);\n    this._events.sort(Event.compareStartTime);\n    const phases = Phase;\n    const stack = [];\n    const toDelete = new Set<number>();\n    for (let i = 0; i < this._events.length; ++i) {\n      const e = this._events[i];\n      e.ordinal = i;\n      switch (e.phase) {\n        case phases.End: {\n          toDelete.add(i);  // Mark for removal.\n          // Quietly ignore unbalanced close events, they're legit (we could have missed start one).\n          if (!stack.length) {\n            continue;\n          }\n          const top = stack.pop();\n          if (!top) {\n            continue;\n          }\n          if (top.name !== e.name || top.categoriesString !== e.categoriesString) {\n            console.error(\n                'B/E events mismatch at ' + top.startTime + ' (' + top.name + ') vs. ' + e.startTime + ' (' + e.name +\n                ')');\n          } else {\n            top._complete(e);\n          }\n          break;\n        }\n        case phases.Begin: {\n          stack.push(e);\n          break;\n        }\n      }\n    }\n\n    // Handle Begin events with no matching End.\n    // This commonly happens due to a bug in the trace machinery. See crbug.com/982252\n    while (stack.length) {\n      const event = stack.pop();\n      if (event) {\n        // Masquerade the event as Instant, so it's rendered to the user.\n        // The ideal fix is resolving crbug.com/1021571, but handling that without a perfetto migration appears prohibitive\n        event.phase = phases.Instant;\n      }\n    }\n    this._events = this._events.filter((_, idx) => !toDelete.has(idx));\n  }\n\n  _addEvent(payload: EventPayload): Event|null {\n    const event = payload.ph === Phase.SnapshotObject ? ObjectSnapshot.fromPayload(payload, this) :\n                                                        Event.fromPayload(payload, this);\n    if (TracingModel.isTopLevelEvent(event)) {\n      // Discard nested \"top-level\" events.\n      const lastTopLevelEvent = this._lastTopLevelEvent;\n      if (lastTopLevelEvent && (lastTopLevelEvent.endTime || 0) > event.startTime) {\n        return null;\n      }\n      this._lastTopLevelEvent = event;\n    }\n    this._events.push(event);\n    return event;\n  }\n\n  _addAsyncEvent(asyncEvent: AsyncEvent): void {\n    this._asyncEvents.push(asyncEvent);\n  }\n\n  _setName(name: string): void {\n    super._setName(name);\n    this._process._setThreadByName(name, this);\n  }\n\n  id(): number {\n    return this._id;\n  }\n\n  process(): Process {\n    return this._process;\n  }\n\n  events(): Event[] {\n    return this._events;\n  }\n\n  asyncEvents(): AsyncEvent[] {\n    return this._asyncEvents;\n  }\n\n  removeEventsByName(name: string): Event[] {\n    const extracted: Event[] = [];\n    this._events = this._events.filter(e => {\n      if (!e) {\n        return false;\n      }\n\n      if (e.name !== name) {\n        return true;\n      }\n\n      extracted.push(e);\n      return false;\n    });\n\n    return extracted;\n  }\n}\n"]}