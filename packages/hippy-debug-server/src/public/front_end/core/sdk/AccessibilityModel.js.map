{"version":3,"file":"AccessibilityModel.js","sourceRoot":"","sources":["../../../../../../front_end/core/sdk/AccessibilityModel.ts"],"names":[],"mappings":"AAAA,gEAAgE;AAChE,yEAAyE;AACzE,6BAA6B;AAQ7B,OAAO,EAAC,eAAe,EAAC,MAAM,eAAe,CAAC,CAAE,qCAAqC;AAErF,OAAO,EAAC,UAAU,EAAC,MAAM,aAAa,CAAC;AACvC,OAAO,EAAC,QAAQ,EAAC,MAAM,eAAe,CAAC,CAAE,qCAAqC;AAE9E,wDAAwD;AACxD,+CAA+C;AAC/C,MAAM,CAAN,IAAY,kBAKX;AALD,WAAY,kBAAkB;IAC5B,mCAAa,CAAA;IACb,iDAA2B,CAAA;IAC3B,qCAAe,CAAA;IACf,mCAAa,CAAA;AACf,CAAC,EALW,kBAAkB,KAAlB,kBAAkB,QAK7B;AAOD,MAAM,OAAO,iBAAiB;IAC5B,mBAAmB,CAAqB;IACxC,MAAM,CAAoC;IAC1C,GAAG,CAAS;IACZ,iBAAiB,CAAc;IAC/B,gBAAgB,CAAuB;IACvC,QAAQ,CAAU;IAClB,eAAe,CAAgD;IAC/D,KAAK,CAAsC;IAC3C,KAAK,CAAsC;IAC3C,YAAY,CAAsC;IAClD,MAAM,CAAsC;IAC5C,WAAW,CAA2C;IACtD,SAAS,CAAgB;IACzB,WAAW,CAAyB;IAEpC,YAAY,kBAAsC,EAAE,OAAsC;QACxF,IAAI,CAAC,mBAAmB,GAAG,kBAAkB,CAAC;QAC9C,IAAI,CAAC,MAAM,GAAG,kBAAkB,CAAC,MAAM,CAAC;QAExC,IAAI,CAAC,GAAG,GAAG,OAAO,CAAC,MAAM,CAAC;QAC1B,kBAAkB,CAAC,iBAAiB,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QACrD,IAAI,OAAO,CAAC,gBAAgB,EAAE;YAC5B,kBAAkB,CAAC,6BAA6B,CAAC,OAAO,CAAC,gBAAgB,EAAE,IAAI,CAAC,CAAC;YACjF,IAAI,CAAC,iBAAiB,GAAG,OAAO,CAAC,gBAAgB,CAAC;YAClD,IAAI,CAAC,gBAAgB,GAAG,IAAI,eAAe,CAAC,kBAAkB,CAAC,MAAM,EAAE,EAAE,OAAO,CAAC,gBAAgB,CAAC,CAAC;SACpG;aAAM;YACL,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;YAC9B,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;SAC9B;QACD,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC,OAAO,CAAC;QAChC,IAAI,IAAI,CAAC,QAAQ,IAAI,gBAAgB,IAAI,OAAO,EAAE;YAChD,IAAI,CAAC,eAAe,GAAG,OAAO,CAAC,cAAc,CAAC;SAC/C;QAED,IAAI,CAAC,KAAK,GAAG,OAAO,CAAC,IAAI,IAAI,IAAI,CAAC;QAClC,IAAI,CAAC,KAAK,GAAG,OAAO,CAAC,IAAI,IAAI,IAAI,CAAC;QAClC,IAAI,CAAC,YAAY,GAAG,OAAO,CAAC,WAAW,IAAI,IAAI,CAAC;QAChD,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,KAAK,IAAI,IAAI,CAAC;QACpC,IAAI,CAAC,WAAW,GAAG,OAAO,CAAC,UAAU,IAAI,IAAI,CAAC;QAC9C,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC,QAAQ,IAAI,IAAI,CAAC;QAC1C,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;IAC1B,CAAC;IAED,EAAE;QACA,OAAO,IAAI,CAAC,GAAG,CAAC;IAClB,CAAC;IAED,kBAAkB;QAChB,OAAO,IAAI,CAAC,mBAAmB,CAAC;IAClC,CAAC;IAED,OAAO;QACL,OAAO,IAAI,CAAC,QAAQ,CAAC;IACvB,CAAC;IAED,cAAc;QACZ,OAAO,IAAI,CAAC,eAAe,IAAI,IAAI,CAAC;IACtC,CAAC;IAED,IAAI;QACF,OAAO,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC;IAC5B,CAAC;IAED,cAAc;QACZ,MAAM,UAAU,GAA+B,EAAE,CAAC;QAElD,IAAI,IAAI,CAAC,KAAK,EAAE;YACd,UAAU,CAAC,IAAI,CAAC,EAAC,IAAI,EAAE,kBAAkB,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAC,CAAC,CAAC;SACrE;QACD,IAAI,IAAI,CAAC,YAAY,EAAE;YACrB,UAAU,CAAC,IAAI,CAAC,EAAC,IAAI,EAAE,kBAAkB,CAAC,WAAW,EAAE,KAAK,EAAE,IAAI,CAAC,YAAY,EAAC,CAAC,CAAC;SACnF;QACD,IAAI,IAAI,CAAC,MAAM,EAAE;YACf,UAAU,CAAC,IAAI,CAAC,EAAC,IAAI,EAAE,kBAAkB,CAAC,KAAK,EAAE,KAAK,EAAE,IAAI,CAAC,MAAM,EAAC,CAAC,CAAC;SACvE;QAED,OAAO,UAAU,CAAC;IACpB,CAAC;IAED,IAAI;QACF,OAAO,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC;IAC5B,CAAC;IAED,WAAW;QACT,OAAO,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC;IACnC,CAAC;IAED,KAAK;QACH,OAAO,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC;IAC7B,CAAC;IAED,UAAU;QACR,OAAO,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC;IAClC,CAAC;IAED,UAAU;QACR,OAAO,IAAI,CAAC,WAAW,CAAC;IAC1B,CAAC;IAED,cAAc,CAAC,UAAkC;QAC/C,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC;IAChC,CAAC;IAED,SAAS;QACP,OAAO,OAAO,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;IACzC,CAAC;IAED,gBAAgB;QACd,OAAO,IAAI,CAAC,iBAAiB,CAAC;IAChC,CAAC;IAED,eAAe;QACb,OAAO,IAAI,CAAC,gBAAgB,CAAC;IAC/B,CAAC;IAED,gBAAgB;QACd,MAAM,YAAY,GAAG,IAAI,CAAC,eAAe,EAAE,CAAC;QAC5C,IAAI,CAAC,YAAY,EAAE;YACjB,OAAO;SACR;QACD,0BAA0B;QAC1B,YAAY,CAAC,SAAS,EAAE,CAAC;IAC3B,CAAC;IAED,QAAQ;QACN,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;YACnB,OAAO,EAAE,CAAC;SACX;QAED,MAAM,QAAQ,GAAG,EAAE,CAAC;QACpB,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,SAAS,EAAE;YACpC,MAAM,KAAK,GAAG,IAAI,CAAC,mBAAmB,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YAC5D,IAAI,KAAK,EAAE;gBACT,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;aACtB;SACF;QAED,OAAO,QAAQ,CAAC;IAClB,CAAC;IAED,WAAW;QACT,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;YACnB,OAAO,CAAC,CAAC;SACV;QACD,OAAO,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;IAC/B,CAAC;IAED,uBAAuB;QACrB,IAAI,CAAC,IAAI,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE;YAC7C,OAAO,KAAK,CAAC;SACd;QAED,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,mBAAmB,CAAC,WAAW,CAAC,EAAE,CAAC,KAAK,IAAI,CAAC,CAAC;IACvF,CAAC;CACF;AAED,MAAM,OAAO,kBAAmB,SAAQ,QAAQ;IAC9C,MAAM,CAAoC;IAC1C,aAAa,CAAiC;IAC9C,mEAAmE;IACnE,8DAA8D;IAC9D,mEAAmE;IACnE,8DAA8D;IAC9D,yBAAyB,CAAgB;IACzC,YAAY,MAAc;QACxB,KAAK,CAAC,MAAM,CAAC,CAAC;QACd,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,kBAAkB,EAAE,CAAC;QAC1C,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,IAAI,CAAC,aAAa,GAAG,IAAI,GAAG,EAAE,CAAC;QAC/B,IAAI,CAAC,yBAAyB,GAAG,IAAI,GAAG,EAAE,CAAC;IAC7C,CAAC;IAED,KAAK;QACH,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC;IAC7B,CAAC;IAED,KAAK,CAAC,WAAW;QACf,MAAM,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;IACpC,CAAC;IAED,KAAK,CAAC,YAAY;QAChB,MAAM,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,CAAC;IACrC,CAAC;IAED,KAAK,CAAC,oBAAoB,CAAC,IAAa;QACtC,MAAM,EAAC,KAAK,EAAC,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,uBAAuB,CACrD,EAAC,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,aAAa,EAAE,SAAS,EAAE,QAAQ,EAAE,SAAS,EAAE,cAAc,EAAE,IAAI,EAAC,CAAC,CAAC;QAC5F,IAAI,CAAC,KAAK,EAAE;YACV,OAAO;SACR;QAED,KAAK,MAAM,OAAO,IAAI,KAAK,EAAE;YAC3B,IAAI,iBAAiB,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;SACtC;QAED,KAAK,MAAM,MAAM,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,EAAE;YAChD,KAAK,MAAM,OAAO,IAAI,MAAM,CAAC,QAAQ,EAAE,EAAE;gBACvC,OAAO,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;aAChC;SACF;IACH,CAAC;IAED,KAAK,CAAC,eAAe,CAAC,QAAgB,CAAC;QACrC,MAAM,EAAC,KAAK,EAAC,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,oBAAoB,CAAC,EAAC,SAAS,EAAE,KAAK,EAAC,CAAC,CAAC;QAC3E,IAAI,CAAC,KAAK,EAAE;YACV,OAAO;SACR;QAED,MAAM,OAAO,GAAG,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,iBAAiB,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;QAErE,KAAK,MAAM,MAAM,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,EAAE;YAChD,KAAK,MAAM,OAAO,IAAI,MAAM,CAAC,QAAQ,EAAE,EAAE;gBACvC,OAAO,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;aAChC;SACF;QAED,OAAO,OAAO,CAAC,CAAC,CAAC,CAAC;IACpB,CAAC;IAED,KAAK,CAAC,iBAAiB,CAAC,MAAc;QACpC,MAAM,EAAC,KAAK,EAAC,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,sBAAsB,CAAC,EAAC,EAAE,EAAE,MAAM,EAAC,CAAC,CAAC;QACvE,IAAI,CAAC,KAAK,EAAE;YACV,OAAO,EAAE,CAAC;SACX;QAED,MAAM,OAAO,GAAG,EAAE,CAAC;QACnB,KAAK,MAAM,OAAO,IAAI,KAAK,EAAE;YAC3B,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;gBAC3C,OAAO,CAAC,IAAI,CAAC,IAAI,iBAAiB,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,CAAC;aACpD;SACF;QAED,KAAK,MAAM,MAAM,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,EAAE;YAChD,KAAK,MAAM,OAAO,IAAI,MAAM,CAAC,QAAQ,EAAE,EAAE;gBACvC,OAAO,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;aAChC;SACF;QAED,OAAO,OAAO,CAAC;IACjB,CAAC;IAED;;;;OAIG;IAEH,KAAK,CAAC,2BAA2B,CAAC,IAAa;QAC7C,0EAA0E;QAC1E,MAAM,YAAY,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;QACjD,IAAI,YAAY,EAAE;YAChB,OAAO,YAAY,CAAC;SACrB;QAED,MAAM,EAAC,KAAK,EAAC,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,uBAAuB,CACrD,EAAC,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,aAAa,EAAE,SAAS,EAAE,QAAQ,EAAE,SAAS,EAAE,cAAc,EAAE,IAAI,EAAC,CAAC,CAAC;QAC5F,IAAI,CAAC,KAAK,EAAE;YACV,OAAO,IAAI,CAAC;SACb;QAED,MAAM,SAAS,GAAG,EAAE,CAAC;QACrB,KAAK,MAAM,OAAO,IAAI,KAAK,EAAE;YAC3B,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;gBAC3C,SAAS,CAAC,IAAI,CAAC,IAAI,iBAAiB,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,CAAC;aACtD;SACF;QAED,KAAK,MAAM,MAAM,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,EAAE;YAChD,KAAK,MAAM,OAAO,IAAI,MAAM,CAAC,QAAQ,EAAE,EAAE;gBACvC,OAAO,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;aAChC;SACF;QAED,oCAAoC;QACpC,KAAK,MAAM,IAAI,IAAI,SAAS,EAAE;YAC5B,MAAM,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC;SACzC;QAED,OAAO,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;IACrC,CAAC;IAED;;;OAGG;IACH,WAAW,CAAC,IAAY;QACtB,OAAO,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC;IAC9C,CAAC;IAED,iBAAiB,CAAC,IAAY,EAAE,MAAyB;QACvD,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;IACvC,CAAC;IAED,gBAAgB,CAAC,OAAqB;QACpC,IAAI,CAAC,OAAO,EAAE;YACZ,OAAO,IAAI,CAAC;SACb;QACD,OAAO,IAAI,CAAC,yBAAyB,CAAC,GAAG,CAAC,OAAO,CAAC,aAAa,EAAE,CAAC,CAAC;IACrE,CAAC;IAED,6BAA6B,CAAC,gBAAwB,EAAE,MAAyB;QAC/E,IAAI,CAAC,yBAAyB,CAAC,GAAG,CAAC,gBAAgB,EAAE,MAAM,CAAC,CAAC;IAC/D,CAAC;CACF;AAED,QAAQ,CAAC,QAAQ,CAAC,kBAAkB,EAAE,EAAC,YAAY,EAAE,UAAU,CAAC,GAAG,EAAE,SAAS,EAAE,KAAK,EAAC,CAAC,CAAC","sourcesContent":["// Copyright (c) 2014 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport type * as Protocol from '../../generated/protocol.js';\nimport type * as ProtocolProxyApi from '../../generated/protocol-proxy-api.js';\n\nimport type {DOMNode} from './DOMModel.js';\nimport {DeferredDOMNode} from './DOMModel.js';  // eslint-disable-line no-unused-vars\nimport type {Target} from './Target.js';\nimport {Capability} from './Target.js';\nimport {SDKModel} from './SDKModel.js';  // eslint-disable-line no-unused-vars\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum CoreAxPropertyName {\n  Name = 'name',\n  Description = 'description',\n  Value = 'value',\n  Role = 'role',\n}\n\nexport interface CoreOrProtocolAxProperty {\n  name: CoreAxPropertyName|Protocol.Accessibility.AXPropertyName;\n  value: Protocol.Accessibility.AXValue;\n}\n\nexport class AccessibilityNode {\n  _accessibilityModel: AccessibilityModel;\n  _agent: ProtocolProxyApi.AccessibilityApi;\n  _id: string;\n  _backendDOMNodeId: number|null;\n  _deferredDOMNode: DeferredDOMNode|null;\n  _ignored: boolean;\n  _ignoredReasons: Protocol.Accessibility.AXProperty[]|undefined;\n  _role: Protocol.Accessibility.AXValue|null;\n  _name: Protocol.Accessibility.AXValue|null;\n  _description: Protocol.Accessibility.AXValue|null;\n  _value: Protocol.Accessibility.AXValue|null;\n  _properties: Protocol.Accessibility.AXProperty[]|null;\n  _childIds: string[]|null;\n  _parentNode: AccessibilityNode|null;\n\n  constructor(accessibilityModel: AccessibilityModel, payload: Protocol.Accessibility.AXNode) {\n    this._accessibilityModel = accessibilityModel;\n    this._agent = accessibilityModel._agent;\n\n    this._id = payload.nodeId;\n    accessibilityModel._setAXNodeForAXId(this._id, this);\n    if (payload.backendDOMNodeId) {\n      accessibilityModel._setAXNodeForBackendDOMNodeId(payload.backendDOMNodeId, this);\n      this._backendDOMNodeId = payload.backendDOMNodeId;\n      this._deferredDOMNode = new DeferredDOMNode(accessibilityModel.target(), payload.backendDOMNodeId);\n    } else {\n      this._backendDOMNodeId = null;\n      this._deferredDOMNode = null;\n    }\n    this._ignored = payload.ignored;\n    if (this._ignored && 'ignoredReasons' in payload) {\n      this._ignoredReasons = payload.ignoredReasons;\n    }\n\n    this._role = payload.role || null;\n    this._name = payload.name || null;\n    this._description = payload.description || null;\n    this._value = payload.value || null;\n    this._properties = payload.properties || null;\n    this._childIds = payload.childIds || null;\n    this._parentNode = null;\n  }\n\n  id(): string {\n    return this._id;\n  }\n\n  accessibilityModel(): AccessibilityModel {\n    return this._accessibilityModel;\n  }\n\n  ignored(): boolean {\n    return this._ignored;\n  }\n\n  ignoredReasons(): Protocol.Accessibility.AXProperty[]|null {\n    return this._ignoredReasons || null;\n  }\n\n  role(): Protocol.Accessibility.AXValue|null {\n    return this._role || null;\n  }\n\n  coreProperties(): CoreOrProtocolAxProperty[] {\n    const properties: CoreOrProtocolAxProperty[] = [];\n\n    if (this._name) {\n      properties.push({name: CoreAxPropertyName.Name, value: this._name});\n    }\n    if (this._description) {\n      properties.push({name: CoreAxPropertyName.Description, value: this._description});\n    }\n    if (this._value) {\n      properties.push({name: CoreAxPropertyName.Value, value: this._value});\n    }\n\n    return properties;\n  }\n\n  name(): Protocol.Accessibility.AXValue|null {\n    return this._name || null;\n  }\n\n  description(): Protocol.Accessibility.AXValue|null {\n    return this._description || null;\n  }\n\n  value(): Protocol.Accessibility.AXValue|null {\n    return this._value || null;\n  }\n\n  properties(): Protocol.Accessibility.AXProperty[]|null {\n    return this._properties || null;\n  }\n\n  parentNode(): AccessibilityNode|null {\n    return this._parentNode;\n  }\n\n  _setParentNode(parentNode: AccessibilityNode|null): void {\n    this._parentNode = parentNode;\n  }\n\n  isDOMNode(): boolean {\n    return Boolean(this._backendDOMNodeId);\n  }\n\n  backendDOMNodeId(): number|null {\n    return this._backendDOMNodeId;\n  }\n\n  deferredDOMNode(): DeferredDOMNode|null {\n    return this._deferredDOMNode;\n  }\n\n  highlightDOMNode(): void {\n    const deferredNode = this.deferredDOMNode();\n    if (!deferredNode) {\n      return;\n    }\n    // Highlight node in page.\n    deferredNode.highlight();\n  }\n\n  children(): AccessibilityNode[] {\n    if (!this._childIds) {\n      return [];\n    }\n\n    const children = [];\n    for (const childId of this._childIds) {\n      const child = this._accessibilityModel.axNodeForId(childId);\n      if (child) {\n        children.push(child);\n      }\n    }\n\n    return children;\n  }\n\n  numChildren(): number {\n    if (!this._childIds) {\n      return 0;\n    }\n    return this._childIds.length;\n  }\n\n  hasOnlyUnloadedChildren(): boolean {\n    if (!this._childIds || !this._childIds.length) {\n      return false;\n    }\n\n    return !this._childIds.some(id => this._accessibilityModel.axNodeForId(id) !== null);\n  }\n}\n\nexport class AccessibilityModel extends SDKModel {\n  _agent: ProtocolProxyApi.AccessibilityApi;\n  _axIdToAXNode: Map<string, AccessibilityNode>;\n  // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  _backendDOMNodeIdToAXNode: Map<any, any>;\n  constructor(target: Target) {\n    super(target);\n    this._agent = target.accessibilityAgent();\n    this.resumeModel();\n\n    this._axIdToAXNode = new Map();\n    this._backendDOMNodeIdToAXNode = new Map();\n  }\n\n  clear(): void {\n    this._axIdToAXNode.clear();\n  }\n\n  async resumeModel(): Promise<void> {\n    await this._agent.invoke_enable();\n  }\n\n  async suspendModel(): Promise<void> {\n    await this._agent.invoke_disable();\n  }\n\n  async requestPartialAXTree(node: DOMNode): Promise<void> {\n    const {nodes} = await this._agent.invoke_getPartialAXTree(\n        {nodeId: node.id, backendNodeId: undefined, objectId: undefined, fetchRelatives: true});\n    if (!nodes) {\n      return;\n    }\n\n    for (const payload of nodes) {\n      new AccessibilityNode(this, payload);\n    }\n\n    for (const axNode of this._axIdToAXNode.values()) {\n      for (const axChild of axNode.children()) {\n        axChild._setParentNode(axNode);\n      }\n    }\n  }\n\n  async requestRootNode(depth: number = 2): Promise<AccessibilityNode|undefined> {\n    const {nodes} = await this._agent.invoke_getFullAXTree({max_depth: depth});\n    if (!nodes) {\n      return;\n    }\n\n    const axNodes = nodes.map(node => new AccessibilityNode(this, node));\n\n    for (const axNode of this._axIdToAXNode.values()) {\n      for (const axChild of axNode.children()) {\n        axChild._setParentNode(axNode);\n      }\n    }\n\n    return axNodes[0];\n  }\n\n  async requestAXChildren(nodeId: string): Promise<AccessibilityNode[]> {\n    const {nodes} = await this._agent.invoke_getChildAXNodes({id: nodeId});\n    if (!nodes) {\n      return [];\n    }\n\n    const axNodes = [];\n    for (const payload of nodes) {\n      if (!this._axIdToAXNode.has(payload.nodeId)) {\n        axNodes.push(new AccessibilityNode(this, payload));\n      }\n    }\n\n    for (const axNode of this._axIdToAXNode.values()) {\n      for (const axChild of axNode.children()) {\n        axChild._setParentNode(axNode);\n      }\n    }\n\n    return axNodes;\n  }\n\n  /**\n   *\n   * @param {!DOMNode} node\n   * @return ?{!Promise<!AccessibilityNode[]>}\n   */\n\n  async requestAndLoadSubTreeToNode(node: DOMNode): Promise<AccessibilityNode|null> {\n    // Node may have already been loaded, so don't bother requesting it again.\n    const loadedAXNode = this.axNodeForDOMNode(node);\n    if (loadedAXNode) {\n      return loadedAXNode;\n    }\n\n    const {nodes} = await this._agent.invoke_getPartialAXTree(\n        {nodeId: node.id, backendNodeId: undefined, objectId: undefined, fetchRelatives: true});\n    if (!nodes) {\n      return null;\n    }\n\n    const ancestors = [];\n    for (const payload of nodes) {\n      if (!this._axIdToAXNode.has(payload.nodeId)) {\n        ancestors.push(new AccessibilityNode(this, payload));\n      }\n    }\n\n    for (const axNode of this._axIdToAXNode.values()) {\n      for (const axChild of axNode.children()) {\n        axChild._setParentNode(axNode);\n      }\n    }\n\n    // Request top level children nodes.\n    for (const node of ancestors) {\n      await this.requestAXChildren(node.id());\n    }\n\n    return this.axNodeForDOMNode(node);\n  }\n\n  /**\n   * @param {string} axId\n   * @return {?AccessibilityNode}\n   */\n  axNodeForId(axId: string): AccessibilityNode|null {\n    return this._axIdToAXNode.get(axId) || null;\n  }\n\n  _setAXNodeForAXId(axId: string, axNode: AccessibilityNode): void {\n    this._axIdToAXNode.set(axId, axNode);\n  }\n\n  axNodeForDOMNode(domNode: DOMNode|null): AccessibilityNode|null {\n    if (!domNode) {\n      return null;\n    }\n    return this._backendDOMNodeIdToAXNode.get(domNode.backendNodeId());\n  }\n\n  _setAXNodeForBackendDOMNodeId(backendDOMNodeId: number, axNode: AccessibilityNode): void {\n    this._backendDOMNodeIdToAXNode.set(backendDOMNodeId, axNode);\n  }\n}\n\nSDKModel.register(AccessibilityModel, {capabilities: Capability.DOM, autostart: false});\n"]}