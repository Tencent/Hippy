{"version":3,"file":"ServiceWorkerCacheModel.js","sourceRoot":"","sources":["../../../../../../front_end/core/sdk/ServiceWorkerCacheModel.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2014 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Common from '../common/common.js';\nimport * as i18n from '../i18n/i18n.js';\nimport type * as ProtocolProxyApi from '../../generated/protocol-proxy-api.js';\nimport type * as Protocol from '../../generated/protocol.js';\n\nimport type {NameValue} from './NetworkRequest.js'; // eslint-disable-line no-unused-vars\nimport type {Target} from './Target.js';\nimport {Capability} from './Target.js';\nimport {SDKModel} from './SDKModel.js';\nimport {Events as SecurityOriginManagerEvents, SecurityOriginManager} from './SecurityOriginManager.js';\n\nconst UIStrings = {\n  /**\n  *@description Text in Service Worker Cache Model\n  *@example {https://cache} PH1\n  *@example {error message} PH2\n  */\n  serviceworkercacheagentError: '`ServiceWorkerCacheAgent` error deleting cache entry {PH1} in cache: {PH2}',\n};\nconst str_ = i18n.i18n.registerUIStrings('core/sdk/ServiceWorkerCacheModel.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class ServiceWorkerCacheModel extends SDKModel implements ProtocolProxyApi.StorageDispatcher {\n  _caches: Map<string, Cache>;\n  _cacheAgent: ProtocolProxyApi.CacheStorageApi;\n  _storageAgent: ProtocolProxyApi.StorageApi;\n  _securityOriginManager: SecurityOriginManager;\n  _originsUpdated: Set<string>;\n  _throttler: Common.Throttler.Throttler;\n  _enabled: boolean;\n\n  /**\n   * Invariant: This model can only be constructed on a ServiceWorker target.\n   */\n  constructor(target: Target) {\n    super(target);\n    target.registerStorageDispatcher(this);\n\n    this._caches = new Map();\n\n    this._cacheAgent = target.cacheStorageAgent();\n    this._storageAgent = target.storageAgent();\n    this._securityOriginManager = (target.model(SecurityOriginManager) as SecurityOriginManager);\n\n    this._originsUpdated = new Set();\n    this._throttler = new Common.Throttler.Throttler(2000);\n\n    this._enabled = false;\n  }\n\n  enable(): void {\n    if (this._enabled) {\n      return;\n    }\n\n    this._securityOriginManager.addEventListener(\n        SecurityOriginManagerEvents.SecurityOriginAdded, this._securityOriginAdded, this);\n    this._securityOriginManager.addEventListener(\n        SecurityOriginManagerEvents.SecurityOriginRemoved, this._securityOriginRemoved, this);\n\n    for (const securityOrigin of this._securityOriginManager.securityOrigins()) {\n      this._addOrigin(securityOrigin);\n    }\n    this._enabled = true;\n  }\n\n  clearForOrigin(origin: string): void {\n    this._removeOrigin(origin);\n    this._addOrigin(origin);\n  }\n\n  refreshCacheNames(): void {\n    for (const cache of this._caches.values()) {\n      this._cacheRemoved(cache);\n    }\n    this._caches.clear();\n    const securityOrigins = this._securityOriginManager.securityOrigins();\n    for (const securityOrigin of securityOrigins) {\n      this._loadCacheNames(securityOrigin);\n    }\n  }\n\n  async deleteCache(cache: Cache): Promise<void> {\n    const response = await this._cacheAgent.invoke_deleteCache({cacheId: cache.cacheId});\n    if (response.getError()) {\n      console.error(`ServiceWorkerCacheAgent error deleting cache ${cache.toString()}: ${response.getError()}`);\n      return;\n    }\n    this._caches.delete(cache.cacheId);\n    this._cacheRemoved(cache);\n  }\n\n  async deleteCacheEntry(cache: Cache, request: string): Promise<void> {\n    const response = await this._cacheAgent.invoke_deleteEntry({cacheId: cache.cacheId, request});\n    if (response.getError()) {\n      Common.Console.Console.instance().error(\n          i18nString(UIStrings.serviceworkercacheagentError, {PH1: cache.toString(), PH2: response.getError()}));\n      return;\n    }\n  }\n\n  loadCacheData(\n      cache: Cache, skipCount: number, pageSize: number, pathFilter: string,\n      callback: (arg0: Array<Protocol.CacheStorage.DataEntry>, arg1: number) => void): void {\n    this._requestEntries(cache, skipCount, pageSize, pathFilter, callback);\n  }\n\n  loadAllCacheData(\n      cache: Cache, pathFilter: string,\n      callback: (arg0: Array<Protocol.CacheStorage.DataEntry>, arg1: number) => void): void {\n    this._requestAllEntries(cache, pathFilter, callback);\n  }\n\n  caches(): Cache[] {\n    const caches = new Array();\n    for (const cache of this._caches.values()) {\n      caches.push(cache);\n    }\n    return caches;\n  }\n\n  dispose(): void {\n    for (const cache of this._caches.values()) {\n      this._cacheRemoved(cache);\n    }\n    this._caches.clear();\n    if (this._enabled) {\n      this._securityOriginManager.removeEventListener(\n          SecurityOriginManagerEvents.SecurityOriginAdded, this._securityOriginAdded, this);\n      this._securityOriginManager.removeEventListener(\n          SecurityOriginManagerEvents.SecurityOriginRemoved, this._securityOriginRemoved, this);\n    }\n  }\n\n  _addOrigin(securityOrigin: string): void {\n    this._loadCacheNames(securityOrigin);\n    if (this._isValidSecurityOrigin(securityOrigin)) {\n      this._storageAgent.invoke_trackCacheStorageForOrigin({origin: securityOrigin});\n    }\n  }\n\n  _removeOrigin(securityOrigin: string): void {\n    for (const [opaqueId, cache] of this._caches.entries()) {\n      if (cache.securityOrigin === securityOrigin) {\n        this._caches.delete((opaqueId as string));\n        this._cacheRemoved((cache as Cache));\n      }\n    }\n    if (this._isValidSecurityOrigin(securityOrigin)) {\n      this._storageAgent.invoke_untrackCacheStorageForOrigin({origin: securityOrigin});\n    }\n  }\n\n  _isValidSecurityOrigin(securityOrigin: string): boolean {\n    const parsedURL = Common.ParsedURL.ParsedURL.fromString(securityOrigin);\n    return parsedURL !== null && parsedURL.scheme.startsWith('http');\n  }\n\n  async _loadCacheNames(securityOrigin: string): Promise<void> {\n    const response = await this._cacheAgent.invoke_requestCacheNames({securityOrigin: securityOrigin});\n    if (response.getError()) {\n      return;\n    }\n    this._updateCacheNames(securityOrigin, response.caches);\n  }\n\n  _updateCacheNames(securityOrigin: string, cachesJson: Protocol.CacheStorage.Cache[]): void {\n    function deleteAndSaveOldCaches(this: ServiceWorkerCacheModel, cache: Cache): void {\n      if (cache.securityOrigin === securityOrigin && !updatingCachesIds.has(cache.cacheId)) {\n        oldCaches.set(cache.cacheId, cache);\n        this._caches.delete(cache.cacheId);\n      }\n    }\n\n    const updatingCachesIds = new Set<string>();\n    const newCaches = new Map<string, Cache>();\n    const oldCaches = new Map<string, Cache>();\n\n    for (const cacheJson of cachesJson) {\n      const cache = new Cache(this, cacheJson.securityOrigin, cacheJson.cacheName, cacheJson.cacheId);\n      updatingCachesIds.add(cache.cacheId);\n      if (this._caches.has(cache.cacheId)) {\n        continue;\n      }\n      newCaches.set(cache.cacheId, cache);\n      this._caches.set(cache.cacheId, cache);\n    }\n    this._caches.forEach(deleteAndSaveOldCaches, this);\n    newCaches.forEach(this._cacheAdded, this);\n    oldCaches.forEach(this._cacheRemoved, this);\n  }\n\n  _securityOriginAdded(event: Common.EventTarget.EventTargetEvent): void {\n    const securityOrigin = (event.data as string);\n    this._addOrigin(securityOrigin);\n  }\n\n  _securityOriginRemoved(event: Common.EventTarget.EventTargetEvent): void {\n    const securityOrigin = (event.data as string);\n    this._removeOrigin(securityOrigin);\n  }\n\n  _cacheAdded(cache: Cache): void {\n    this.dispatchEventToListeners(Events.CacheAdded, {model: this, cache: cache});\n  }\n\n  _cacheRemoved(cache: Cache): void {\n    this.dispatchEventToListeners(Events.CacheRemoved, {model: this, cache: cache});\n  }\n\n  async _requestEntries(\n      cache: Cache, skipCount: number, pageSize: number, pathFilter: string,\n      callback: (arg0: Array<Protocol.CacheStorage.DataEntry>, arg1: number) => void): Promise<void> {\n    const response =\n        await this._cacheAgent.invoke_requestEntries({cacheId: cache.cacheId, skipCount, pageSize, pathFilter});\n    if (response.getError()) {\n      console.error('ServiceWorkerCacheAgent error while requesting entries: ', response.getError());\n      return;\n    }\n    callback(response.cacheDataEntries, response.returnCount);\n  }\n\n  async _requestAllEntries(\n      cache: Cache, pathFilter: string,\n      callback: (arg0: Array<Protocol.CacheStorage.DataEntry>, arg1: number) => void): Promise<void> {\n    const response = await this._cacheAgent.invoke_requestEntries({cacheId: cache.cacheId, pathFilter});\n    if (response.getError()) {\n      console.error('ServiceWorkerCacheAgent error while requesting entries: ', response.getError());\n      return;\n    }\n    callback(response.cacheDataEntries, response.returnCount);\n  }\n\n  cacheStorageListUpdated({origin}: Protocol.Storage.CacheStorageListUpdatedEvent): void {\n    this._originsUpdated.add(origin);\n\n    this._throttler.schedule(() => {\n      const promises = Array.from(this._originsUpdated, origin => this._loadCacheNames(origin));\n      this._originsUpdated.clear();\n      return Promise.all(promises);\n    });\n  }\n\n  cacheStorageContentUpdated({origin, cacheName}: Protocol.Storage.CacheStorageContentUpdatedEvent): void {\n    this.dispatchEventToListeners(Events.CacheStorageContentUpdated, {origin, cacheName});\n  }\n\n  indexedDBListUpdated(_event: Protocol.Storage.IndexedDBListUpdatedEvent): void {\n  }\n\n  indexedDBContentUpdated(_event: Protocol.Storage.IndexedDBContentUpdatedEvent): void {\n  }\n}\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum Events {\n  CacheAdded = 'CacheAdded',\n  CacheRemoved = 'CacheRemoved',\n  CacheStorageContentUpdated = 'CacheStorageContentUpdated',\n}\n\n\nexport class Cache {\n  _model: ServiceWorkerCacheModel;\n  securityOrigin: string;\n  cacheName: string;\n  cacheId: string;\n\n  constructor(model: ServiceWorkerCacheModel, securityOrigin: string, cacheName: string, cacheId: string) {\n    this._model = model;\n    this.securityOrigin = securityOrigin;\n    this.cacheName = cacheName;\n    this.cacheId = cacheId;\n  }\n\n  equals(cache: Cache): boolean {\n    return this.cacheId === cache.cacheId;\n  }\n\n  toString(): string {\n    return this.securityOrigin + this.cacheName;\n  }\n\n  async requestCachedResponse(url: string, requestHeaders: NameValue[]):\n      Promise<Protocol.CacheStorage.CachedResponse|null> {\n    const response = await this._model._cacheAgent.invoke_requestCachedResponse(\n        {cacheId: this.cacheId, requestURL: url, requestHeaders});\n    if (response.getError()) {\n      return null;\n    }\n    return response.response;\n  }\n}\n\nSDKModel.register(ServiceWorkerCacheModel, {capabilities: Capability.Storage, autostart: false});\n"]}