{"version":3,"file":"FilmStripModel.js","sourceRoot":"","sources":["../../../../../../front_end/core/sdk/FilmStripModel.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2015 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Platform from '../platform/platform.js';\n\nimport type {Event, ObjectSnapshot} from './TracingModel.js';\nimport {TracingModel} from './TracingModel.js';  // eslint-disable-line no-unused-vars\n\nexport class FilmStripModel {\n  _frames: Frame[];\n  _zeroTime: number;\n  _spanTime: number;\n  constructor(tracingModel: TracingModel, zeroTime?: number) {\n    this._frames = [];\n    this._zeroTime = 0;\n    this._spanTime = 0;\n\n    this.reset(tracingModel, zeroTime);\n  }\n\n  reset(tracingModel: TracingModel, zeroTime?: number): void {\n    this._zeroTime = zeroTime || tracingModel.minimumRecordTime();\n    this._spanTime = tracingModel.maximumRecordTime() - this._zeroTime;\n\n    /** @type {!Array<!Frame>} */\n    this._frames = [];\n    const browserMain = TracingModel.browserMainThread(tracingModel);\n    if (!browserMain) {\n      return;\n    }\n\n    const events = browserMain.events();\n    for (let i = 0; i < events.length; ++i) {\n      const event = events[i];\n      if (event.startTime < this._zeroTime) {\n        continue;\n      }\n      if (!event.hasCategory(_category)) {\n        continue;\n      }\n      if (event.name === TraceEvents.CaptureFrame) {\n        const data = event.args['data'];\n        if (data) {\n          this._frames.push(Frame._fromEvent(this, event, this._frames.length));\n        }\n      } else if (event.name === TraceEvents.Screenshot) {\n        this._frames.push(Frame._fromSnapshot(this, (event as ObjectSnapshot), this._frames.length));\n      }\n    }\n  }\n\n  frames(): Frame[] {\n    return this._frames;\n  }\n\n  zeroTime(): number {\n    return this._zeroTime;\n  }\n\n  spanTime(): number {\n    return this._spanTime;\n  }\n\n  frameByTimestamp(timestamp: number): Frame|null {\n    const index =\n        Platform.ArrayUtilities.upperBound(this._frames, timestamp, (timestamp, frame) => timestamp - frame.timestamp) -\n        1;\n    return index >= 0 ? this._frames[index] : null;\n  }\n}\n\n// TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst _category = 'disabled-by-default-devtools.screenshot';\n\nconst TraceEvents = {\n  CaptureFrame: 'CaptureFrame',\n  Screenshot: 'Screenshot',\n};\n\nexport class Frame {\n  _model: FilmStripModel;\n  timestamp: number;\n  index: number;\n  _imageData: string|null;\n  _snapshot: ObjectSnapshot|null;\n  constructor(model: FilmStripModel, timestamp: number, index: number) {\n    this._model = model;\n    this.timestamp = timestamp;\n    this.index = index;\n    this._imageData = null;\n    this._snapshot = null;\n  }\n\n  static _fromEvent(model: FilmStripModel, event: Event, index: number): Frame {\n    const frame = new Frame(model, event.startTime, index);\n    frame._imageData = event.args['data'];\n    return frame;\n  }\n\n  static _fromSnapshot(model: FilmStripModel, snapshot: ObjectSnapshot, index: number): Frame {\n    const frame = new Frame(model, snapshot.startTime, index);\n    frame._snapshot = snapshot;\n    return frame;\n  }\n\n  model(): FilmStripModel {\n    return this._model;\n  }\n\n  imageDataPromise(): Promise<string|null> {\n    if (this._imageData || !this._snapshot) {\n      return Promise.resolve(this._imageData);\n    }\n\n    return /** @type {!Promise<?string>} */ this._snapshot.objectPromise() as Promise<string|null>;\n  }\n}\n"]}