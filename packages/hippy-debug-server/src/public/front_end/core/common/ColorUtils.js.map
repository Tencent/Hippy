{"version":3,"file":"ColorUtils.js","sourceRoot":"","sources":["../../../../../../front_end/core/common/ColorUtils.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/**\n * Combine the two given colors according to alpha blending.\n */\n/* eslint-disable rulesdir/no_underscored_properties */\n\nexport function blendColors(fgRGBA: number[], bgRGBA: number[]): number[] {\n  const alpha = fgRGBA[3];\n  return [\n    ((1 - alpha) * bgRGBA[0]) + (alpha * fgRGBA[0]),\n    ((1 - alpha) * bgRGBA[1]) + (alpha * fgRGBA[1]),\n    ((1 - alpha) * bgRGBA[2]) + (alpha * fgRGBA[2]),\n    alpha + (bgRGBA[3] * (1 - alpha)),\n  ];\n}\n\nexport function rgbaToHsla([r, g, b, a]: number[]): number[] {\n  const max = Math.max(r, g, b);\n  const min = Math.min(r, g, b);\n  const diff = max - min;\n  const sum = max + min;\n\n  let h;\n  if (min === max) {\n    h = 0;\n  } else if (r === max) {\n    h = ((1 / 6 * (g - b) / diff) + 1) % 1;\n  } else if (g === max) {\n    h = (1 / 6 * (b - r) / diff) + 1 / 3;\n  } else {\n    h = (1 / 6 * (r - g) / diff) + 2 / 3;\n  }\n\n  const l = 0.5 * sum;\n\n  let s;\n  if (l === 0) {\n    s = 0;\n  } else if (l === 1) {\n    s = 0;\n  } else if (l <= 0.5) {\n    s = diff / sum;\n  } else {\n    s = diff / (2 - sum);\n  }\n\n  return [h, s, l, a];\n}\n\n/**\n* Calculate the luminance of this color using the WCAG algorithm.\n* See http://www.w3.org/TR/2008/REC-WCAG20-20081211/#relativeluminancedef\n*/\nexport function luminance([rSRGB, gSRGB, bSRGB]: number[]): number {\n  const r = rSRGB <= 0.03928 ? rSRGB / 12.92 : Math.pow(((rSRGB + 0.055) / 1.055), 2.4);\n  const g = gSRGB <= 0.03928 ? gSRGB / 12.92 : Math.pow(((gSRGB + 0.055) / 1.055), 2.4);\n  const b = bSRGB <= 0.03928 ? bSRGB / 12.92 : Math.pow(((bSRGB + 0.055) / 1.055), 2.4);\n\n  return 0.2126 * r + 0.7152 * g + 0.0722 * b;\n}\n\n/**\n * Calculate the contrast ratio between a foreground and a background color.\n * Returns the ratio to 1, for example for two two colors with a contrast ratio of 21:1, this function will return 21.\n * See http://www.w3.org/TR/2008/REC-WCAG20-20081211/#contrast-ratiodef\n */\nexport function contrastRatio(fgRGBA: number[], bgRGBA: number[]): number {\n  const blendedFg = blendColors(fgRGBA, bgRGBA);\n  const fgLuminance = luminance(blendedFg);\n  const bgLuminance = luminance(bgRGBA);\n  const contrastRatio = (Math.max(fgLuminance, bgLuminance) + 0.05) / (Math.min(fgLuminance, bgLuminance) + 0.05);\n  return contrastRatio;\n}\n\n// Constants for basic APCA version.\n// See https://github.com/Myndex/SAPC-APCA\nconst mainTRC = 2.4;\nconst normBgExp = 0.55;\nconst normFgExp = 0.58;\nconst revBgExp = 0.62;\nconst revFgExp = 0.57;\nconst blkThrs = 0.03;\nconst blkClmp = 1.45;\nconst scaleBoW = 1.25;\nconst scaleWoB = 1.25;\nconst deltaLuminanceMin = 0.0005;\nconst loConThresh = 0.078;\nconst loConFactor = 12.82051282051282;\nconst loConOffset = 0.06;\nconst loClip = 0.001;\n\n/**\n* Calculate relative luminance of a color.\n* See https://github.com/Myndex/SAPC-APCA\n*/\nexport function luminanceAPCA([rSRGB, gSRGB, bSRGB]: number[]): number {\n  const r = Math.pow(rSRGB, mainTRC);\n  const g = Math.pow(gSRGB, mainTRC);\n  const b = Math.pow(bSRGB, mainTRC);\n\n  return 0.2126729 * r + 0.7151522 * g + 0.0721750 * b;\n}\n\n/**\n * Calculate the contrast ratio between a foreground and a background color.\n * Returns the percentage of the predicted visual contrast.\n * See https://github.com/Myndex/SAPC-APCA\n */\nexport function contrastRatioAPCA(fgRGBA: number[], bgRGBA: number[]): number {\n  return contrastRatioByLuminanceAPCA(luminanceAPCA(fgRGBA), luminanceAPCA(bgRGBA));\n}\n\nfunction clampLuminance(value: number): number {\n  return value > blkThrs ? value : (value + Math.pow(blkThrs - value, blkClmp));\n}\n\nexport function contrastRatioByLuminanceAPCA(fgLuminance: number, bgLuminance: number): number {\n  fgLuminance = clampLuminance(fgLuminance);\n  bgLuminance = clampLuminance(bgLuminance);\n  if (Math.abs(fgLuminance - bgLuminance) < deltaLuminanceMin) {\n    return 0;\n  }\n  let result = 0;\n  if (bgLuminance >= fgLuminance) {  // Black text on white.\n    result = (Math.pow(bgLuminance, normBgExp) - Math.pow(fgLuminance, normFgExp)) * scaleBoW;\n    result = result < loClip ?\n        0 :\n        (result < loConThresh ? result - result * loConFactor * loConOffset : result - loConOffset);\n  } else {\n    // White text on black.\n    result = (Math.pow(bgLuminance, revBgExp) - Math.pow(fgLuminance, revFgExp)) * scaleWoB;\n    result = result > -loClip ?\n        0 :\n        (result > -loConThresh ? result - result * loConFactor * loConOffset : result + loConOffset);\n  }\n  return result * 100;\n}\n\n/**\n * Compute a desired luminance given a given luminance and a desired contrast\n * percentage according to APCA.\n */\nexport function desiredLuminanceAPCA(luminance: number, contrast: number, lighter: boolean): number {\n  luminance = clampLuminance(luminance);\n  contrast /= 100;\n  function computeLuminance(): number {\n    if (!lighter) {  // Black text on white.\n      return Math.pow(Math.abs(Math.pow(luminance, normBgExp) - (contrast + loConOffset) / scaleBoW), 1 / normFgExp);\n    }\n    // White text on black.\n    return Math.pow(Math.abs(Math.pow(luminance, revBgExp) - (-contrast - loConOffset) / scaleWoB), 1 / revFgExp);\n  }\n  let desiredLuminance = computeLuminance();\n  if (desiredLuminance < 0 || desiredLuminance > 1) {\n    lighter = !lighter;\n    desiredLuminance = computeLuminance();\n  }\n  return desiredLuminance;\n}\n\n// clang-format off\nconst contrastAPCALookupTable = [\n  // See https://github.com/Myndex/SAPC-APCA\n  // font size in px | 100 | 200 | 300 | 400 | 500 | 600 | 700 | 800 | 900 weights\n  [12, -1, -1, -1, -1, 100, 90, 80, -1, -1],\n  [14, -1, -1, -1, 100, 90, 80, 60, 60, -1],\n  [16, -1, -1, 100, 90, 80, 60, 55, 50, 50],\n  [18, -1, -1, 90, 80, 60, 55, 50, 40, 40],\n  [24, -1, 100, 80, 60, 55, 50, 40, 38, 35],\n  [30, -1, 90, 70, 55, 50, 40, 38, 35, 40],\n  [36, -1, 80, 60, 50, 40, 38, 35, 30, 25],\n  [48, 100, 70, 55, 40, 38, 35, 30, 25, 20],\n  [60, 90, 60, 50, 38, 35, 30, 25, 20, 20],\n  [72, 80, 55, 40, 35, 30, 25, 20, 20, 20],\n  [96, 70, 50, 35, 30, 25, 20, 20, 20, 20],\n  [120, 60, 40, 30, 25, 20, 20, 20, 20, 20],\n];\n// clang-format on\n\ncontrastAPCALookupTable.reverse();\n\nexport function getAPCAThreshold(fontSize: string, fontWeight: string): number|null {\n  const size = parseFloat(fontSize.replace('px', ''));\n  const weight = parseFloat(fontWeight);\n\n  // Go over the table backwards to find the first matching font size and then the weight.\n  // Fonts larger than 96px, use the thresholds for 96px.\n  // Fonts smaller than 12px, don't get any threshold meaning the font size needs to be increased.\n  for (const [rowSize, ...rowWeights] of contrastAPCALookupTable) {\n    if (size >= rowSize) {\n      for (const [idx, keywordWeight] of [900, 800, 700, 600, 500, 400, 300, 200, 100].entries()) {\n        if (weight >= keywordWeight) {\n          const threshold = rowWeights[rowWeights.length - 1 - idx];\n          return threshold === -1 ? null : threshold;\n        }\n      }\n    }\n  }\n\n  return null;\n}\n\nexport function isLargeFont(fontSize: string, fontWeight: string): boolean {\n  const boldWeights = ['bold', 'bolder', '600', '700', '800', '900'];\n\n  const fontSizePx = parseFloat(fontSize.replace('px', ''));\n  const isBold = (boldWeights.indexOf(fontWeight) !== -1);\n\n  const fontSizePt = fontSizePx * 72 / 96;\n  if (isBold) {\n    return fontSizePt >= 14;\n  }\n  return fontSizePt >= 18;\n}\n\nconst contrastThresholds = {\n  largeFont: {aa: 3.0, aaa: 4.5},\n  normalFont: {aa: 4.5, aaa: 7.0},\n};\n\nexport function getContrastThreshold(fontSize: string, fontWeight: string): {\n  aa: number,\n  aaa: number,\n} {\n  if (isLargeFont(fontSize, fontWeight)) {\n    return contrastThresholds.largeFont;\n  }\n  return contrastThresholds.normalFont;\n}\n"]}