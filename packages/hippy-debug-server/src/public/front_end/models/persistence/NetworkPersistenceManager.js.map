{"version":3,"file":"NetworkPersistenceManager.js","sourceRoot":"","sources":["../../../../../../front_end/models/persistence/NetworkPersistenceManager.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Common from '../../core/common/common.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\nimport * as Workspace from '../workspace/workspace.js';\n\nimport type {FileSystem} from './FileSystemWorkspaceBinding.js';\nimport {FileSystemWorkspaceBinding} from './FileSystemWorkspaceBinding.js';\nimport {PersistenceBinding, PersistenceImpl} from './PersistenceImpl.js';\n\nlet networkPersistenceManagerInstance: NetworkPersistenceManager|null;\n\nexport class NetworkPersistenceManager extends Common.ObjectWrapper.ObjectWrapper {\n  _bindings: WeakMap<Workspace.UISourceCode.UISourceCode, PersistenceBinding>;\n  _originalResponseContentPromises: WeakMap<Workspace.UISourceCode.UISourceCode, Promise<string|null>>;\n  _savingForOverrides: WeakSet<Workspace.UISourceCode.UISourceCode>;\n  _savingSymbol: symbol;\n  _enabledSetting: Common.Settings.Setting<boolean>;\n  _workspace: Workspace.Workspace.WorkspaceImpl;\n  _networkUISourceCodeForEncodedPath: Map<string, Workspace.UISourceCode.UISourceCode>;\n  _interceptionHandlerBound: (interceptedRequest: SDK.NetworkManager.InterceptedRequest) => Promise<void>;\n  _updateInterceptionThrottler: Common.Throttler.Throttler;\n  _project: Workspace.Workspace.Project|null;\n  _activeProject: Workspace.Workspace.Project|null;\n  _active: boolean;\n  _enabled: boolean;\n  _eventDescriptors: Common.EventTarget.EventDescriptor[];\n\n  private constructor(workspace: Workspace.Workspace.WorkspaceImpl) {\n    super();\n    this._bindings = new WeakMap();\n    this._originalResponseContentPromises = new WeakMap();\n    this._savingForOverrides = new WeakSet();\n    this._savingSymbol = Symbol('SavingForOverrides');\n\n    this._enabledSetting = Common.Settings.Settings.instance().moduleSetting('persistenceNetworkOverridesEnabled');\n    this._enabledSetting.addChangeListener(this._enabledChanged, this);\n\n    this._workspace = workspace;\n\n    this._networkUISourceCodeForEncodedPath = new Map();\n    this._interceptionHandlerBound = this._interceptionHandler.bind(this);\n    this._updateInterceptionThrottler = new Common.Throttler.Throttler(50);\n\n    this._project = null;\n    this._activeProject = null;\n\n    this._active = false;\n    this._enabled = false;\n\n    this._workspace.addEventListener(Workspace.Workspace.Events.ProjectAdded, event => {\n      this._onProjectAdded(event.data as Workspace.Workspace.Project);\n    });\n    this._workspace.addEventListener(Workspace.Workspace.Events.ProjectRemoved, event => {\n      this._onProjectRemoved(event.data as Workspace.Workspace.Project);\n    });\n\n    PersistenceImpl.instance().addNetworkInterceptor(this._canHandleNetworkUISourceCode.bind(this));\n\n    this._eventDescriptors = [];\n    this._enabledChanged();\n  }\n\n  static instance(opts: {\n    forceNew: boolean|null,\n    workspace: Workspace.Workspace.WorkspaceImpl|null,\n  } = {forceNew: null, workspace: null}): NetworkPersistenceManager {\n    const {forceNew, workspace} = opts;\n    if (!networkPersistenceManagerInstance || forceNew) {\n      if (!workspace) {\n        throw new Error('Missing workspace for NetworkPersistenceManager');\n      }\n      networkPersistenceManagerInstance = new NetworkPersistenceManager(workspace);\n    }\n\n    return networkPersistenceManagerInstance;\n  }\n\n  active(): boolean {\n    return this._active;\n  }\n\n  project(): Workspace.Workspace.Project|null {\n    return this._project;\n  }\n\n  originalContentForUISourceCode(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<string|null>|null {\n    const binding = this._bindings.get(uiSourceCode);\n    if (!binding) {\n      return null;\n    }\n    const fileSystemUISourceCode = binding.fileSystem;\n    return this._originalResponseContentPromises.get(fileSystemUISourceCode) || null;\n  }\n\n  async _enabledChanged(): Promise<void> {\n    if (this._enabled === this._enabledSetting.get()) {\n      return;\n    }\n    this._enabled = this._enabledSetting.get();\n    if (this._enabled) {\n      this._eventDescriptors = [\n        Workspace.Workspace.WorkspaceImpl.instance().addEventListener(\n            Workspace.Workspace.Events.UISourceCodeRenamed,\n            event => {\n              this._uiSourceCodeRenamedListener(event);\n            }),\n        Workspace.Workspace.WorkspaceImpl.instance().addEventListener(\n            Workspace.Workspace.Events.UISourceCodeAdded,\n            event => {\n              this._uiSourceCodeAdded(event);\n            }),\n        Workspace.Workspace.WorkspaceImpl.instance().addEventListener(\n            Workspace.Workspace.Events.UISourceCodeRemoved,\n            event => {\n              this._uiSourceCodeRemovedListener(event);\n            }),\n        Workspace.Workspace.WorkspaceImpl.instance().addEventListener(\n            Workspace.Workspace.Events.WorkingCopyCommitted,\n            event => this._onUISourceCodeWorkingCopyCommitted(\n                event.data.uiSourceCode as Workspace.UISourceCode.UISourceCode)),\n      ];\n      await this._updateActiveProject();\n    } else {\n      Common.EventTarget.EventTarget.removeEventListeners(this._eventDescriptors);\n      await this._updateActiveProject();\n    }\n  }\n\n  async _uiSourceCodeRenamedListener(event: Common.EventTarget.EventTargetEvent): Promise<void> {\n    const uiSourceCode = event.data.uiSourceCode as Workspace.UISourceCode.UISourceCode;\n    await this._onUISourceCodeRemoved(uiSourceCode);\n    await this._onUISourceCodeAdded(uiSourceCode);\n  }\n\n  async _uiSourceCodeRemovedListener(event: Common.EventTarget.EventTargetEvent): Promise<void> {\n    await this._onUISourceCodeRemoved(event.data as Workspace.UISourceCode.UISourceCode);\n  }\n\n  async _uiSourceCodeAdded(event: Common.EventTarget.EventTargetEvent): Promise<void> {\n    await this._onUISourceCodeAdded(event.data as Workspace.UISourceCode.UISourceCode);\n  }\n\n  async _updateActiveProject(): Promise<void> {\n    const wasActive = this._active;\n    this._active =\n        Boolean(this._enabledSetting.get() && SDK.TargetManager.TargetManager.instance().mainTarget() && this._project);\n    if (this._active === wasActive) {\n      return;\n    }\n\n    if (this._active && this._project) {\n      await Promise.all(\n          this._project.uiSourceCodes().map(uiSourceCode => this._filesystemUISourceCodeAdded(uiSourceCode)));\n\n      const networkProjects = this._workspace.projectsForType(Workspace.Workspace.projectTypes.Network);\n      for (const networkProject of networkProjects) {\n        await Promise.all(\n            networkProject.uiSourceCodes().map(uiSourceCode => this._networkUISourceCodeAdded(uiSourceCode)));\n      }\n    } else if (this._project) {\n      await Promise.all(\n          this._project.uiSourceCodes().map(uiSourceCode => this._filesystemUISourceCodeRemoved(uiSourceCode)));\n      this._networkUISourceCodeForEncodedPath.clear();\n    }\n    PersistenceImpl.instance().refreshAutomapping();\n  }\n\n  _encodedPathFromUrl(url: string): string {\n    if (!this._active || !this._project) {\n      return '';\n    }\n    let urlPath = Common.ParsedURL.ParsedURL.urlWithoutHash(url.replace(/^https?:\\/\\//, ''));\n    if (urlPath.endsWith('/') && urlPath.indexOf('?') === -1) {\n      urlPath = urlPath + 'index.html';\n    }\n    let encodedPathParts = encodeUrlPathToLocalPathParts(urlPath);\n    const projectPath = FileSystemWorkspaceBinding.fileSystemPath(this._project.id());\n    const encodedPath = encodedPathParts.join('/');\n    if (projectPath.length + encodedPath.length > 200) {\n      const domain = encodedPathParts[0];\n      const encodedFileName = encodedPathParts[encodedPathParts.length - 1];\n      const shortFileName = encodedFileName ? encodedFileName.substr(0, 10) + '-' : '';\n      const extension = Common.ParsedURL.ParsedURL.extractExtension(urlPath);\n      const extensionPart = extension ? '.' + extension.substr(0, 10) : '';\n      encodedPathParts = [\n        domain,\n        'longurls',\n        shortFileName + Platform.StringUtilities.hashCode(encodedPath).toString(16) + extensionPart,\n      ];\n    }\n    return encodedPathParts.join('/');\n\n    function encodeUrlPathToLocalPathParts(urlPath: string): string[] {\n      const encodedParts = [];\n      for (const pathPart of fileNamePartsFromUrlPath(urlPath)) {\n        if (!pathPart) {\n          continue;\n        }\n        // encodeURI() escapes all the unsafe filename characters except /:?*\n        let encodedName = encodeURI(pathPart).replace(/[\\/:\\?\\*]/g, match => '%' + match[0].charCodeAt(0).toString(16));\n        // Windows does not allow a small set of filenames.\n        if (RESERVED_FILENAMES.has(encodedName.toLowerCase())) {\n          encodedName = encodedName.split('').map(char => '%' + char.charCodeAt(0).toString(16)).join('');\n        }\n        // Windows does not allow the file to end in a space or dot (space should already be encoded).\n        const lastChar = encodedName.charAt(encodedName.length - 1);\n        if (lastChar === '.') {\n          encodedName = encodedName.substr(0, encodedName.length - 1) + '%2e';\n        }\n        encodedParts.push(encodedName);\n      }\n      return encodedParts;\n    }\n\n    function fileNamePartsFromUrlPath(urlPath: string): string[] {\n      urlPath = Common.ParsedURL.ParsedURL.urlWithoutHash(urlPath);\n      const queryIndex = urlPath.indexOf('?');\n      if (queryIndex === -1) {\n        return urlPath.split('/');\n      }\n      if (queryIndex === 0) {\n        return [urlPath];\n      }\n      const endSection = urlPath.substr(queryIndex);\n      const parts = urlPath.substr(0, urlPath.length - endSection.length).split('/');\n      parts[parts.length - 1] += endSection;\n      return parts;\n    }\n  }\n\n  _decodeLocalPathToUrlPath(path: string): string {\n    try {\n      return unescape(path);\n    } catch (e) {\n      console.error(e);\n    }\n    return path;\n  }\n\n  async _unbind(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    const binding = this._bindings.get(uiSourceCode);\n    if (binding) {\n      this._bindings.delete(binding.network);\n      this._bindings.delete(binding.fileSystem);\n      await PersistenceImpl.instance().removeBinding(binding);\n    }\n  }\n\n  async _bind(\n      networkUISourceCode: Workspace.UISourceCode.UISourceCode,\n      fileSystemUISourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    if (this._bindings.has(networkUISourceCode)) {\n      await this._unbind(networkUISourceCode);\n    }\n    if (this._bindings.has(fileSystemUISourceCode)) {\n      await this._unbind(fileSystemUISourceCode);\n    }\n    const binding = new PersistenceBinding(networkUISourceCode, fileSystemUISourceCode);\n    this._bindings.set(networkUISourceCode, binding);\n    this._bindings.set(fileSystemUISourceCode, binding);\n    await PersistenceImpl.instance().addBinding(binding);\n    const uiSourceCodeOfTruth =\n        this._savingForOverrides.has(networkUISourceCode) ? networkUISourceCode : fileSystemUISourceCode;\n    const [{content}, encoded] =\n        await Promise.all([uiSourceCodeOfTruth.requestContent(), uiSourceCodeOfTruth.contentEncoded()]);\n    PersistenceImpl.instance().syncContent(uiSourceCodeOfTruth, content || '', encoded);\n  }\n\n  _onUISourceCodeWorkingCopyCommitted(uiSourceCode: Workspace.UISourceCode.UISourceCode): void {\n    this.saveUISourceCodeForOverrides(uiSourceCode);\n  }\n\n  canSaveUISourceCodeForOverrides(uiSourceCode: Workspace.UISourceCode.UISourceCode): boolean {\n    return this._active && uiSourceCode.project().type() === Workspace.Workspace.projectTypes.Network &&\n        !this._bindings.has(uiSourceCode) && !this._savingForOverrides.has(uiSourceCode);\n  }\n\n  async saveUISourceCodeForOverrides(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    if (!this.canSaveUISourceCodeForOverrides(uiSourceCode)) {\n      return;\n    }\n    this._savingForOverrides.add(uiSourceCode);\n    let encodedPath = this._encodedPathFromUrl(uiSourceCode.url());\n    const content = (await uiSourceCode.requestContent()).content || '';\n    const encoded = await uiSourceCode.contentEncoded();\n    const lastIndexOfSlash = encodedPath.lastIndexOf('/');\n    const encodedFileName = encodedPath.substr(lastIndexOfSlash + 1);\n    encodedPath = encodedPath.substr(0, lastIndexOfSlash);\n    if (this._project) {\n      await this._project.createFile(encodedPath, encodedFileName, content, encoded);\n    }\n    this._fileCreatedForTest(encodedPath, encodedFileName);\n    this._savingForOverrides.delete(uiSourceCode);\n  }\n\n  _fileCreatedForTest(_path: string, _fileName: string): void {\n  }\n\n  _patternForFileSystemUISourceCode(uiSourceCode: Workspace.UISourceCode.UISourceCode): string {\n    const relativePathParts = FileSystemWorkspaceBinding.relativePath(uiSourceCode);\n    if (relativePathParts.length < 2) {\n      return '';\n    }\n    if (relativePathParts[1] === 'longurls' && relativePathParts.length !== 2) {\n      return 'http?://' + relativePathParts[0] + '/*';\n    }\n    return 'http?://' + this._decodeLocalPathToUrlPath(relativePathParts.join('/'));\n  }\n\n  async _onUISourceCodeAdded(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    await this._networkUISourceCodeAdded(uiSourceCode);\n    await this._filesystemUISourceCodeAdded(uiSourceCode);\n  }\n\n  _canHandleNetworkUISourceCode(uiSourceCode: Workspace.UISourceCode.UISourceCode): boolean {\n    return this._active && !uiSourceCode.url().startsWith('snippet://');\n  }\n\n  async _networkUISourceCodeAdded(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    if (uiSourceCode.project().type() !== Workspace.Workspace.projectTypes.Network ||\n        !this._canHandleNetworkUISourceCode(uiSourceCode)) {\n      return;\n    }\n    const url = Common.ParsedURL.ParsedURL.urlWithoutHash(uiSourceCode.url());\n    this._networkUISourceCodeForEncodedPath.set(this._encodedPathFromUrl(url), uiSourceCode);\n\n    const project = this._project as FileSystem;\n    const fileSystemUISourceCode =\n        project.uiSourceCodeForURL(project.fileSystemPath() + '/' + this._encodedPathFromUrl(url));\n    if (fileSystemUISourceCode) {\n      await this._bind(uiSourceCode, fileSystemUISourceCode);\n    }\n  }\n\n  async _filesystemUISourceCodeAdded(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    if (!this._active || uiSourceCode.project() !== this._project) {\n      return;\n    }\n    this._updateInterceptionPatterns();\n\n    const relativePath = FileSystemWorkspaceBinding.relativePath(uiSourceCode);\n    const networkUISourceCode = this._networkUISourceCodeForEncodedPath.get(relativePath.join('/'));\n    if (networkUISourceCode) {\n      await this._bind(networkUISourceCode, uiSourceCode);\n    }\n  }\n\n  _updateInterceptionPatterns(): void {\n    this._updateInterceptionThrottler.schedule(innerUpdateInterceptionPatterns.bind(this));\n\n    function innerUpdateInterceptionPatterns(this: NetworkPersistenceManager): Promise<void> {\n      if (!this._active || !this._project) {\n        return SDK.NetworkManager.MultitargetNetworkManager.instance().setInterceptionHandlerForPatterns(\n            [], this._interceptionHandlerBound);\n      }\n      const patterns = new Set<string>();\n      const indexFileName = 'index.html';\n      for (const uiSourceCode of this._project.uiSourceCodes()) {\n        const pattern = this._patternForFileSystemUISourceCode(uiSourceCode);\n        patterns.add(pattern);\n        if (pattern.endsWith('/' + indexFileName)) {\n          patterns.add(pattern.substr(0, pattern.length - indexFileName.length));\n        }\n      }\n\n      return SDK.NetworkManager.MultitargetNetworkManager.instance().setInterceptionHandlerForPatterns(\n          Array.from(patterns).map(\n              pattern =>\n                  ({urlPattern: pattern, interceptionStage: Protocol.Network.InterceptionStage.HeadersReceived})),\n          this._interceptionHandlerBound);\n    }\n  }\n\n  async _onUISourceCodeRemoved(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    await this._networkUISourceCodeRemoved(uiSourceCode);\n    await this._filesystemUISourceCodeRemoved(uiSourceCode);\n  }\n\n  async _networkUISourceCodeRemoved(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    if (uiSourceCode.project().type() === Workspace.Workspace.projectTypes.Network) {\n      await this._unbind(uiSourceCode);\n      this._networkUISourceCodeForEncodedPath.delete(this._encodedPathFromUrl(uiSourceCode.url()));\n    }\n  }\n\n  async _filesystemUISourceCodeRemoved(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<void> {\n    if (uiSourceCode.project() !== this._project) {\n      return;\n    }\n    this._updateInterceptionPatterns();\n    this._originalResponseContentPromises.delete(uiSourceCode);\n    await this._unbind(uiSourceCode);\n  }\n\n  async _setProject(project: Workspace.Workspace.Project|null): Promise<void> {\n    if (project === this._project) {\n      return;\n    }\n\n    if (this._project) {\n      await Promise.all(\n          this._project.uiSourceCodes().map(uiSourceCode => this._filesystemUISourceCodeRemoved(uiSourceCode)));\n    }\n\n    this._project = project;\n\n    if (this._project) {\n      await Promise.all(\n          this._project.uiSourceCodes().map(uiSourceCode => this._filesystemUISourceCodeAdded(uiSourceCode)));\n    }\n\n    await this._updateActiveProject();\n    this.dispatchEventToListeners(Events.ProjectChanged, this._project);\n  }\n\n  async _onProjectAdded(project: Workspace.Workspace.Project): Promise<void> {\n    if (project.type() !== Workspace.Workspace.projectTypes.FileSystem ||\n        FileSystemWorkspaceBinding.fileSystemType(project) !== 'overrides') {\n      return;\n    }\n    const fileSystemPath = FileSystemWorkspaceBinding.fileSystemPath(project.id());\n    if (!fileSystemPath) {\n      return;\n    }\n    if (this._project) {\n      this._project.remove();\n    }\n\n    await this._setProject(project);\n  }\n\n  async _onProjectRemoved(project: Workspace.Workspace.Project): Promise<void> {\n    if (project === this._project) {\n      await this._setProject(null);\n    }\n  }\n\n  async _interceptionHandler(interceptedRequest: SDK.NetworkManager.InterceptedRequest): Promise<void> {\n    const method = interceptedRequest.request.method;\n    if (!this._active || (method !== 'GET' && method !== 'POST')) {\n      return;\n    }\n    const proj = this._project as FileSystem;\n    const path = proj.fileSystemPath() + '/' + this._encodedPathFromUrl(interceptedRequest.request.url);\n    const fileSystemUISourceCode = proj.uiSourceCodeForURL(path);\n    if (!fileSystemUISourceCode) {\n      return;\n    }\n\n    let mimeType = '';\n    if (interceptedRequest.responseHeaders) {\n      const responseHeaders = SDK.NetworkManager.NetworkManager.lowercaseHeaders(interceptedRequest.responseHeaders);\n      mimeType = responseHeaders['content-type'];\n    }\n\n    if (!mimeType) {\n      const expectedResourceType =\n          Common.ResourceType.resourceTypes[interceptedRequest.resourceType] || Common.ResourceType.resourceTypes.Other;\n      mimeType = fileSystemUISourceCode.mimeType();\n      if (Common.ResourceType.ResourceType.fromMimeType(mimeType) !== expectedResourceType) {\n        mimeType = expectedResourceType.canonicalMimeType();\n      }\n    }\n    const project = fileSystemUISourceCode.project() as FileSystem;\n\n    this._originalResponseContentPromises.set(\n        fileSystemUISourceCode, interceptedRequest.responseBody().then(response => {\n          if (response.error || response.content === null) {\n            return null;\n          }\n          if (response.encoded) {\n            const text = atob(response.content);\n            const data = new Uint8Array(text.length);\n            for (let i = 0; i < text.length; ++i) {\n              data[i] = text.charCodeAt(i);\n            }\n            return new TextDecoder('utf-8').decode(data);\n          }\n          return response.content;\n        }));\n\n    const blob = await project.requestFileBlob(fileSystemUISourceCode);\n    if (blob) {\n      interceptedRequest.continueRequestWithContent(new Blob([blob], {type: mimeType}));\n    }\n  }\n}\n\nconst RESERVED_FILENAMES = new Set<string>([\n  'con',  'prn',  'aux',  'nul',  'com1', 'com2', 'com3', 'com4', 'com5', 'com6', 'com7',\n  'com8', 'com9', 'lpt1', 'lpt2', 'lpt3', 'lpt4', 'lpt5', 'lpt6', 'lpt7', 'lpt8', 'lpt9',\n]);\n\nexport const Events = {\n  ProjectChanged: Symbol('ProjectChanged'),\n};\n"]}