{"version":3,"file":"WorkspaceSettingsTab.js","sourceRoot":"","sources":["../../../../../../front_end/models/persistence/WorkspaceSettingsTab.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport {EditFileSystemView} from './EditFileSystemView.js';\nimport type {FileSystem} from './FileSystemWorkspaceBinding.js';\nimport {IsolatedFileSystem} from './IsolatedFileSystem.js';\nimport {Events, IsolatedFileSystemManager} from './IsolatedFileSystemManager.js';\nimport {NetworkPersistenceManager} from './NetworkPersistenceManager.js';\nimport type {PlatformFileSystem} from './PlatformFileSystem.js';\n\nconst UIStrings = {\n  /**\n  *@description Text of a DOM element in Workspace Settings Tab of the Workspace settings in Settings\n  */\n  workspace: 'Workspace',\n  /**\n  *@description Text of a DOM element in Workspace Settings Tab of the Workspace settings in Settings\n  */\n  mappingsAreInferredAutomatically: 'Mappings are inferred automatically.',\n  /**\n  *@description Text of the add button in Workspace Settings Tab of the Workspace settings in Settings\n  */\n  addFolder: 'Add folderâ€¦',\n  /**\n  *@description Label element text content in Workspace Settings Tab of the Workspace settings in Settings\n  */\n  folderExcludePattern: 'Folder exclude pattern',\n  /**\n  *@description Label for an item to remove something\n  */\n  remove: 'Remove',\n};\nconst str_ = i18n.i18n.registerUIStrings('models/persistence/WorkspaceSettingsTab.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nlet workspaceSettingsTabInstance: WorkspaceSettingsTab;\n\nexport class WorkspaceSettingsTab extends UI.Widget.VBox {\n  containerElement: HTMLElement;\n  _fileSystemsListContainer: HTMLElement;\n  _elementByPath: Map<string, Element>;\n  _mappingViewByPath: Map<string, EditFileSystemView>;\n  private constructor() {\n    super();\n    this.registerRequiredCSS('models/persistence/workspaceSettingsTab.css', {enableLegacyPatching: false});\n\n    const header = this.element.createChild('header');\n    UI.UIUtils.createTextChild(header.createChild('h1'), i18nString(UIStrings.workspace));\n\n    this.containerElement = this.element.createChild('div', 'settings-container-wrapper')\n                                .createChild('div', 'settings-tab settings-content settings-container');\n\n    IsolatedFileSystemManager.instance().addEventListener(\n        Events.FileSystemAdded, event => this._fileSystemAdded(event.data as PlatformFileSystem), this);\n    IsolatedFileSystemManager.instance().addEventListener(\n        Events.FileSystemRemoved, event => this._fileSystemRemoved(event.data as PlatformFileSystem), this);\n\n    const folderExcludePatternInput = this._createFolderExcludePatternInput();\n    folderExcludePatternInput.classList.add('folder-exclude-pattern');\n    this.containerElement.appendChild(folderExcludePatternInput);\n\n    const div = this.containerElement.createChild('div', 'settings-info-message');\n    UI.UIUtils.createTextChild(div, i18nString(UIStrings.mappingsAreInferredAutomatically));\n\n    this._fileSystemsListContainer = this.containerElement.createChild('div', '');\n\n    const addButton =\n        UI.UIUtils.createTextButton(i18nString(UIStrings.addFolder), this._addFileSystemClicked.bind(this));\n    this.containerElement.appendChild(addButton);\n    this.setDefaultFocusedElement(addButton);\n\n    this._elementByPath = new Map();\n\n    this._mappingViewByPath = new Map();\n\n    const fileSystems = IsolatedFileSystemManager.instance().fileSystems();\n    for (let i = 0; i < fileSystems.length; ++i) {\n      this._addItem(fileSystems[i]);\n    }\n  }\n\n  static instance(opts: {forceNew: boolean|null} = {forceNew: null}): WorkspaceSettingsTab {\n    const {forceNew} = opts;\n    if (!workspaceSettingsTabInstance || forceNew) {\n      workspaceSettingsTabInstance = new WorkspaceSettingsTab();\n    }\n\n    return workspaceSettingsTabInstance;\n  }\n\n  _createFolderExcludePatternInput(): Element {\n    const p = document.createElement('p');\n    const labelElement = p.createChild('label');\n    labelElement.textContent = i18nString(UIStrings.folderExcludePattern);\n    const inputElement = UI.UIUtils.createInput('', 'text');\n    UI.ARIAUtils.bindLabelToControl(labelElement, inputElement);\n    p.appendChild(inputElement);\n    inputElement.style.width = '270px';\n    const folderExcludeSetting = IsolatedFileSystemManager.instance().workspaceFolderExcludePatternSetting();\n    const setValue =\n        UI.UIUtils.bindInput(inputElement, folderExcludeSetting.set.bind(folderExcludeSetting), regexValidator, false);\n    folderExcludeSetting.addChangeListener(() => setValue.call(null, folderExcludeSetting.get()));\n    setValue(folderExcludeSetting.get());\n    return p;\n\n    function regexValidator(value: string): {valid: boolean, errorMessage: (string|undefined)} {\n      let regex;\n      try {\n        regex = new RegExp(value);\n      } catch (e) {\n      }\n      const valid = Boolean(regex);\n      return {valid, errorMessage: undefined};\n    }\n  }\n\n  _addItem(fileSystem: PlatformFileSystem): void {\n    // Support managing only instances of IsolatedFileSystem.\n    if (!(fileSystem instanceof IsolatedFileSystem)) {\n      return;\n    }\n    const networkPersistenceProject = NetworkPersistenceManager.instance().project();\n    if (networkPersistenceProject &&\n        IsolatedFileSystemManager.instance().fileSystem((networkPersistenceProject as FileSystem).fileSystemPath()) ===\n            fileSystem) {\n      return;\n    }\n    const element = this._renderFileSystem(fileSystem);\n    this._elementByPath.set(fileSystem.path(), element);\n\n    this._fileSystemsListContainer.appendChild(element);\n\n    const mappingView = new EditFileSystemView(fileSystem.path());\n    this._mappingViewByPath.set(fileSystem.path(), mappingView);\n    mappingView.element.classList.add('file-system-mapping-view');\n    mappingView.show(element);\n  }\n\n  _renderFileSystem(fileSystem: PlatformFileSystem): Element {\n    const fileSystemPath = fileSystem.path();\n    const lastIndexOfSlash = fileSystemPath.lastIndexOf('/');\n    const folderName = fileSystemPath.substr(lastIndexOfSlash + 1);\n\n    const element = document.createElement('div');\n    element.classList.add('file-system-container');\n    const header = element.createChild('div', 'file-system-header');\n\n    const nameElement = header.createChild('div', 'file-system-name');\n    nameElement.textContent = folderName;\n    UI.ARIAUtils.markAsHeading(nameElement, 2);\n    const path = header.createChild('div', 'file-system-path');\n    path.textContent = fileSystemPath;\n    UI.Tooltip.Tooltip.install(path, fileSystemPath);\n\n    const toolbar = new UI.Toolbar.Toolbar('');\n    const button = new UI.Toolbar.ToolbarButton(i18nString(UIStrings.remove), 'largeicon-delete');\n    button.addEventListener(\n        UI.Toolbar.ToolbarButton.Events.Click, this._removeFileSystemClicked.bind(this, fileSystem));\n    toolbar.appendToolbarItem(button);\n    header.appendChild(toolbar.element);\n\n    return element;\n  }\n\n  _removeFileSystemClicked(fileSystem: PlatformFileSystem): void {\n    IsolatedFileSystemManager.instance().removeFileSystem(fileSystem);\n  }\n\n  _addFileSystemClicked(): void {\n    IsolatedFileSystemManager.instance().addFileSystem();\n  }\n\n  _fileSystemAdded(fileSystem: PlatformFileSystem): void {\n    this._addItem(fileSystem);\n  }\n\n  _fileSystemRemoved(fileSystem: PlatformFileSystem): void {\n    const mappingView = this._mappingViewByPath.get(fileSystem.path());\n    if (mappingView) {\n      mappingView.dispose();\n      this._mappingViewByPath.delete(fileSystem.path());\n    }\n\n    const element = this._elementByPath.get(fileSystem.path());\n    if (element) {\n      this._elementByPath.delete(fileSystem.path());\n      element.remove();\n    }\n  }\n}\n"]}