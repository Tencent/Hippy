{"version":3,"file":"RecordingSession.js","sourceRoot":"","sources":["../../../../../../front_end/models/recorder/RecordingSession.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Common from '../../core/common/common.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport type * as ProtocolProxyApi from '../../generated/protocol-proxy-api.js';\nimport type * as Protocol from '../../generated/protocol.js';\n\nimport {RecordingEventHandler} from './RecordingEventHandler.js';\nimport {setupRecordingClient} from './RecordingClient.js';\nimport type {Condition, Step, StepWithCondition, UserFlow, UserFlowSection} from './Steps.js';\nimport {createViewportStep} from './Steps.js';\nimport {createEmulateNetworkConditionsStep} from './Steps.js';\n\nconst RECORDER_ISOLATED_WORLD_NAME = 'devtools_recorder';\n\ntype RecorderEvent = {\n  type: 'windowOpened'|'windowClosed'|'navigation'|'bindingCalled',\n  event: Common.EventTarget.EventTargetEvent,\n};\n\nexport class RecordingSession extends Common.ObjectWrapper.ObjectWrapper {\n  _target: SDK.Target.Target;\n  _runtimeAgent: ProtocolProxyApi.RuntimeApi;\n  _accessibilityAgent: ProtocolProxyApi.AccessibilityApi;\n  _pageAgent: ProtocolProxyApi.PageApi;\n  _targetAgent: ProtocolProxyApi.TargetApi;\n  _networkManager: SDK.NetworkManager.MultitargetNetworkManager;\n  _domModel: SDK.DOMModel.DOMModel;\n  _resourceTreeModel: SDK.ResourceTreeModel.ResourceTreeModel;\n  _runtimeModel: SDK.RuntimeModel.RuntimeModel;\n  _childTargetManager: SDK.ChildTargetManager.ChildTargetManager|null;\n  _eventHandlers: Map<string, RecordingEventHandler>;\n  _targets: Map<string, SDK.Target.Target>;\n  _newDocumentScriptIdentifiers: Map<string, string>;\n  _indentation: string;\n  _eventQueue: Array<RecorderEvent> = [];\n  _isProcessingEvent = false;\n  userFlow: UserFlow;\n\n  constructor(target: SDK.Target.Target, indentation: string) {\n    super();\n\n    this._target = target;\n    this._indentation = indentation;\n\n    this._runtimeAgent = target.runtimeAgent();\n    this._accessibilityAgent = target.accessibilityAgent();\n    this._pageAgent = target.pageAgent();\n    this._targetAgent = target.targetAgent();\n\n    this._networkManager = SDK.NetworkManager.MultitargetNetworkManager.instance();\n    const domModel = target.model(SDK.DOMModel.DOMModel);\n    if (!domModel) {\n      throw new Error('DOMModel is missing for the target: ' + target.id());\n    }\n    this._domModel = domModel;\n    const resourceTreeModel = target.model(SDK.ResourceTreeModel.ResourceTreeModel);\n    if (!resourceTreeModel) {\n      throw new Error('ResourceTreeModel is missing for the target: ' + target.id());\n    }\n    this._resourceTreeModel = resourceTreeModel;\n    const runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel);\n    if (!runtimeModel) {\n      throw new Error('RuntimeModel is missing for the target: ' + target.id());\n    }\n    this._runtimeModel = runtimeModel;\n    this._childTargetManager = target.model(SDK.ChildTargetManager.ChildTargetManager);\n\n    this._target = target;\n    this._eventHandlers = new Map();\n    this._targets = new Map();\n    this._newDocumentScriptIdentifiers = new Map();\n\n    this.userFlow = {\n      title: 'New Recording',\n      sections: [],\n    };\n  }\n\n  async start(): Promise<void> {\n    const mainFrame = this._resourceTreeModel.mainFrame;\n    if (!mainFrame) {\n      throw new Error('Could not find main frame');\n    }\n\n    this._networkManager.addEventListener(\n        SDK.NetworkManager.MultitargetNetworkManager.Events.ConditionsChanged, this.addNetworkConditionsChangedStep,\n        this);\n\n    const {cssVisualViewport} = await this._target.pageAgent().invoke_getLayoutMetrics();\n\n    await this.attachToTarget(this._target);\n\n    const networkConditions = this._networkManager.networkConditions();\n    if (networkConditions !== SDK.NetworkManager.NoThrottlingConditions) {\n      this.addNetworkConditionsChangedStep();\n    }\n\n    await this.appendNewSection(true);\n    this.addViewportStep(cssVisualViewport);\n\n    // Focus the target so that events can be captured without additional actions.\n    await this._pageAgent.invoke_bringToFront();\n  }\n\n  async appendNewSection(includeNetworkConditions: boolean = false): Promise<void> {\n    const mainFrame = this._resourceTreeModel.mainFrame;\n    if (!mainFrame) {\n      throw new Error('Could not find mainFrame.');\n    }\n\n    const url = mainFrame.url;\n    const title = mainFrame.name;\n\n    const {data: screenshot} = await this._pageAgent.invoke_captureScreenshot({\n      captureBeyondViewport: false,\n    });\n\n    const section: UserFlowSection = {\n      title,\n      url,\n      screenshot: 'data:image/png;base64,' + screenshot,\n      steps: [],\n    };\n\n    if (includeNetworkConditions) {\n      const networkConditions = this._networkManager.networkConditions();\n      if (networkConditions !== SDK.NetworkManager.NoThrottlingConditions) {\n        section.networkConditions = networkConditions;\n      }\n    }\n    this.userFlow.sections.push(section);\n\n    this.dispatchEventToListeners('recording-updated', this.userFlow);\n  }\n\n  async stop(): Promise<void> {\n    for (const target of this._targets.values()) {\n      await this.detachFromTarget(target);\n    }\n    await this.detachFromTarget(this._target);\n\n    this._networkManager.removeEventListener(\n        SDK.NetworkManager.MultitargetNetworkManager.Events.ConditionsChanged, this.addNetworkConditionsChangedStep,\n        this);\n  }\n\n  addViewportStep(viewport: Protocol.Page.VisualViewport): void {\n    this.appendStep(createViewportStep(viewport));\n  }\n\n  addNetworkConditionsChangedStep(): void {\n    const networkConditions = this._networkManager.networkConditions();\n    this.appendStep(createEmulateNetworkConditionsStep(networkConditions));\n  }\n\n  async appendStep(step: Step): Promise<Step> {\n    const currentSection = this.userFlow.sections[this.userFlow.sections.length - 1];\n    currentSection.steps.push(step);\n\n    this.dispatchEventToListeners('recording-updated', this.userFlow);\n    return step;\n  }\n\n  addConditionToStep(step: StepWithCondition, condition: Condition): void {\n    step.condition = condition;\n    this.dispatchEventToListeners('recording-updated', this.userFlow);\n  }\n\n  bindingCalled(event: Common.EventTarget.EventTargetEvent): void {\n    this._enqueueEvent({type: 'bindingCalled', event});\n  }\n\n  bindingCalledInternal(params: {data: Protocol.Runtime.BindingCalledEvent}): void {\n    if (params.data.name !== 'addStep') {\n      return;\n    }\n    const executionContextId = params.data.executionContextId;\n    let contextTarget: SDK.Target.Target|undefined;\n    let frameId: string|undefined;\n    for (const target of this._targets.values()) {\n      const runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel);\n      if (runtimeModel) {\n        for (const context of runtimeModel.executionContexts()) {\n          if (context.id === executionContextId) {\n            contextTarget = target;\n            frameId = context.frameId;\n          }\n        }\n      }\n    }\n    if (!contextTarget || !frameId) {\n      return;\n    }\n\n    const eventHandler = this._eventHandlers.get(contextTarget.id());\n    if (!eventHandler) {\n      return;\n    }\n\n    eventHandler.bindingCalled(frameId, JSON.parse(params.data.payload));\n  }\n\n  async attachToTarget(target: SDK.Target.Target): Promise<void> {\n    if (target.type() !== SDK.Target.Type.Frame) {\n      return;\n    }\n    this._targets.set(target.id(), target);\n    const eventHandler = new RecordingEventHandler(this, target);\n    this._eventHandlers.set(target.id(), eventHandler);\n\n    const pageAgent = target.pageAgent();\n\n    const runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel) as SDK.RuntimeModel.RuntimeModel;\n\n    await runtimeModel.addBinding({\n      name: 'addStep',\n      executionContextName: RECORDER_ISOLATED_WORLD_NAME,\n    });\n\n    runtimeModel.addEventListener(SDK.RuntimeModel.Events.BindingCalled, this.bindingCalled, this);\n\n    // TODO(alexrudenko): maybe wire this flag up to DEBUG mode or a setting?\n    const debugRecordingClient = false;\n    // This setting is set during the test to work around the fact that Puppeteer cannot\n    // send trusted change and input events.\n    let untrustedRecorderEvents = false;\n    try {\n      Common.Settings.Settings.instance().settingForTest('untrustedRecorderEvents');\n      untrustedRecorderEvents = true;\n    } catch {\n    }\n    const setupEventListeners = setupRecordingClient.toString() +\n        `;${setupRecordingClient.name}({getAccessibleName, getAccessibleRole}, ${debugRecordingClient}, ${\n                                    untrustedRecorderEvents});`;\n\n    const {identifier} = await pageAgent.invoke_addScriptToEvaluateOnNewDocument(\n        {source: setupEventListeners, worldName: RECORDER_ISOLATED_WORLD_NAME, includeCommandLineAPI: true});\n    this._newDocumentScriptIdentifiers.set(target.id(), identifier);\n\n    await this.evaluateInAllFrames(target, setupEventListeners);\n\n    const childTargetManager =\n        target.model(SDK.ChildTargetManager.ChildTargetManager) as SDK.ChildTargetManager.ChildTargetManager;\n    childTargetManager.addEventListener(SDK.ChildTargetManager.Events.TargetCreated, this.receiveWindowOpened, this);\n    childTargetManager.addEventListener(SDK.ChildTargetManager.Events.TargetDestroyed, this.receiveWindowClosed, this);\n    childTargetManager.addEventListener(SDK.ChildTargetManager.Events.TargetInfoChanged, this.receiveNavigation, this);\n    for (const target of childTargetManager.childTargets()) {\n      await this.attachToTarget(target);\n    }\n  }\n\n  async detachFromTarget(target: SDK.Target.Target): Promise<void> {\n    const childTargetManager = target.model(SDK.ChildTargetManager.ChildTargetManager);\n\n    if (childTargetManager) {\n      childTargetManager.removeEventListener(\n          SDK.ChildTargetManager.Events.TargetCreated, this.receiveWindowOpened, this);\n      childTargetManager.removeEventListener(\n          SDK.ChildTargetManager.Events.TargetDestroyed, this.receiveWindowClosed, this);\n      childTargetManager.removeEventListener(\n          SDK.ChildTargetManager.Events.TargetInfoChanged, this.receiveNavigation, this);\n    }\n\n    const newDocumentScriptIdentifier = this._newDocumentScriptIdentifiers.get(target.id());\n    if (newDocumentScriptIdentifier) {\n      await target.pageAgent().invoke_removeScriptToEvaluateOnNewDocument({identifier: newDocumentScriptIdentifier});\n    }\n\n    await target.runtimeAgent().invoke_removeBinding({\n      name: 'addStep',\n    });\n\n    const runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel);\n\n    if (runtimeModel) {\n      runtimeModel.removeEventListener(SDK.RuntimeModel.Events.BindingCalled, this.bindingCalled, this);\n    }\n\n    this._eventHandlers.delete(target.id());\n  }\n\n  async evaluateInAllFrames(target: SDK.Target.Target, expression: string): Promise<void> {\n    const resourceTreeModel =\n        target.model(SDK.ResourceTreeModel.ResourceTreeModel) as SDK.ResourceTreeModel.ResourceTreeModel;\n    const runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel) as SDK.RuntimeModel.RuntimeModel;\n    const executionContexts = runtimeModel.executionContexts();\n    for (const frame of resourceTreeModel.frames()) {\n      const executionContext = executionContexts.find(context => context.frameId === frame.id);\n      if (!executionContext) {\n        continue;\n      }\n      // Note: it would return previously created world if it exists for the frame.\n      const world = await target.pageAgent().invoke_createIsolatedWorld({\n        frameId: frame.id,\n        worldName: RECORDER_ISOLATED_WORLD_NAME,\n      });\n      await target.runtimeAgent().invoke_evaluate({\n        expression,\n        includeCommandLineAPI: true,\n        contextId: world.executionContextId,\n      });\n    }\n  }\n\n  receiveWindowOpened(event: Common.EventTarget.EventTargetEvent): void {\n    this._enqueueEvent({type: 'windowOpened', event});\n  }\n\n  receiveWindowClosed(event: Common.EventTarget.EventTargetEvent): void {\n    this._enqueueEvent({type: 'windowClosed', event});\n  }\n\n  receiveNavigation(event: Common.EventTarget.EventTargetEvent): void {\n    this._enqueueEvent({type: 'navigation', event});\n  }\n\n  async _enqueueEvent(event: RecorderEvent): Promise<void> {\n    this._eventQueue.push(event);\n    if (this._isProcessingEvent) {\n      return;\n    }\n    while (this._eventQueue.length) {\n      this._isProcessingEvent = true;\n      try {\n        const item = this._eventQueue.shift();\n        if (!item) {\n          throw new Error('No event found in the queue');\n        }\n        switch (item.type) {\n          case 'windowClosed':\n            await this.handleWindowClosed(item.event);\n            break;\n          case 'windowOpened':\n            await this.handleWindowOpened(item.event);\n            break;\n          case 'navigation':\n            await this.handleNavigation(item.event);\n            break;\n          case 'bindingCalled':\n            this.bindingCalledInternal(item.event);\n            break;\n        }\n      } catch (err) {\n        console.error('error happened while processing recording events', err);\n      } finally {\n        this._isProcessingEvent = false;\n      }\n    }\n  }\n\n  async handleWindowOpened(event: Common.EventTarget.EventTargetEvent): Promise<void> {\n    if (event.data.type !== 'page') {\n      return;\n    }\n    const executionContexts = this._runtimeModel.executionContexts();\n    const executionContext = executionContexts.find(context => context.frameId === event.data.openerFrameId);\n    if (!executionContext) {\n      throw new Error('Could not find execution context in opened frame.');\n    }\n\n    await this._targetAgent.invoke_attachToTarget({targetId: event.data.targetId, flatten: true});\n    const target = SDK.TargetManager.TargetManager.instance().targets().find(t => t.id() === event.data.targetId);\n\n    if (!target) {\n      throw new Error('Could not find target.');\n    }\n    await this.attachToTarget(target);\n  }\n\n  async handleWindowClosed(event: Common.EventTarget.EventTargetEvent): Promise<void> {\n    const target = this._targets.get(event.data);\n    if (!target) {\n      return;\n    }\n\n    const targetInfo = target.targetInfo();\n    if (targetInfo && targetInfo.type !== 'page') {\n      return;\n    }\n\n    const eventHandler = this._eventHandlers.get(target.id());\n    if (!eventHandler) {\n      return;\n    }\n    eventHandler.targetDestroyed();\n  }\n\n  async handleNavigation(event: Common.EventTarget.EventTargetEvent): Promise<void> {\n    if (event.data.type !== 'page') {\n      return;\n    }\n\n    // TODO: can we get rid of _resourceTreeModel?\n    const targetId = this._resourceTreeModel.mainFrame?.id === event.data.targetId ? 'main' : event.data.targetId;\n    const eventHandler = this._eventHandlers.get(targetId);\n    if (!eventHandler) {\n      return;\n    }\n\n    eventHandler.targetInfoChanged(event.data.url);\n  }\n\n\n  getUserFlow(): UserFlow {\n    return this.userFlow;\n  }\n}\n"]}