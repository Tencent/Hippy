{"version":3,"file":"CorsIssue.js","sourceRoot":"","sources":["../../../../../../front_end/models/issues_manager/CorsIssue.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\n\nimport {Issue, IssueCategory, IssueKind} from './Issue.js';\nimport type {MarkdownIssueDescription} from './MarkdownIssueDescription.js';\n\n\nconst UIStrings = {\n  /**\n  *@description Label for the link for CORS private network issues\n  */\n  corsForPrivateNetworksRfc: 'CORS for private networks (RFC1918)',\n  /**\n  *@description Label for the link for CORS network issues\n  */\n  CORS: 'Cross-Origin Resource Sharing (`CORS`)',\n};\nconst str_ = i18n.i18n.registerUIStrings('models/issues_manager/CorsIssue.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum IssueCode {\n  InsecurePrivateNetwork = 'CorsIssue::InsecurePrivateNetwork',\n  InsecurePrivateNetworkPreflight = 'CorsIssue::InsecurePrivateNetworkPreflight',\n  InvalidHeaderValues = 'CorsIssue::InvalidHeaders',\n  WildcardOriginNotAllowed = 'CorsIssue::WildcardOriginWithCredentials',\n  PreflightResponseInvalid = 'CorsIssue::PreflightResponseInvalid',\n  OriginMismatch = 'CorsIssue::OriginMismatch',\n  AllowCredentialsRequired = 'CorsIssue::AllowCredentialsRequired',\n  MethodDisallowedByPreflightResponse = 'CorsIssue::MethodDisallowedByPreflightResponse',\n  HeaderDisallowedByPreflightResponse = 'CorsIssue::HeaderDisallowedByPreflightResponse',\n  RedirectContainsCredentials = 'CorsIssue::RedirectContainsCredentials',\n  DisallowedByMode = 'CorsIssue::DisallowedByMode',\n  CorsDisabledScheme = 'CorsIssue::CorsDisabledScheme',\n  PreflightMissingAllowExternal = 'CorsIssue::PreflightMissingAllowExternal',\n  PreflightInvalidAllowExternal = 'CorsIssue::PreflightInvalidAllowExternal',\n  InvalidResponse = 'CorsIssue::InvalidResponse',\n  NoCorsRedirectModeNotFollow = 'CorsIssue::NoCorsRedirectModeNotFollow',\n}\n\nfunction getIssueCode(details: Protocol.Audits.CorsIssueDetails): IssueCode {\n  switch (details.corsErrorStatus.corsError) {\n    case Protocol.Network.CorsError.InvalidAllowMethodsPreflightResponse:\n    case Protocol.Network.CorsError.InvalidAllowHeadersPreflightResponse:\n    case Protocol.Network.CorsError.PreflightMissingAllowOriginHeader:\n    case Protocol.Network.CorsError.PreflightMultipleAllowOriginValues:\n    case Protocol.Network.CorsError.PreflightInvalidAllowOriginValue:\n    case Protocol.Network.CorsError.MissingAllowOriginHeader:\n    case Protocol.Network.CorsError.MultipleAllowOriginValues:\n    case Protocol.Network.CorsError.InvalidAllowOriginValue:\n      return IssueCode.InvalidHeaderValues;\n    case Protocol.Network.CorsError.PreflightWildcardOriginNotAllowed:\n    case Protocol.Network.CorsError.WildcardOriginNotAllowed:\n      return IssueCode.WildcardOriginNotAllowed;\n    case Protocol.Network.CorsError.PreflightInvalidStatus:\n    case Protocol.Network.CorsError.PreflightDisallowedRedirect:\n      return IssueCode.PreflightResponseInvalid;\n    case Protocol.Network.CorsError.AllowOriginMismatch:\n    case Protocol.Network.CorsError.PreflightAllowOriginMismatch:\n      return IssueCode.OriginMismatch;\n    case Protocol.Network.CorsError.InvalidAllowCredentials:\n    case Protocol.Network.CorsError.PreflightInvalidAllowCredentials:\n      return IssueCode.AllowCredentialsRequired;\n    case Protocol.Network.CorsError.MethodDisallowedByPreflightResponse:\n      return IssueCode.MethodDisallowedByPreflightResponse;\n    case Protocol.Network.CorsError.HeaderDisallowedByPreflightResponse:\n      return IssueCode.HeaderDisallowedByPreflightResponse;\n    case Protocol.Network.CorsError.RedirectContainsCredentials:\n      return IssueCode.RedirectContainsCredentials;\n    case Protocol.Network.CorsError.DisallowedByMode:\n      return IssueCode.DisallowedByMode;\n    case Protocol.Network.CorsError.CorsDisabledScheme:\n      return IssueCode.CorsDisabledScheme;\n    case Protocol.Network.CorsError.PreflightMissingAllowExternal:\n      return IssueCode.PreflightMissingAllowExternal;\n    case Protocol.Network.CorsError.PreflightInvalidAllowExternal:\n      return IssueCode.PreflightInvalidAllowExternal;\n    case Protocol.Network.CorsError.InvalidResponse:\n      return IssueCode.InvalidResponse;\n    case Protocol.Network.CorsError.InsecurePrivateNetwork:\n      return details.clientSecurityState?.initiatorIsSecureContext ? IssueCode.InsecurePrivateNetworkPreflight :\n                                                                     IssueCode.InsecurePrivateNetwork;\n    case Protocol.Network.CorsError.NoCorsRedirectModeNotFollow:\n      return IssueCode.NoCorsRedirectModeNotFollow;\n  }\n}\n\nexport class CorsIssue extends Issue<IssueCode> {\n  private issueDetails: Protocol.Audits.CorsIssueDetails;\n\n  constructor(issueDetails: Protocol.Audits.CorsIssueDetails, issuesModel: SDK.IssuesModel.IssuesModel) {\n    super(getIssueCode(issueDetails), issuesModel);\n    this.issueDetails = issueDetails;\n  }\n\n  getCategory(): IssueCategory {\n    return IssueCategory.Cors;\n  }\n\n  details(): Protocol.Audits.CorsIssueDetails {\n    return this.issueDetails;\n  }\n\n  getDescription(): MarkdownIssueDescription|null {\n    switch (getIssueCode(this.issueDetails)) {\n      case IssueCode.InsecurePrivateNetwork:\n        return {\n          file: 'corsInsecurePrivateNetwork.md',\n          links: [{\n            link: 'https://developer.chrome.com/blog/private-network-access-update',\n            linkTitle: i18nString(UIStrings.corsForPrivateNetworksRfc),\n          }],\n        };\n      case IssueCode.InsecurePrivateNetworkPreflight:\n        return {\n          file: 'corsInsecurePrivateNetworkPreflight.md',\n          links: [{\n            link: 'https://developer.chrome.com/blog/private-network-access-update',\n            linkTitle: i18nString(UIStrings.corsForPrivateNetworksRfc),\n          }],\n        };\n      case IssueCode.InvalidHeaderValues:\n        return {\n          file: 'corsInvalidHeaderValues.md',\n          links: [{\n            link: 'https://web.dev/cross-origin-resource-sharing',\n            linkTitle: i18nString(UIStrings.CORS),\n          }],\n        };\n      case IssueCode.WildcardOriginNotAllowed:\n        return {\n          file: 'corsWildcardOriginNotAllowed.md',\n          links: [{\n            link: 'https://web.dev/cross-origin-resource-sharing',\n            linkTitle: i18nString(UIStrings.CORS),\n          }],\n        };\n      case IssueCode.PreflightResponseInvalid:\n        return {\n          file: 'corsPreflightResponseInvalid.md',\n          links: [{\n            link: 'https://web.dev/cross-origin-resource-sharing',\n            linkTitle: i18nString(UIStrings.CORS),\n          }],\n        };\n      case IssueCode.OriginMismatch:\n        return {\n          file: 'corsOriginMismatch.md',\n          links: [{\n            link: 'https://web.dev/cross-origin-resource-sharing',\n            linkTitle: i18nString(UIStrings.CORS),\n          }],\n        };\n      case IssueCode.AllowCredentialsRequired:\n        return {\n          file: 'corsAllowCredentialsRequired.md',\n          links: [{\n            link: 'https://web.dev/cross-origin-resource-sharing',\n            linkTitle: i18nString(UIStrings.CORS),\n          }],\n        };\n      case IssueCode.MethodDisallowedByPreflightResponse:\n        return {\n          file: 'corsMethodDisallowedByPreflightResponse.md',\n          links: [{\n            link: 'https://web.dev/cross-origin-resource-sharing',\n            linkTitle: i18nString(UIStrings.CORS),\n          }],\n        };\n      case IssueCode.HeaderDisallowedByPreflightResponse:\n        return {\n          file: 'corsHeaderDisallowedByPreflightResponse.md',\n          links: [{\n            link: 'https://web.dev/cross-origin-resource-sharing',\n            linkTitle: i18nString(UIStrings.CORS),\n          }],\n        };\n      case IssueCode.RedirectContainsCredentials:\n        return {\n          file: 'corsRedirectContainsCredentials.md',\n          links: [{\n            link: 'https://web.dev/cross-origin-resource-sharing',\n            linkTitle: i18nString(UIStrings.CORS),\n          }],\n        };\n      case IssueCode.DisallowedByMode:\n        return {\n          file: 'corsDisallowedByMode.md',\n          links: [{\n            link: 'https://web.dev/cross-origin-resource-sharing',\n            linkTitle: i18nString(UIStrings.CORS),\n          }],\n        };\n      case IssueCode.CorsDisabledScheme:\n        return {\n          file: 'corsDisabledScheme.md',\n          links: [{\n            link: 'https://web.dev/cross-origin-resource-sharing',\n            linkTitle: i18nString(UIStrings.CORS),\n          }],\n        };\n      case IssueCode.NoCorsRedirectModeNotFollow:\n        return {\n          file: 'corsNoCorsRedirectModeNotFollow.md',\n          links: [{\n            link: 'https://web.dev/cross-origin-resource-sharing',\n            linkTitle: i18nString(UIStrings.CORS),\n          }],\n        };\n      case IssueCode.PreflightMissingAllowExternal:\n      case IssueCode.PreflightInvalidAllowExternal:\n      case IssueCode.InvalidResponse:\n        return null;\n    }\n  }\n\n  primaryKey(): string {\n    return JSON.stringify(this.issueDetails);\n  }\n\n  getKind(): IssueKind {\n    if (this.issueDetails.isWarning &&\n        this.issueDetails.corsErrorStatus.corsError === Protocol.Network.CorsError.InsecurePrivateNetwork) {\n      return IssueKind.BreakingChange;\n    }\n    return IssueKind.PageError;\n  }\n\n  static fromInspectorIssue(issuesModel: SDK.IssuesModel.IssuesModel, inspectorIssue: Protocol.Audits.InspectorIssue):\n      CorsIssue[] {\n    const corsIssueDetails = inspectorIssue.details.corsIssueDetails;\n    if (!corsIssueDetails) {\n      console.warn('Cors issue without details received.');\n      return [];\n    }\n    return [new CorsIssue(corsIssueDetails, issuesModel)];\n  }\n}\n"]}