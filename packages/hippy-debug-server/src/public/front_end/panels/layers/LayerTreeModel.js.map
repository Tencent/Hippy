{"version":3,"file":"LayerTreeModel.js","sourceRoot":"","sources":["../../../../../../front_end/panels/layers/LayerTreeModel.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright (C) 2013 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Common from '../../core/common/common.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport type * as ProtocolProxyApi from '../../generated/protocol-proxy-api.js';\nimport type * as Protocol from '../../generated/protocol.js';\n\nexport class LayerTreeModel extends SDK.SDKModel.SDKModel {\n  _layerTreeAgent: ProtocolProxyApi.LayerTreeApi;\n  _paintProfilerModel: SDK.PaintProfiler.PaintProfilerModel;\n  _layerTree: SDK.LayerTreeBase.LayerTreeBase|null;\n  _throttler: Common.Throttler.Throttler;\n  _enabled?: boolean;\n  _lastPaintRectByLayerId?: Map<string, Protocol.DOM.Rect>;\n\n  constructor(target: SDK.Target.Target) {\n    super(target);\n    this._layerTreeAgent = target.layerTreeAgent();\n    target.registerLayerTreeDispatcher(new LayerTreeDispatcher(this));\n    this._paintProfilerModel =\n        target.model(SDK.PaintProfiler.PaintProfilerModel) as SDK.PaintProfiler.PaintProfilerModel;\n    const resourceTreeModel = target.model(SDK.ResourceTreeModel.ResourceTreeModel);\n    if (resourceTreeModel) {\n      resourceTreeModel.addEventListener(\n          SDK.ResourceTreeModel.Events.MainFrameNavigated, this._onMainFrameNavigated, this);\n    }\n    this._layerTree = null;\n    this._throttler = new Common.Throttler.Throttler(20);\n  }\n\n  async disable(): Promise<void> {\n    if (!this._enabled) {\n      return;\n    }\n    this._enabled = false;\n    await this._layerTreeAgent.invoke_disable();\n  }\n\n  enable(): void {\n    if (this._enabled) {\n      return;\n    }\n    this._enabled = true;\n    this._forceEnable();\n  }\n\n  async _forceEnable(): Promise<void> {\n    this._lastPaintRectByLayerId = new Map();\n    if (!this._layerTree) {\n      this._layerTree = new AgentLayerTree(this);\n    }\n    await this._layerTreeAgent.invoke_enable();\n  }\n\n  layerTree(): SDK.LayerTreeBase.LayerTreeBase|null {\n    return this._layerTree;\n  }\n\n  async _layerTreeChanged(layers: Protocol.LayerTree.Layer[]|null): Promise<void> {\n    if (!this._enabled) {\n      return;\n    }\n    this._throttler.schedule(this._innerSetLayers.bind(this, layers));\n  }\n\n  async _innerSetLayers(layers: Protocol.LayerTree.Layer[]|null): Promise<void> {\n    const layerTree = this._layerTree as AgentLayerTree;\n\n    await layerTree.setLayers(layers);\n\n    if (!this._lastPaintRectByLayerId) {\n      this._lastPaintRectByLayerId = new Map();\n    }\n\n    for (const layerId of this._lastPaintRectByLayerId.keys()) {\n      const lastPaintRect = this._lastPaintRectByLayerId.get(layerId);\n      const layer = layerTree.layerById(layerId);\n      if (layer) {\n        (layer as AgentLayer)._lastPaintRect = lastPaintRect;\n      }\n    }\n\n    this._lastPaintRectByLayerId = new Map();\n\n    this.dispatchEventToListeners(Events.LayerTreeChanged);\n  }\n\n  _layerPainted(layerId: string, clipRect: Protocol.DOM.Rect): void {\n    if (!this._enabled) {\n      return;\n    }\n    const layerTree = this._layerTree as AgentLayerTree;\n    const layer = layerTree.layerById(layerId) as AgentLayer;\n    if (!layer) {\n      if (!this._lastPaintRectByLayerId) {\n        this._lastPaintRectByLayerId = new Map();\n      }\n\n      this._lastPaintRectByLayerId.set(layerId, clipRect);\n      return;\n    }\n    layer._didPaint(clipRect);\n    this.dispatchEventToListeners(Events.LayerPainted, layer);\n  }\n\n  _onMainFrameNavigated(): void {\n    this._layerTree = null;\n    if (this._enabled) {\n      this._forceEnable();\n    }\n  }\n}\n\nSDK.SDKModel.SDKModel.register(LayerTreeModel, {capabilities: SDK.Target.Capability.DOM, autostart: false});\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum Events {\n  LayerTreeChanged = 'LayerTreeChanged',\n  LayerPainted = 'LayerPainted',\n}\n\nexport class AgentLayerTree extends SDK.LayerTreeBase.LayerTreeBase {\n  _layerTreeModel: LayerTreeModel;\n\n  constructor(layerTreeModel: LayerTreeModel) {\n    super(layerTreeModel.target());\n    this._layerTreeModel = layerTreeModel;\n  }\n\n  async setLayers(payload: Protocol.LayerTree.Layer[]|null): Promise<void> {\n    if (!payload) {\n      this._innerSetLayers(payload);\n      return;\n    }\n    const idsToResolve = new Set<number>();\n    for (let i = 0; i < payload.length; ++i) {\n      const backendNodeId = payload[i].backendNodeId;\n      if (!backendNodeId || this.backendNodeIdToNode().has(backendNodeId)) {\n        continue;\n      }\n      idsToResolve.add(backendNodeId);\n    }\n    await this.resolveBackendNodeIds(idsToResolve);\n    this._innerSetLayers(payload);\n  }\n\n  _innerSetLayers(layers: Protocol.LayerTree.Layer[]|null): void {\n    this.setRoot(null);\n    this.setContentRoot(null);\n    // Payload will be null when not in the composited mode.\n    if (!layers) {\n      return;\n    }\n    let root;\n    const oldLayersById = this.layersById;\n    this.layersById = new Map();\n    for (let i = 0; i < layers.length; ++i) {\n      const layerId = layers[i].layerId;\n      let layer: AgentLayer|(AgentLayer | null) = oldLayersById.get(layerId) as AgentLayer | null;\n      if (layer) {\n        layer._reset(layers[i]);\n      } else {\n        layer = new AgentLayer(this._layerTreeModel, layers[i]);\n      }\n      this.layersById.set(layerId, layer);\n      const backendNodeId = layers[i].backendNodeId;\n      if (backendNodeId) {\n        layer._setNode(this.backendNodeIdToNode().get(backendNodeId) || null);\n      }\n      if (!this.contentRoot() && layer.drawsContent()) {\n        this.setContentRoot(layer);\n      }\n      const parentId = layer.parentId();\n      if (parentId) {\n        const parent = this.layersById.get(parentId);\n        if (!parent) {\n          throw new Error(`Missing parent ${parentId} for layer ${layerId}`);\n        }\n        parent.addChild(layer);\n      } else {\n        if (root) {\n          console.assert(false, 'Multiple root layers');\n        }\n        root = layer;\n      }\n    }\n    if (root) {\n      this.setRoot(root);\n      root._calculateQuad(new WebKitCSSMatrix());\n    }\n  }\n}\n\nexport class AgentLayer implements SDK.LayerTreeBase.Layer {\n  _scrollRects!: Protocol.LayerTree.ScrollRect[];\n  _quad!: number[];\n  _children!: AgentLayer[];\n  _image!: HTMLImageElement|null;\n  _parent!: AgentLayer|null;\n  _layerPayload!: Protocol.LayerTree.Layer;\n  _layerTreeModel: LayerTreeModel;\n  _node?: SDK.DOMModel.DOMNode|null;\n  _lastPaintRect?: Protocol.DOM.Rect;\n  _paintCount?: number;\n  _stickyPositionConstraint?: SDK.LayerTreeBase.StickyPositionConstraint|null;\n  constructor(layerTreeModel: LayerTreeModel, layerPayload: Protocol.LayerTree.Layer) {\n    this._layerTreeModel = layerTreeModel;\n    this._reset(layerPayload);\n  }\n\n  id(): string {\n    return this._layerPayload.layerId;\n  }\n\n  parentId(): string|null {\n    return this._layerPayload.parentLayerId || null;\n  }\n\n  parent(): SDK.LayerTreeBase.Layer|null {\n    return this._parent;\n  }\n\n  isRoot(): boolean {\n    return !this.parentId();\n  }\n\n  children(): SDK.LayerTreeBase.Layer[] {\n    return this._children;\n  }\n\n  addChild(childParam: SDK.LayerTreeBase.Layer): void {\n    const child = childParam as AgentLayer;\n    if (child._parent) {\n      console.assert(false, 'Child already has a parent');\n    }\n    this._children.push(child);\n    child._parent = this;\n  }\n\n  _setNode(node: SDK.DOMModel.DOMNode|null): void {\n    this._node = node;\n  }\n\n  node(): SDK.DOMModel.DOMNode|null {\n    return this._node || null;\n  }\n\n  nodeForSelfOrAncestor(): SDK.DOMModel.DOMNode|null {\n    let layer: (AgentLayer|null)|this = this;\n    for (; layer; layer = layer._parent) {\n      if (layer._node) {\n        return layer._node;\n      }\n    }\n    return null;\n  }\n\n  offsetX(): number {\n    return this._layerPayload.offsetX;\n  }\n\n  offsetY(): number {\n    return this._layerPayload.offsetY;\n  }\n\n  width(): number {\n    return this._layerPayload.width;\n  }\n\n  height(): number {\n    return this._layerPayload.height;\n  }\n\n  transform(): number[]|null {\n    return this._layerPayload.transform || null;\n  }\n\n  quad(): number[] {\n    return this._quad;\n  }\n\n  anchorPoint(): number[] {\n    return [\n      this._layerPayload.anchorX || 0,\n      this._layerPayload.anchorY || 0,\n      this._layerPayload.anchorZ || 0,\n    ];\n  }\n\n  invisible(): boolean {\n    return this._layerPayload.invisible || false;\n  }\n\n  paintCount(): number {\n    return this._paintCount || this._layerPayload.paintCount;\n  }\n\n  lastPaintRect(): Protocol.DOM.Rect|null {\n    return this._lastPaintRect || null;\n  }\n\n  scrollRects(): Protocol.LayerTree.ScrollRect[] {\n    return this._scrollRects;\n  }\n\n  stickyPositionConstraint(): SDK.LayerTreeBase.StickyPositionConstraint|null {\n    return this._stickyPositionConstraint || null;\n  }\n\n  async requestCompositingReasonIds(): Promise<string[]> {\n    const reasons = await this._layerTreeModel._layerTreeAgent.invoke_compositingReasons({layerId: this.id()});\n    return reasons.compositingReasonIds || [];\n  }\n\n  drawsContent(): boolean {\n    return this._layerPayload.drawsContent;\n  }\n\n  gpuMemoryUsage(): number {\n    /**\n     * @const\n     */\n    const bytesPerPixel = 4;\n    return this.drawsContent() ? this.width() * this.height() * bytesPerPixel : 0;\n  }\n\n  snapshots(): Promise<SDK.PaintProfiler.SnapshotWithRect|null>[] {\n    const promise = this._layerTreeModel._paintProfilerModel.makeSnapshot(this.id()).then(snapshot => {\n      if (!snapshot) {\n        return null;\n      }\n      return {rect: {x: 0, y: 0, width: this.width(), height: this.height()}, snapshot: snapshot};\n    });\n    return [promise];\n  }\n\n  _didPaint(rect: Protocol.DOM.Rect): void {\n    this._lastPaintRect = rect;\n    this._paintCount = this.paintCount() + 1;\n    this._image = null;\n  }\n\n  _reset(layerPayload: Protocol.LayerTree.Layer): void {\n    /** @type {?SDK.DOMModel.DOMNode} */\n    this._node = null;\n    this._children = [];\n    this._parent = null;\n    this._paintCount = 0;\n    this._layerPayload = layerPayload;\n    this._image = null;\n    this._scrollRects = this._layerPayload.scrollRects || [];\n    this._stickyPositionConstraint = this._layerPayload.stickyPositionConstraint ?\n        new SDK.LayerTreeBase.StickyPositionConstraint(\n            this._layerTreeModel.layerTree(), this._layerPayload.stickyPositionConstraint) :\n        null;\n  }\n\n  _matrixFromArray(a: number[]): DOMMatrix {\n    function toFixed9(x: number): string {\n      return x.toFixed(9);\n    }\n    return new WebKitCSSMatrix('matrix3d(' + a.map(toFixed9).join(',') + ')');\n  }\n\n  _calculateTransformToViewport(parentTransform: DOMMatrix): DOMMatrix {\n    const offsetMatrix = new WebKitCSSMatrix().translate(this._layerPayload.offsetX, this._layerPayload.offsetY);\n    let matrix: DOMMatrix = offsetMatrix;\n\n    if (this._layerPayload.transform) {\n      const transformMatrix = this._matrixFromArray(this._layerPayload.transform);\n      const anchorVector = new UI.Geometry.Vector(\n          this._layerPayload.width * this.anchorPoint()[0], this._layerPayload.height * this.anchorPoint()[1],\n          this.anchorPoint()[2]);\n      const anchorPoint = UI.Geometry.multiplyVectorByMatrixAndNormalize(anchorVector, matrix);\n      const anchorMatrix = new WebKitCSSMatrix().translate(-anchorPoint.x, -anchorPoint.y, -anchorPoint.z);\n      matrix = anchorMatrix.inverse().multiply(transformMatrix.multiply(anchorMatrix.multiply(matrix)));\n    }\n\n    matrix = parentTransform.multiply(matrix);\n    return matrix;\n  }\n\n  _createVertexArrayForRect(width: number, height: number): number[] {\n    return [0, 0, 0, width, 0, 0, width, height, 0, 0, height, 0];\n  }\n\n  _calculateQuad(parentTransform: DOMMatrix): void {\n    const matrix = this._calculateTransformToViewport(parentTransform);\n    this._quad = [];\n    const vertices = this._createVertexArrayForRect(this._layerPayload.width, this._layerPayload.height);\n    for (let i = 0; i < 4; ++i) {\n      const point = UI.Geometry.multiplyVectorByMatrixAndNormalize(\n          new UI.Geometry.Vector(vertices[i * 3], vertices[i * 3 + 1], vertices[i * 3 + 2]), matrix);\n      this._quad.push(point.x, point.y);\n    }\n\n    function calculateQuadForLayer(layer: AgentLayer): void {\n      layer._calculateQuad(matrix);\n    }\n\n    this._children.forEach(calculateQuadForLayer);\n  }\n}\n\nclass LayerTreeDispatcher implements ProtocolProxyApi.LayerTreeDispatcher {\n  _layerTreeModel: LayerTreeModel;\n  constructor(layerTreeModel: LayerTreeModel) {\n    this._layerTreeModel = layerTreeModel;\n  }\n\n  layerTreeDidChange({layers}: Protocol.LayerTree.LayerTreeDidChangeEvent): void {\n    this._layerTreeModel._layerTreeChanged(layers || null);\n  }\n\n  layerPainted({layerId, clip}: Protocol.LayerTree.LayerPaintedEvent): void {\n    this._layerTreeModel._layerPainted(layerId, clip);\n  }\n}\n"]}