{"version":3,"file":"LighthouseReportSelector.js","sourceRoot":"","sources":["../../../../../../front_end/panels/lighthouse/LighthouseReportSelector.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2018 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport type * as ReportRenderer from './LighthouseReporterTypes.js';\n\nconst UIStrings = {\n  /**\n  *@description Title of combo box in audits report selector\n  */\n  reports: 'Reports',\n  /**\n  *@description New report item label in Lighthouse Report Selector\n  */\n  newReport: '(new report)',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/lighthouse/LighthouseReportSelector.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class ReportSelector {\n  _renderNewLighthouseView: () => void;\n  _newLighthouseItem: HTMLOptionElement;\n  _comboBox: UI.Toolbar.ToolbarComboBox;\n  _itemByOptionElement: Map<Element, Item>;\n\n  constructor(renderNewLighthouseView: () => void) {\n    this._renderNewLighthouseView = renderNewLighthouseView;\n    this._newLighthouseItem = document.createElement('option');\n    this._comboBox = new UI.Toolbar.ToolbarComboBox(\n        this._handleChange.bind(this), i18nString(UIStrings.reports), 'lighthouse-report');\n    this._comboBox.setMaxWidth(180);\n    this._comboBox.setMinWidth(140);\n    this._itemByOptionElement = new Map();\n    this._setEmptyState();\n  }\n\n  _setEmptyState(): void {\n    this._comboBox.selectElement().removeChildren();\n\n    this._comboBox.setEnabled(false);\n    this._newLighthouseItem = document.createElement('option');\n    this._newLighthouseItem.label = i18nString(UIStrings.newReport);\n    this._comboBox.selectElement().appendChild(this._newLighthouseItem);\n    this._comboBox.select(this._newLighthouseItem);\n  }\n\n  _handleChange(_event: Event): void {\n    const item = this._selectedItem();\n    if (item) {\n      item.select();\n    } else {\n      this._renderNewLighthouseView();\n    }\n  }\n\n  _selectedItem(): Item {\n    const option = this._comboBox.selectedOption();\n    return this._itemByOptionElement.get(option as Element) as Item;\n  }\n\n  hasCurrentSelection(): boolean {\n    return Boolean(this._selectedItem());\n  }\n\n  hasItems(): boolean {\n    return this._itemByOptionElement.size > 0;\n  }\n\n  comboBox(): UI.Toolbar.ToolbarComboBox {\n    return this._comboBox;\n  }\n\n  prepend(item: Item): void {\n    const optionEl = item.optionElement();\n    const selectEl = this._comboBox.selectElement();\n\n    this._itemByOptionElement.set(optionEl, item);\n    selectEl.insertBefore(optionEl, selectEl.firstElementChild);\n    this._comboBox.setEnabled(true);\n    this._comboBox.select(optionEl);\n    item.select();\n  }\n\n  clearAll(): void {\n    for (const elem of this._comboBox.options()) {\n      if (elem === this._newLighthouseItem) {\n        continue;\n      }\n\n      this._itemByOptionElement.get(elem)?.delete();\n      this._itemByOptionElement.delete(elem);\n    }\n\n    this._setEmptyState();\n  }\n\n  selectNewReport(): void {\n    this._comboBox.select(this._newLighthouseItem);\n  }\n}\n\nexport class Item {\n  _lighthouseResult: ReportRenderer.ReportJSON;\n  _renderReport: () => void;\n  _showLandingCallback: () => void;\n  _element: HTMLOptionElement;\n\n  constructor(lighthouseResult: ReportRenderer.ReportJSON, renderReport: () => void, showLandingCallback: () => void) {\n    this._lighthouseResult = lighthouseResult;\n    this._renderReport = renderReport;\n    this._showLandingCallback = showLandingCallback;\n\n    const url = new Common.ParsedURL.ParsedURL(lighthouseResult.finalUrl);\n    const timestamp = lighthouseResult.fetchTime;\n    this._element = document.createElement('option');\n    this._element.label = `${new Date(timestamp).toLocaleTimeString()} - ${url.domain()}`;\n  }\n\n  select(): void {\n    this._renderReport();\n  }\n\n  optionElement(): Element {\n    return this._element;\n  }\n\n  delete(): void {\n    if (this._element) {\n      this._element.remove();\n    }\n    this._showLandingCallback();\n  }\n}\n"]}