{"version":3,"file":"AdvancedApp.js","sourceRoot":"","sources":["../../../../../../front_end/panels/emulation/AdvancedApp.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2014 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Common from '../../core/common/common.js';  // eslint-disable-line no-unused-vars\nimport * as Host from '../../core/host/host.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport {DeviceModeWrapper} from './DeviceModeWrapper.js';\nimport {Events, InspectedPagePlaceholder} from './InspectedPagePlaceholder.js';  // eslint-disable-line no-unused-vars\n\n// TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration\n// eslint-disable-next-line @typescript-eslint/naming-convention\nlet _appInstance: AdvancedApp;\n\ninterface Event {\n  data: {\n    to: string,\n    from: string,\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n  };\n}\n\nexport class AdvancedApp implements Common.App.App {\n  _rootSplitWidget!: UI.SplitWidget.SplitWidget;\n  _deviceModeView!: DeviceModeWrapper;\n  _inspectedPagePlaceholder!: InspectedPagePlaceholder;\n  _toolboxWindow?: Window|null;\n  _toolboxRootView?: UI.RootView.RootView;\n  _changingDockSide?: boolean;\n\n  constructor() {\n    UI.DockController.DockController.instance().addEventListener(\n        UI.DockController.Events.BeforeDockSideChanged, this._openToolboxWindow, this);\n  }\n\n  /**\n   * Note: it's used by toolbox.ts without real type checks.\n   */\n  static _instance(): AdvancedApp {\n    if (!_appInstance) {\n      _appInstance = new AdvancedApp();\n    }\n    return _appInstance;\n  }\n\n  presentUI(document: Document): void {\n    const rootView = new UI.RootView.RootView();\n\n    this._rootSplitWidget = new UI.SplitWidget.SplitWidget(false, true, 'InspectorView.splitViewState', 555, 300, true);\n    this._rootSplitWidget.show(rootView.element);\n    this._rootSplitWidget.setSidebarWidget(UI.InspectorView.InspectorView.instance());\n    this._rootSplitWidget.setDefaultFocusedChild(UI.InspectorView.InspectorView.instance());\n    UI.InspectorView.InspectorView.instance().setOwnerSplit(this._rootSplitWidget);\n\n    this._inspectedPagePlaceholder = InspectedPagePlaceholder.instance();\n    this._inspectedPagePlaceholder.addEventListener(Events.Update, this._onSetInspectedPageBounds.bind(this), this);\n    this._deviceModeView =\n        DeviceModeWrapper.instance({inspectedPagePlaceholder: this._inspectedPagePlaceholder, forceNew: false});\n\n    UI.DockController.DockController.instance().addEventListener(\n        UI.DockController.Events.BeforeDockSideChanged, this._onBeforeDockSideChange, this);\n    UI.DockController.DockController.instance().addEventListener(\n        UI.DockController.Events.DockSideChanged, this._onDockSideChange, this);\n    UI.DockController.DockController.instance().addEventListener(\n        UI.DockController.Events.AfterDockSideChanged, this._onAfterDockSideChange, this);\n    this._onDockSideChange();\n\n    console.timeStamp('AdvancedApp.attachToBody');\n    rootView.attachToDocument(document);\n    rootView.focus();\n    this._inspectedPagePlaceholder.update();\n  }\n\n  _openToolboxWindow(event: Event): void {\n    if ((event.data.to as string) !== UI.DockController.State.Undocked) {\n      return;\n    }\n\n    if (this._toolboxWindow) {\n      return;\n    }\n\n    const url = window.location.href.replace('devtools_app.html', 'toolbox.html');\n    this._toolboxWindow = window.open(url, undefined);\n  }\n\n  toolboxLoaded(toolboxDocument: Document): void {\n    UI.UIUtils.initializeUIUtils(\n        toolboxDocument, Common.Settings.Settings.instance().createSetting('uiTheme', 'default'));\n    UI.UIUtils.installComponentRootStyles((toolboxDocument.body as Element));\n    UI.ContextMenu.ContextMenu.installHandler(toolboxDocument);\n    UI.Tooltip.Tooltip.installHandler(toolboxDocument);\n\n    this._toolboxRootView = new UI.RootView.RootView();\n    this._toolboxRootView.attachToDocument(toolboxDocument);\n\n    this._updateDeviceModeView();\n  }\n\n  _updateDeviceModeView(): void {\n    if (this._isDocked()) {\n      this._rootSplitWidget.setMainWidget(this._deviceModeView);\n    } else if (this._toolboxRootView) {\n      this._deviceModeView.show(this._toolboxRootView.element);\n    }\n  }\n\n  _onBeforeDockSideChange(event: Event): void {\n    if (event.data.to === UI.DockController.State.Undocked && this._toolboxRootView) {\n      // Hide inspectorView and force layout to mimic the undocked state.\n      this._rootSplitWidget.hideSidebar();\n      this._inspectedPagePlaceholder.update();\n    }\n\n    this._changingDockSide = true;\n  }\n\n  _onDockSideChange(event?: Event): void {\n    this._updateDeviceModeView();\n\n    const toDockSide = event ? event.data.to : UI.DockController.DockController.instance().dockSide();\n    if (toDockSide === UI.DockController.State.Undocked) {\n      this._updateForUndocked();\n    } else if (this._toolboxRootView && event && event.data.from === UI.DockController.State.Undocked) {\n      // Don't update yet for smooth transition.\n      this._rootSplitWidget.hideSidebar();\n    } else {\n      this._updateForDocked(toDockSide);\n    }\n  }\n\n  _onAfterDockSideChange(event: Event): void {\n    // We may get here on the first dock side change while loading without BeforeDockSideChange.\n    if (!this._changingDockSide) {\n      return;\n    }\n    if ((event.data.from as string) === UI.DockController.State.Undocked) {\n      this._updateForDocked((event.data.to as string));\n    }\n    this._changingDockSide = false;\n    this._inspectedPagePlaceholder.update();\n  }\n\n  _updateForDocked(dockSide: string): void {\n    const resizerElement = (this._rootSplitWidget.resizerElement() as HTMLElement);\n    resizerElement.style.transform = dockSide === UI.DockController.State.DockedToRight ?\n        'translateX(2px)' :\n        dockSide === UI.DockController.State.DockedToLeft ? 'translateX(-2px)' : '';\n    this._rootSplitWidget.setVertical(\n        dockSide === UI.DockController.State.DockedToRight || dockSide === UI.DockController.State.DockedToLeft);\n    this._rootSplitWidget.setSecondIsSidebar(\n        dockSide === UI.DockController.State.DockedToRight || dockSide === UI.DockController.State.DockedToBottom);\n    this._rootSplitWidget.toggleResizer(this._rootSplitWidget.resizerElement(), true);\n    this._rootSplitWidget.toggleResizer(\n        UI.InspectorView.InspectorView.instance().topResizerElement(),\n        dockSide === UI.DockController.State.DockedToBottom);\n    this._rootSplitWidget.showBoth();\n  }\n\n  _updateForUndocked(): void {\n    this._rootSplitWidget.toggleResizer(this._rootSplitWidget.resizerElement(), false);\n    this._rootSplitWidget.toggleResizer(UI.InspectorView.InspectorView.instance().topResizerElement(), false);\n    this._rootSplitWidget.hideMain();\n  }\n\n  _isDocked(): boolean {\n    return UI.DockController.DockController.instance().dockSide() !== UI.DockController.State.Undocked;\n  }\n\n  _onSetInspectedPageBounds(event: Event): void {\n    if (this._changingDockSide) {\n      return;\n    }\n    const window = this._inspectedPagePlaceholder.element.window();\n    if (!window.innerWidth || !window.innerHeight) {\n      return;\n    }\n    if (!this._inspectedPagePlaceholder.isShowing()) {\n      return;\n    }\n    const bounds = event.data;\n    console.timeStamp('AdvancedApp.setInspectedPageBounds');\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.setInspectedPageBounds(bounds);\n  }\n}\n\n// Export required for usage in toolbox.ts\n// @ts-ignore Exported for Tests.js\nglobalThis.Emulation = globalThis.Emulation || {};\n// @ts-ignore Exported for Tests.js\nglobalThis.Emulation.AdvancedApp = AdvancedApp;\n\nlet advancedAppProviderInstance: AdvancedAppProvider;\n\nexport class AdvancedAppProvider implements Common.AppProvider.AppProvider {\n  static instance(opts: {\n    forceNew: boolean|null,\n  } = {forceNew: null}): AdvancedAppProvider {\n    const {forceNew} = opts;\n    if (!advancedAppProviderInstance || forceNew) {\n      advancedAppProviderInstance = new AdvancedAppProvider();\n    }\n\n    return advancedAppProviderInstance;\n  }\n\n  createApp(): Common.App.App {\n    return AdvancedApp._instance();\n  }\n}\n"]}