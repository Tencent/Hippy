{"version":3,"file":"SourceOrderView.js","sourceRoot":"","sources":["../../../../../../front_end/panels/accessibility/SourceOrderView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport {AccessibilitySubPane} from './AccessibilitySubPane.js';\n\nconst UIStrings = {\n  /**\n  * @description Name of a tool which allows the developer to view the contents of the page in the\n  * 'source order' (the order in which the HTML elements show up in the source code). In the\n  * Accessibility panel.\n  */\n  sourceOrderViewer: 'Source Order Viewer',\n  /**\n  *@description Text in Source Order Viewer of the Accessibility panel shown when the selected node has no child elements\n  */\n  noSourceOrderInformation: 'No source order information available',\n  /**\n  *@description Text in Source Order Viewer of the Accessibility panel shown when the selected node has many child elements\n  */\n  thereMayBeADelayInDisplaying: 'There may be a delay in displaying source order for elements with many children',\n  /**\n  * @description Checkbox label in Source Order Viewer of the Accessibility panel. Source order\n  * means the order in which the HTML elements show up in the source code.\n  */\n  showSourceOrder: 'Show source order',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/accessibility/SourceOrderView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst MAX_CHILD_ELEMENTS_THRESHOLD = 300;\n\nexport class SourceOrderPane extends AccessibilitySubPane {\n  _noNodeInfo: Element;\n  _warning: Element;\n  _checked: boolean;\n  _checkboxLabel: UI.UIUtils.CheckboxLabel;\n  _checkboxElement: HTMLInputElement;\n  _node: SDK.DOMModel.DOMNode|null;\n  _overlayModel: SDK.OverlayModel.OverlayModel|null;\n  constructor() {\n    super(i18nString(UIStrings.sourceOrderViewer));\n\n    this._noNodeInfo = this.createInfo(i18nString(UIStrings.noSourceOrderInformation));\n    this._warning = this.createInfo(i18nString(UIStrings.thereMayBeADelayInDisplaying));\n    this._warning.id = 'source-order-warning';\n    this._checked = false;\n    this._checkboxLabel =\n        UI.UIUtils.CheckboxLabel.create(/* title */ i18nString(UIStrings.showSourceOrder), /* checked */ false);\n    this._checkboxElement = this._checkboxLabel.checkboxElement;\n\n    this._checkboxLabel.classList.add('source-order-checkbox');\n    this._checkboxElement.addEventListener('click', this._checkboxClicked.bind(this), false);\n    this.element.appendChild(this._checkboxLabel);\n\n    this._node = null;\n    this._overlayModel = null;\n  }\n\n  async setNodeAsync(node: SDK.DOMModel.DOMNode|null): Promise<void> {\n    if (!this._checkboxLabel.classList.contains('hidden')) {\n      this._checked = this._checkboxElement.checked;\n    }\n    this._checkboxElement.checked = false;\n    this._checkboxClicked();\n    super.setNode(node);\n    if (!this._node) {\n      this._overlayModel = null;\n      return;\n    }\n\n    let foundSourceOrder = false;\n    const childCount = this._node.childNodeCount();\n    if (childCount > 0) {\n      if (!this._node.children()) {\n        await this._node.getSubtree(1, false);\n      }\n      const children = this._node.children() as SDK.DOMModel.DOMNode[];\n      foundSourceOrder = children.some(child => child.nodeType() === Node.ELEMENT_NODE);\n    }\n\n    this._noNodeInfo.classList.toggle('hidden', foundSourceOrder);\n    this._warning.classList.toggle('hidden', childCount < MAX_CHILD_ELEMENTS_THRESHOLD);\n    this._checkboxLabel.classList.toggle('hidden', !foundSourceOrder);\n    if (foundSourceOrder) {\n      this._overlayModel = this._node.domModel().overlayModel();\n      this._checkboxElement.checked = this._checked;\n      this._checkboxClicked();\n    } else {\n      this._overlayModel = null;\n    }\n  }\n\n  _checkboxClicked(): void {\n    if (!this._node || !this._overlayModel) {\n      return;\n    }\n\n    if (this._checkboxElement.checked) {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.SourceOrderViewActivated);\n      this._overlayModel.highlightSourceOrderInOverlay(this._node);\n    } else {\n      this._overlayModel.hideSourceOrderInOverlay();\n    }\n  }\n}\n"]}