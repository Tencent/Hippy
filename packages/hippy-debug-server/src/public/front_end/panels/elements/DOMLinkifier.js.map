{"version":3,"file":"DOMLinkifier.js","sourceRoot":"","sources":["../../../../../../front_end/panels/elements/DOMLinkifier.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2018 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nconst UIStrings = {\n  /**\n  * @description Text displayed when trying to create a link to a node in the UI, but the node\n  * location could not be found so we display this placeholder instead. Node refers to a DOM node.\n  * This should be translated if appropriate.\n  */\n  node: '<node>',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/elements/DOMLinkifier.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport const decorateNodeLabel = function(\n    node: SDK.DOMModel.DOMNode, parentElement: HTMLElement, tooltipContent?: string): void {\n  const originalNode = node;\n  const isPseudo = node.nodeType() === Node.ELEMENT_NODE && node.pseudoType();\n  if (isPseudo && node.parentNode) {\n    node = node.parentNode;\n  }\n\n  let title = node.nodeNameInCorrectCase();\n\n  const nameElement = parentElement.createChild('span', 'node-label-name');\n  nameElement.textContent = title;\n\n  const idAttribute = node.getAttribute('id');\n  if (idAttribute) {\n    const idElement = parentElement.createChild('span', 'node-label-id');\n    const part = '#' + idAttribute;\n    title += part;\n    UI.UIUtils.createTextChild(idElement, part);\n\n    // Mark the name as extra, since the ID is more important.\n    nameElement.classList.add('extra');\n  }\n\n  const classAttribute = node.getAttribute('class');\n  if (classAttribute) {\n    const classes = classAttribute.split(/\\s+/);\n    if (classes.length) {\n      const foundClasses = new Set<string>();\n      const classesElement = parentElement.createChild('span', 'extra node-label-class');\n      for (let i = 0; i < classes.length; ++i) {\n        const className = classes[i];\n        if (className && !foundClasses.has(className)) {\n          const part = '.' + className;\n          title += part;\n          UI.UIUtils.createTextChild(classesElement, part);\n          foundClasses.add(className);\n        }\n      }\n    }\n  }\n\n  if (isPseudo) {\n    const pseudoElement = parentElement.createChild('span', 'extra node-label-pseudo');\n    const pseudoText = '::' + originalNode.pseudoType();\n    UI.UIUtils.createTextChild(pseudoElement, pseudoText);\n    title += pseudoText;\n  }\n  UI.Tooltip.Tooltip.install(parentElement, tooltipContent || title);\n};\n\nexport const linkifyNodeReference = function(\n    node: SDK.DOMModel.DOMNode|null, options: Common.Linkifier.Options|undefined = {\n      tooltip: undefined,\n      preventKeyboardFocus: undefined,\n    }): Node {\n  if (!node) {\n    return document.createTextNode(i18nString(UIStrings.node));\n  }\n\n  const root = document.createElement('span');\n  root.classList.add('monospace');\n  const shadowRoot = UI.Utils.createShadowRootWithCoreStyles(\n      root, {cssFile: 'panels/elements/domLinkifier.css', enableLegacyPatching: false, delegatesFocus: undefined});\n  const link = (shadowRoot.createChild('div', 'node-link') as HTMLDivElement);\n\n  decorateNodeLabel(node, link, options.tooltip);\n\n  link.addEventListener('click', () => {\n    Common.Revealer.reveal(node, false);\n    return false;\n  }, false);\n  link.addEventListener('mouseover', node.highlight.bind(node, undefined), false);\n  link.addEventListener('mouseleave', () => SDK.OverlayModel.OverlayModel.hideDOMNodeHighlight(), false);\n\n  if (!options.preventKeyboardFocus) {\n    link.addEventListener('keydown', event => event.key === 'Enter' && Common.Revealer.reveal(node, false) && false);\n    link.tabIndex = 0;\n    UI.ARIAUtils.markAsLink(link);\n  }\n\n  return root;\n};\n\nexport const linkifyDeferredNodeReference = function(\n    deferredNode: SDK.DOMModel.DeferredDOMNode, options: Common.Linkifier.Options|undefined = {\n      tooltip: undefined,\n      preventKeyboardFocus: undefined,\n    }): Node {\n  const root = document.createElement('div');\n  const shadowRoot = UI.Utils.createShadowRootWithCoreStyles(\n      root, {cssFile: 'panels/elements/domLinkifier.css', enableLegacyPatching: false, delegatesFocus: undefined});\n  const link = (shadowRoot.createChild('div', 'node-link') as HTMLDivElement);\n  link.createChild('slot');\n  link.addEventListener('click', deferredNode.resolve.bind(deferredNode, onDeferredNodeResolved), false);\n  link.addEventListener('mousedown', e => e.consume(), false);\n\n  if (!options.preventKeyboardFocus) {\n    link.addEventListener('keydown', event => event.key === 'Enter' && deferredNode.resolve(onDeferredNodeResolved));\n    link.tabIndex = 0;\n    UI.ARIAUtils.markAsLink(link);\n  }\n\n  function onDeferredNodeResolved(node: SDK.DOMModel.DOMNode|null): void {\n    Common.Revealer.reveal(node);\n  }\n\n  return root;\n};\n\n// @empty-line\nlet linkifierInstance: Linkifier;\n\nexport class Linkifier implements Common.Linkifier.Linkifier {\n  static instance(opts: {\n    forceNew: boolean|null,\n  } = {forceNew: null}): Linkifier {\n    const {forceNew} = opts;\n    if (!linkifierInstance || forceNew) {\n      linkifierInstance = new Linkifier();\n    }\n\n    return linkifierInstance;\n  }\n  linkify(object: Object, options?: Common.Linkifier.Options): Node {\n    if (object instanceof SDK.DOMModel.DOMNode) {\n      return linkifyNodeReference(object, options);\n    }\n    if (object instanceof SDK.DOMModel.DeferredDOMNode) {\n      return linkifyDeferredNodeReference(object, options);\n    }\n    throw new Error('Can\\'t linkify non-node');\n  }\n}\n"]}