{"version":3,"file":"ScriptOriginPlugin.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/ScriptOriginPlugin.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2018 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as SDK from '../../core/sdk/sdk.js'; // eslint-disable-line no-unused-vars\nimport * as Bindings from '../../models/bindings/bindings.js';\nimport type * as Workspace from '../../models/workspace/workspace.js'; // eslint-disable-line no-unused-vars\nimport type * as SourceFrame from '../../ui/legacy/components/source_frame/source_frame.js'; // eslint-disable-line no-unused-vars\nimport * as Components from '../../ui/legacy/components/utils/utils.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport {Plugin} from './Plugin.js';\n\nconst UIStrings = {\n  /**\n  *@description Text in Script Origin Plugin of the Sources panel\n  *@example {example.com} PH1\n  */\n  sourceMappedFromS: '(source mapped from {PH1})',\n  /**\n  *@description Text in Script Origin Plugin of the Sources panel\n  *@example {http://localhost/file.wasm} PH1\n  */\n  providedViaDebugInfoByS: '(provided via debug info by {PH1})',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/sources/ScriptOriginPlugin.ts', UIStrings);\n\nexport class ScriptOriginPlugin extends Plugin {\n  _textEditor: SourceFrame.SourcesTextEditor.SourcesTextEditor;\n  _uiSourceCode: Workspace.UISourceCode.UISourceCode;\n  constructor(\n      textEditor: SourceFrame.SourcesTextEditor.SourcesTextEditor, uiSourceCode: Workspace.UISourceCode.UISourceCode) {\n    super();\n    this._textEditor = textEditor;\n    this._uiSourceCode = uiSourceCode;\n  }\n\n  static accepts(uiSourceCode: Workspace.UISourceCode.UISourceCode): boolean {\n    return uiSourceCode.contentType().hasScripts() || Boolean(ScriptOriginPlugin._script(uiSourceCode));\n  }\n\n  async rightToolbarItems(): Promise<UI.Toolbar.ToolbarItem[]> {\n    const originURLs = Bindings.CompilerScriptMapping.CompilerScriptMapping.uiSourceCodeOrigin(this._uiSourceCode);\n    if (originURLs.length) {\n      return originURLs.map(originURL => {\n        const item = i18n.i18n.getFormatLocalizedString(\n            str_, UIStrings.sourceMappedFromS, {PH1: Components.Linkifier.Linkifier.linkifyURL(originURL)});\n        return new UI.Toolbar.ToolbarItem(item);\n      });\n    }\n\n    const pluginManager = Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().pluginManager;\n    if (pluginManager) {\n      for (const originScript of pluginManager.scriptsForUISourceCode(this._uiSourceCode)) {\n        if (originScript.sourceURL) {\n          const item = i18n.i18n.getFormatLocalizedString(\n              str_, UIStrings.providedViaDebugInfoByS,\n              {PH1: Components.Linkifier.Linkifier.linkifyURL(originScript.sourceURL)});\n          return [new UI.Toolbar.ToolbarItem(item)];\n        }\n      }\n    }\n\n    // Handle anonymous scripts with an originStackTrace.\n    const script = await ScriptOriginPlugin._script(this._uiSourceCode);\n    if (!script || !script.originStackTrace) {\n      return [];\n    }\n    const link = linkifier.linkifyStackTraceTopFrame(script.debuggerModel.target(), script.originStackTrace);\n    return [new UI.Toolbar.ToolbarItem(link)];\n  }\n\n  static async _script(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<SDK.Script.Script|null> {\n    const locations =\n        await Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().uiLocationToRawLocations(\n            uiSourceCode, 0, 0);\n    for (const location of locations) {\n      const script = location.script();\n      if (script && script.originStackTrace) {\n        return script;\n      }\n    }\n    return null;\n  }\n}\n\nexport const linkifier = new Components.Linkifier.Linkifier();\n"]}