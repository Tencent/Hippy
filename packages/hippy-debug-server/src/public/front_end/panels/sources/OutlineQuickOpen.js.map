{"version":3,"file":"OutlineQuickOpen.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/OutlineQuickOpen.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Formatter from '../../models/formatter/formatter.js';\nimport type * as Workspace from '../../models/workspace/workspace.js'; // eslint-disable-line no-unused-vars\nimport * as QuickOpen from '../../ui/legacy/components/quick_open/quick_open.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport {SourcesView} from './SourcesView.js';\n\nconst UIStrings = {\n  /**\n  *@description Text in Go To Line Quick Open of the Sources panel\n  */\n  noFileSelected: 'No file selected.',\n  /**\n  *@description Text in Outline Quick Open of the Sources panel\n  */\n  openAJavascriptOrCssFileToSee: 'Open a JavaScript or CSS file to see symbols',\n  /**\n  *@description Text to show no results have been found\n  */\n  noResultsFound: 'No results found',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/sources/OutlineQuickOpen.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nlet outlineQuickOpenInstance: OutlineQuickOpen;\n\nexport class OutlineQuickOpen extends QuickOpen.FilteredListWidget.Provider {\n  _items: Formatter.FormatterWorkerPool.OutlineItem[];\n  _active: boolean;\n  private constructor() {\n    super();\n    this._items = [];\n    this._active = false;\n  }\n\n  static instance(opts: {\n    forceNew: boolean|null,\n  } = {forceNew: null}): OutlineQuickOpen {\n    const {forceNew} = opts;\n    if (!outlineQuickOpenInstance || forceNew) {\n      outlineQuickOpenInstance = new OutlineQuickOpen();\n    }\n\n    return outlineQuickOpenInstance;\n  }\n\n  attach(): void {\n    this._items = [];\n    this._active = false;\n\n    const uiSourceCode = this._currentUISourceCode();\n    if (uiSourceCode) {\n      this._active = Formatter.FormatterWorkerPool.formatterWorkerPool().outlineForMimetype(\n          uiSourceCode.workingCopy(), uiSourceCode.contentType().canonicalMimeType(),\n          this._didBuildOutlineChunk.bind(this));\n    }\n  }\n\n  _didBuildOutlineChunk(isLastChunk: boolean, items: Formatter.FormatterWorkerPool.OutlineItem[]): void {\n    this._items.push(...items);\n    this.refresh();\n  }\n\n  itemCount(): number {\n    return this._items.length;\n  }\n\n  itemKeyAt(itemIndex: number): string {\n    const item = this._items[itemIndex];\n    return item.title + (item.subtitle ? item.subtitle : '');\n  }\n\n  itemScoreAt(itemIndex: number, query: string): number {\n    const item = this._items[itemIndex];\n    const methodName = query.split('(')[0];\n    if (methodName.toLowerCase() === item.title.toLowerCase()) {\n      return 1 / (1 + item.line);\n    }\n    return -item.line - 1;\n  }\n\n  renderItem(itemIndex: number, query: string, titleElement: Element, subtitleElement: Element): void {\n    const item = this._items[itemIndex];\n    titleElement.textContent = item.title + (item.subtitle ? item.subtitle : '');\n    QuickOpen.FilteredListWidget.FilteredListWidget.highlightRanges(titleElement, query);\n    subtitleElement.textContent = ':' + (item.line + 1);\n  }\n\n  selectItem(itemIndex: number|null, _promptValue: string): void {\n    if (itemIndex === null) {\n      return;\n    }\n    const uiSourceCode = this._currentUISourceCode();\n    if (!uiSourceCode) {\n      return;\n    }\n    const lineNumber = this._items[itemIndex].line;\n    if (!isNaN(lineNumber) && lineNumber >= 0) {\n      Common.Revealer.reveal(uiSourceCode.uiLocation(lineNumber, this._items[itemIndex].column));\n    }\n  }\n\n  _currentUISourceCode(): Workspace.UISourceCode.UISourceCode|null {\n    const sourcesView = UI.Context.Context.instance().flavor(SourcesView);\n    if (!sourcesView) {\n      return null;\n    }\n    return sourcesView.currentUISourceCode();\n  }\n\n  notFoundText(): string {\n    if (!this._currentUISourceCode()) {\n      return i18nString(UIStrings.noFileSelected);\n    }\n    if (!this._active) {\n      return i18nString(UIStrings.openAJavascriptOrCssFileToSee);\n    }\n    return i18nString(UIStrings.noResultsFound);\n  }\n}\n"]}