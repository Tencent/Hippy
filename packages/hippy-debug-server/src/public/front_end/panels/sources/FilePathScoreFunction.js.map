{"version":3,"file":"FilePathScoreFunction.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/FilePathScoreFunction.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright (C) 2013 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nexport class FilePathScoreFunction {\n  _query: string;\n  _queryUpperCase: string;\n  _score: Int32Array;\n  _sequence: Int32Array;\n  _dataUpperCase: string;\n  _fileNameIndex: number;\n  constructor(query: string) {\n    this._query = query;\n    this._queryUpperCase = query.toUpperCase();\n    this._score = new Int32Array(20 * 100);\n    this._sequence = new Int32Array(20 * 100);\n    this._dataUpperCase = '';\n    this._fileNameIndex = 0;\n  }\n\n  score(data: string, matchIndexes: number[]|null): number {\n    if (!data || !this._query) {\n      return 0;\n    }\n    const n = this._query.length;\n    const m = data.length;\n    if (!this._score || this._score.length < n * m) {\n      this._score = new Int32Array(n * m * 2);\n      this._sequence = new Int32Array(n * m * 2);\n    }\n    const score = this._score;\n    const sequence = (this._sequence as Int32Array);\n    this._dataUpperCase = data.toUpperCase();\n    this._fileNameIndex = data.lastIndexOf('/');\n    for (let i = 0; i < n; ++i) {\n      for (let j = 0; j < m; ++j) {\n        const skipCharScore = j === 0 ? 0 : score[i * m + j - 1];\n        const prevCharScore = i === 0 || j === 0 ? 0 : score[(i - 1) * m + j - 1];\n        const consecutiveMatch = i === 0 || j === 0 ? 0 : sequence[(i - 1) * m + j - 1];\n        const pickCharScore = this._match(this._query, data, i, j, consecutiveMatch);\n        if (pickCharScore && prevCharScore + pickCharScore >= skipCharScore) {\n          sequence[i * m + j] = consecutiveMatch + 1;\n          score[i * m + j] = (prevCharScore + pickCharScore);\n        } else {\n          sequence[i * m + j] = 0;\n          score[i * m + j] = skipCharScore;\n        }\n      }\n    }\n    if (matchIndexes) {\n      this._restoreMatchIndexes(sequence, n, m, matchIndexes);\n    }\n    const maxDataLength = 256;\n    return score[n * m - 1] * maxDataLength + (maxDataLength - data.length);\n  }\n\n  _testWordStart(data: string, j: number): boolean {\n    if (j === 0) {\n      return true;\n    }\n\n    const prevChar = data.charAt(j - 1);\n    return prevChar === '_' || prevChar === '-' || prevChar === '/' || prevChar === '.' || prevChar === ' ' ||\n        (data[j - 1] !== this._dataUpperCase[j - 1] && data[j] === this._dataUpperCase[j]);\n  }\n\n  _restoreMatchIndexes(sequence: Int32Array, n: number, m: number, out: number[]): void {\n    let i = n - 1, j = m - 1;\n    while (i >= 0 && j >= 0) {\n      switch (sequence[i * m + j]) {\n        case 0:\n          --j;\n          break;\n        default:\n          out.push(j);\n          --i;\n          --j;\n          break;\n      }\n    }\n    out.reverse();\n  }\n\n  _singleCharScore(query: string, data: string, i: number, j: number): number {\n    const isWordStart = this._testWordStart(data, j);\n    const isFileName = j > this._fileNameIndex;\n    const isPathTokenStart = j === 0 || data[j - 1] === '/';\n    const isCapsMatch = query[i] === data[j] && query[i] === this._queryUpperCase[i];\n    let score = 10;\n    if (isPathTokenStart) {\n      score += 4;\n    }\n    if (isWordStart) {\n      score += 2;\n    }\n    if (isCapsMatch) {\n      score += 6;\n    }\n    if (isFileName) {\n      score += 4;\n    }\n    // promote the case of making the whole match in the filename\n    if (j === this._fileNameIndex + 1 && i === 0) {\n      score += 5;\n    }\n    if (isFileName && isWordStart) {\n      score += 3;\n    }\n    return score;\n  }\n\n  _sequenceCharScore(query: string, data: string, i: number, j: number, sequenceLength: number): number {\n    const isFileName = j > this._fileNameIndex;\n    const isPathTokenStart = j === 0 || data[j - 1] === '/';\n    let score = 10;\n    if (isFileName) {\n      score += 4;\n    }\n    if (isPathTokenStart) {\n      score += 5;\n    }\n    score += sequenceLength * 4;\n    return score;\n  }\n\n  _match(query: string, data: string, i: number, j: number, consecutiveMatch: number): number {\n    if (this._queryUpperCase[i] !== this._dataUpperCase[j]) {\n      return 0;\n    }\n\n    if (!consecutiveMatch) {\n      return this._singleCharScore(query, data, i, j);\n    }\n    return this._sequenceCharScore(query, data, i, j - consecutiveMatch, consecutiveMatch);\n  }\n}\n"]}