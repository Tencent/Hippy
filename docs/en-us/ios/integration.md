# iOS integration

> Note: The following documents assume that you already have some experience in iOS development.

This tutorial describes how to integrate Hippy into an existing iOS project.

---

## 1. Use Cocoapods to integrate iOS SDK

[CocoaPods](https://cocoapods.org/) is a popular package management tool for iOS and macOS development. We'll use this to add Hippy's iOS Framework to an existing iOS project.

It is recommended to use Homebrew to install CocoaPods. The installation command is as follows:

```shell
brew install cocoapods
```

The specific steps are as follows:

1. First, determine the Hippy iOS SDK version to be integrated, such as 2.17.0, and record it, which will be used in the Podfile.

    > You can go to "[version query address](https://github.com/Tencent/Hippy/releases)" to check the latest version information

2. Secondly, prepare the Podfile file of the existing iOS project

     The Podfile file is the configuration file of the CocoaPods package management tool. If the current project does not have this file, the simplest way to create it is to use the CocoaPods init command and execute the following command in the iOS project file directory:

     ```shell
     pod init
     ```

     The generated Podfile will contain some demo settings that you can adjust according to the purpose of the integration.

     In order to integrate Hippy SDK into the project, we need to modify the Podfile file, add hippy to it, and specify the integrated version. The modified Podfile should look like this:

     ```text
     platform:ios, '11.0'

     # TargetName is most likely your project name
     targetTargetName do

         # Specify here the hippy version number recorded in step 1
         pod 'hippy', '2.17.0'

     end
     ```

     > IMPORTANT NOTE:
     >
     > When integrating some historical versions from `2.13.0` to `2.16.x`, if hippy is accessed in the form of a static link library, the `force_load` compilation parameter needs to be set to load all symbols of hippy, otherwise the Hippy application will not be able to run. The versions that need to be set are as follows:
     >
     > `2.13.0` to `2.13.13`
     >
     > `2.14.0` to `2.14.10`
     >
     > `2.15.0` to `2.15.7`
     >
     > `2.16.0` to `2.16.5`
     >
     > `force_load` can be set in a variety of ways. You can choose any of the following configurations and adjust according to the actual situation:
     >
     > * Add `*-force_load "${PODS_CONFIGURATION_BUILD_DIR}/hippy/libhippy.a"*` directly to the Build Settings - `Other Linker Flags` configuration of the corresponding target of the main project.
     >
     > * Add `post_install hook` to the Podfile configuration file of the App project, and add `force_load` to xcconfig by yourself.
     >

3. Finally, execute in the command line

     ```shell
     pod install
     ```

     After the command is successfully executed, use the project file with the `.xcworkspace` suffix generated by CocoaPods to open the project.

## 2. Write SDK access code and load local or remote Hippy resource package

The initialization of Hippy SDK only requires two steps:

1. Initialize a HippyBridge instance. HippyBridge is the most important concept of Hippy. It is a bridge for communication between the Native side and the JS side. It also carries the main context information of the Hippy application.

2. Initialize a HippyRootView instance through the HippyBridge instance. HippyRootView is another important concept of Hippy applications. Hippy applications will be displayed by it. Therefore, it can be said that creating a business means creating a `HippyRootView`.

Currently, Hippy provides subcontracted loading interfaces and non-subcontracted loading interfaces. The usage methods are as follows:

### Method 1. Use subcontracting loading interface

```objective
/** This method is suitable for the following scenarios:
  * Prepare the JS environment before the business starts, and load package 1. When the business starts, load package 2 to reduce package loading time.
  * We recommend package 1 as a basic package, which has nothing to do with the business. It only contains some common basic components and is common to all businesses.
  * Package 2 is loaded as business code
*/

// First load package 1 and create a HippyBridge instance
// Assume commonBundlePath is the path of package 1
// Tips: For detailed parameter description, please refer to the header file: HippyBridge.h
NSURL *commonBundlePath = getCommonBundlePath();
HippyBridge *bridge = [[HippyBridge alloc] initWithDelegate:self
                                                   bundleURL:commonBundlePath
                                              moduleProvider:nil
                                               launchOptions:your_launchOptions
                                                 executorKey:nil];

// Then create a HippyRootView instance through the above bridge and package 2 address
// Assume businessBundlePath is the path of package 2
// Tips: For detailed parameter description, please refer to the header file: HippyRootView.h
HippyRootView *rootView = [[HippyRootView alloc] initWithBridge:bridge
                                                     businessURL:businessBundlePath
                                                      moduleName:@"Your_Hippy_App_Name"
                                               initialProperties:@{}
                                                    shareOptions:nil
                                                        delegate:nil];

// Finally, set the frame for the generated rootView and mount it on the specified VC.
rootView.frame = self.view.bounds;
rootView.autoresizingMask = UIViewAutoresizingFlexibleHeight | UIViewAutoresizingFlexibleWidth;
[self.view addSubview:rootView];

// At this point, you have completed the initialization of a Hippy application. The SDK will automatically load resources and start running the Hippy application.
```

### Method 2. Use non-packaging loading interface

```objective
//Similar to the above-mentioned use of the subcontracted loading interface, you first need to create a HippyBridge instance.
// The difference is that when creating a HippyRootView instance, there is no need to pass in the business package, that is, businessBundlePath. You can create it directly using the following interface.
// Tips: For detailed parameter description, please refer to the header file: HippyRootView.h
- (instancetype)initWithBridge:(HippyBridge *)bridge
                     moduleName:(NSString *)moduleName
              initialProperties:(nullable NSDictionary *)initialProperties
                   shareOptions:(nullable NSDictionary *)shareOptions
                       delegate:(nullable id<HippyRootViewDelegate>)delegate;
```

> A simple sample project is provided in the Hippy repository, including all the above access codes, as well as more notes.
>
> It is recommended to refer to this example to complete the integration of the SDK into existing projects: [iOS Demo](https://github.com/Tencent/Hippy/tree/master/examples/ios-demo)
>

!> Using subpackage loading, you can combine a series of strategies, such as preloading bridge in advance, global single bridge, etc. to optimize page opening speed.
