set(LIB_NAME "dom")

project("dom")
set(LAYOUT_ENGINE "Taitank")

get_filename_component(PROJECT_ROOT_DIR "${CMAKE_CURRENT_SOURCE_DIR}/.." REALPATH)
get_filename_component(CORE_DIR "${PROJECT_ROOT_DIR}/framework/js/core/" REALPATH)
get_filename_component(THIRD_DIR "${PROJECT_ROOT_DIR}/third_party/" REALPATH)


message("LAYOUT_ENGINE:" ${LAYOUT_ENGINE})
if (${LAYOUT_ENGINE} STREQUAL "Yoga")
  add_definitions("-DUSE_YOGA")
  get_filename_component(LAYOUT_DIR "${THIRD_DIR}/yoga/include" REALPATH)
  set(DEPS "${THIRD_DIR}/yoga/lib/yoga")
elseif (${LAYOUT_ENGINE} STREQUAL "Taitank")
  add_definitions("-DUSE_TAITANK")
  get_filename_component(LAYOUT_DIR "${PROJECT_ROOT_DIR}/layout" REALPATH)
  add_subdirectory(${LAYOUT_DIR} layout_out)
  set(DEPS layout)
else()
  message(FATAL_ERROR "Layout Engine ${LAYOUT_ENGINE} is not supported")
endif()

include_directories(${CORE_DIR}/include)
include_directories(${CORE_DIR}/third_party/base/include)
include_directories(${LAYOUT_DIR})
include_directories(${THIRD_DIR})
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include)
file(GLOB_RECURSE SRC_FILES ${CMAKE_CURRENT_SOURCE_DIR}/src/**.cc)
if (${LAYOUT_ENGINE} STREQUAL "Yoga")
  list(REMOVE_ITEM SRC_FILES ${CMAKE_CURRENT_SOURCE_DIR}/src/dom/taitank_layout_node.cc)
elseif(${LAYOUT_ENGINE} STREQUAL "Taitank")
  list(REMOVE_ITEM SRC_FILES ${CMAKE_CURRENT_SOURCE_DIR}/src/dom/yoga_layout_node.cc)
else()
  message(FATAL_ERROR "Layout Engine ${LAYOUT_ENGINE} is not supported")
endif()
message("SRC_FILES:${SRC_FILES}")

set(LIBRARY_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/lib/dom)
add_library(${LIB_NAME} STATIC ${SRC_FILES})
target_link_libraries(${LIB_NAME} ${DEPS})
set_property(TARGET ${LIB_NAME} PROPERTY CXX_STANDARD 17)
